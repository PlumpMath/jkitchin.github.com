<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:wfw="http://wellformedweb.org/CommentAPI/"
     >
  <channel>
    <title>The Kitchin Research Group</title>
    <link>http://jkitchin.github.io/blog</link>
    <description>Chemical Engineering at Carnegie Mellon University</description>
    <pubDate>Mon, 30 May 2016 16:38:33 GMT</pubDate>
    <generator>Blogofile</generator>
    <sy:updatePeriod>hourly</sy:updatePeriod>
    <sy:updateFrequency>1</sy:updateFrequency>
    <item>
      <title>Writing lisp code from Python</title>
      <link>http://jkitchin.github.io/blog/2016/05/30/Writing-lisp-code-from-Python</link>
      <pubDate>Mon, 30 May 2016 09:26:05 EDT</pubDate>
      <category><![CDATA[lisp]]></category>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">8fLtRl77T5lq3mDjRbl_tQb10IE=</guid>
      <description>Writing lisp code from Python</description>
      <content:encoded><![CDATA[



<p>
Some time ago I <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/05/16/Python-data-structures-to-lisp/">wrote about converting python data structures to lisp</a> . I have expanded on that idea to writing lisp programs from Python! The newly expanded code that makes this possible can be found at <a href="https://github.com/jkitchin/pycse/blob/master/pycse/lisp.py">https://github.com/jkitchin/pycse/blob/master/pycse/lisp.py</a> .
</p>

<p>
Here are the simple data types known to pycse.lisp:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">"a string"</span>.lisp)
<span style="color: #BA36A5;">a</span> = 5
<span style="color: #BA36A5;">b</span> = 5.0
<span style="color: #0000FF;">print</span>(a.lisp)
<span style="color: #0000FF;">print</span>(b.lisp)
<span style="color: #0000FF;">print</span>([1, 2, 3].lisp)
<span style="color: #0000FF;">print</span>((1, 2, 3).lisp)
<span style="color: #0000FF;">print</span>({<span style="color: #008000;">'a'</span>: 4}.lisp)
<span style="color: #0000FF;">print</span>(np.array([1, 2, 3]).lisp)
<span style="color: #0000FF;">print</span>(np.array([1.0, 2.0, 3.0]).lisp)
</pre>
</div>

<pre class="example">
"a string"
5
5.0
(1 2 3)
(1 2 3)
(:a 4)
(1 2 3)
(1.0 2.0 3.0)
</pre>

<p>
There are also some more complex types.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl

<span style="color: #0000FF;">print</span>(pl.Symbol(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.Quote(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.SharpQuote(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.Cons(<span style="color: #008000;">"a"</span>, 5))
<span style="color: #0000FF;">print</span>(pl.Alist([<span style="color: #008000;">"a"</span>, 2, <span style="color: #008000;">"b"</span>, 5]))
<span style="color: #0000FF;">print</span>(pl.Vector([1, 2, 3]))

<span style="color: #0000FF;">print</span>(pl.Backquote([]))
<span style="color: #0000FF;">print</span>(pl.Comma([1, 2, 3]))
<span style="color: #0000FF;">print</span>(pl.Splice([1, 2, 3]))
</pre>
</div>

<pre class="example">
lambda
'lambda
#'lambda
("a" . 5)
(("a" . 2) ("b" . 5))
[1 2 3]
`()
,(1 2 3)
,@(1 2 3)
</pre>

<p>
You can nest these too.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl
<span style="color: #0000FF;">print</span>(pl.Quote(pl.Alist([<span style="color: #008000;">"a"</span>, 2, <span style="color: #008000;">"b"</span>, 5])))
<span style="color: #0000FF;">print</span>(pl.Backquote([pl.Symbol(<span style="color: #008000;">'+'</span>), pl.Comma(pl.Symbol(<span style="color: #008000;">'b'</span>)), 5]))
</pre>
</div>

<pre class="example">
'(("a" . 2) ("b" . 5))
`(+ ,b 5)
</pre>

<p>
All that means we can use Python <i>code</i> to generate lisp programs. Here is an example where we make two sub-programs, and combine them into an overall program, then add one more subprogram to it. We wrap the results in an emacs-lisp block, then actually run the block!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl

<span style="color: #BA36A5;">p1</span> = [pl.Symbol(<span style="color: #008000;">'mapcar'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [pl.Symbol(<span style="color: #008000;">'lambda'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [pl.Symbol(<span style="color: #008000;">'x'</span>)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [pl.Symbol(<span style="color: #008000;">'*'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pl.Symbol(<span style="color: #008000;">'x'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pl.Symbol(<span style="color: #008000;">'x'</span>)]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> pl.Quote([1, 2, 3, 4])]

<span style="color: #BA36A5;">p2</span> = [pl.Symbol(<span style="color: #008000;">'princ'</span>), <span style="color: #008000;">"Hello world"</span>]

<span style="color: #BA36A5;">p</span> = [pl.Symbol(<span style="color: #008000;">'list'</span>), p1, p2]
p.append([pl.Symbol(<span style="color: #008000;">'+'</span>), 5, 5])

<span style="color: #0000FF;">print</span>(p.lisp)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(list (mapcar (<span style="color: #0000FF;">lambda</span> (x) (* x x)) '(1 2 3 4)) (princ <span style="color: #008000;">"Hello world"</span>) (+ 5 5))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">(1 4 9 16)</td>
<td class="left">Hello world</td>
<td class="right">10</td>
</tr>
</tbody>
</table>

<p>
Wow, it worked! Here is another example of setting up a macro and then running it.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl
<span style="color: #BA36A5;">s</span> = pl.Symbol
<span style="color: #BA36A5;">bq</span> = pl.Backquote
<span style="color: #BA36A5;">c</span> = pl.Comma

<span style="color: #BA36A5;">p1</span> = [s(<span style="color: #008000;">'defmacro'</span>), s(<span style="color: #008000;">'f'</span>), [s(<span style="color: #008000;">'x'</span>)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">"A docstring"</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> bq([s(<span style="color: #008000;">'*'</span>), c(s(<span style="color: #008000;">'x'</span>)), 5])]


<span style="color: #BA36A5;">p2</span> = [s(<span style="color: #008000;">'f'</span>), 5]

<span style="color: #0000FF;">print</span>(p1.lisp)

<span style="color: #0000FF;">print</span>(p2.lisp)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">f</span> (x) <span style="color: #036A07;">"A docstring"</span> `(* ,x 5))
(<span style="color: #0000FF;">f</span> 5)
</pre>
</div>

<pre class="example">
25
</pre>

<p>
I am not too sure where this will be super useful, but it is an interesting proof of concept. I haven't tested this much beyond the original post and this one. Let me know if you find issues with it.</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/30/Writing-lisp-code-from-Python.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Expanding orgmode.py to get better org-python integration</title>
      <link>http://jkitchin.github.io/blog/2016/05/29/Expanding-orgmode-py-to-get-better-org-python-integration</link>
      <pubDate>Sun, 29 May 2016 14:03:34 EDT</pubDate>
      <category><![CDATA[orgmode]]></category>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">m-KD1nhbYVjqTRMwBshg21ZZoXk=</guid>
      <description>Expanding orgmode.py to get better org-python integration</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. A Figure from Python</a></li>
<li><a href="#sec-2">2. An example table.</a></li>
<li><a href="#sec-3">3. Miscellaneous outputs</a></li>
<li><a href="#sec-4">4. Summary</a></li>
</ul>
</div>
</div>

<p>
I have only ever been about 80% satisfied with Python/org-mode integration. I have developed a particular workflow that I like a lot, and works well for solving scientific and engineering problems. I typically use stand-alone Python blocks, i.e. not sessions. I tend to use print statements to create output that I want to see, e.g. the value of a calculation. I also tend to create multiple figures in a single block, which I want to display in the buffer. This workflow is represented extensively in <a href="http://kitchingroup.cheme.cmu.edu/pycse/">PYCSE</a> and <a href="https://github.com/jkitchin/dft-book">dft-book</a> which collectively have 700+ src blocks! So I use it alot ;)
</p>

<p>
There are some deficiencies though. For one, I have had to hand build any figures/tables that are generated from the code blocks. That means duplicating filenames, adding the captions, etc&#x2026; It is not that easy to update captions from the code blocks, and there has been limited ability to use markup in the output.
</p>

<p>
Well finally I had some ideas to change this. The ideas are:
</p>

<ol class="org-ol">
<li>Patch matplotlib so that savefig actually returns a figure link that can be printed to the output. savefig works the same otherwise.
</li>

<li>Patch matplotlib.pyplot.show to save the figure, and print a figure link in thhe output.
</li>

<li>Create special functions to generate org tables and figures.
</li>

<li>Create some other functions to generate some blocks and elements.
</li>
</ol>

<p>
Then we could just import the library in our Python scripts (or add it as a prologue) and get this nice functionality. You can find the code for this here:
</p>

<p>
<a href="https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py">https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py</a> 
</p>

<p>
Finally, it seems like a good idea to specify that we want our results to be an org drawer. This makes the figures/tables export, and allows us to generate math and other markup in our programs. That has the downside of making exported results not be in the "verbatim" markup I am used to, but that may be solvable in other ways. We can make the org drawer output the default like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> org-babel-default-header-args:python
      (cons '(<span style="color: #006FE0;">:results</span> . <span style="color: #008000;">"output org drawer replace"</span>)
            (assq-delete-all <span style="color: #006FE0;">:results</span> org-babel-default-header-args)))
</pre>
</div>

<p>
With these, using Python blocks in org-mode gets quite a bit better!
</p>

<p>
Here is the first example, with savefig. I have the savefig function return the link, so we have to print it. We use this feature later. The figure is automatically inserted to the buffer. Like magic!
</p>

<p>
Here is a fun figure from <a href="http://matplotlib.org/xkcd/examples/pie_and_polar_charts/polar_scatter_demo.html">http://matplotlib.org/xkcd/examples/pie_and_polar_charts/polar_scatter_demo.html</a> 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.xkcd()

<span style="color: #BA36A5;">N</span> = 150
<span style="color: #BA36A5;">r</span> = 2 * np.random.rand(N)
<span style="color: #BA36A5;">theta</span> = 2 * np.pi * np.random.rand(N)
<span style="color: #BA36A5;">area</span> = 200 * r**2 * np.random.rand(N)
<span style="color: #BA36A5;">colors</span> = theta

<span style="color: #BA36A5;">ax</span> = plt.subplot(111, polar=<span style="color: #D0372D;">True</span>)
<span style="color: #BA36A5;">c</span> = plt.scatter(theta, r, c=colors, s=area, cmap=plt.cm.hsv)
c.set_alpha(0.75)

<span style="color: #0000FF;">print</span>(plt.savefig(<span style="color: #008000;">'test.png'</span>))
</pre>
</div>


<div class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/test.png"> 
</p>
</div>

<p>
How about another example with show. This just prints the link directly. It seems to make sense to do it that way. This is from <a href="http://matplotlib.org/xkcd/examples/showcase/xkcd.html">http://matplotlib.org/xkcd/examples/showcase/xkcd.html</a> .
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

<span style="color: #0000FF;">from</span> matplotlib <span style="color: #0000FF;">import</span> pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

plt.xkcd()

<span style="color: #BA36A5;">fig</span> = plt.figure()
<span style="color: #BA36A5;">ax</span> = fig.add_subplot(1, 1, 1)
ax.spines[<span style="color: #008000;">'right'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.spines[<span style="color: #008000;">'top'</span>].set_color(<span style="color: #008000;">'none'</span>)
plt.xticks([])
plt.yticks([])
ax.set_ylim([-30, 10])

<span style="color: #BA36A5;">data</span> = np.ones(100)
<span style="color: #BA36A5;">data</span>[70:] -= np.arange(30)

plt.annotate(
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'THE DAY I REALIZED\nI COULD COOK BACON\nWHENEVER I WANTED'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xy=(70, 1), arrowprops=<span style="color: #006FE0;">dict</span>(arrowstyle=<span style="color: #008000;">'-&gt;'</span>), xytext=(15, -10))

plt.plot(data)

plt.xlabel(<span style="color: #008000;">'time'</span>)
plt.ylabel(<span style="color: #008000;">'my overall health'</span>)
plt.show()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">An intermediate result</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Some intermediate result for x - 4 = 6:'</span>)
<span style="color: #BA36A5;">x</span> = 6 + 4
org.fixed_width(<span style="color: #008000;">'x = {}'</span>.<span style="color: #006FE0;">format</span>(x))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">And another figure</span>
<span style="color: #BA36A5;">fig</span> = plt.figure()
<span style="color: #BA36A5;">ax</span> = fig.add_subplot(1, 1, 1)
ax.bar([-0.125, 1.0-0.125], [0, 100], 0.25)
ax.spines[<span style="color: #008000;">'right'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.spines[<span style="color: #008000;">'top'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.xaxis.set_ticks_position(<span style="color: #008000;">'bottom'</span>)
ax.set_xticks([0, 1])
ax.set_xlim([-0.5, 1.5])
ax.set_ylim([0, 110])
ax.set_xticklabels([<span style="color: #008000;">'CONFIRMED BY\nEXPERIMENT'</span>, <span style="color: #008000;">'REFUTED BY\nEXPERIMENT'</span>])
plt.yticks([])

plt.title(<span style="color: #008000;">"CLAIMS OF SUPERNATURAL POWERS"</span>)

plt.show()
</pre>
</div>

<p>
<img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/56bc77cfebd90f8a1cb22421c1c4f2c4a05fedeb.png"> 
Some intermediate result for x - 4 = 6:
</p>
<pre class="example">
x = 10
</pre>

<div class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/2daee706d3b906a25914a6ca975906047af7fa35.png"> 
</p>
</div>

<p>
See, the figures show where they belong, with intermediate results that have some formatting, and they export correctly. Nice.
</p>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> A Figure from Python</h2>
<div class="outline-text-2" id="text-1">
<p>
It has been a long desire of mine to generate full figures with captions from code blocks, and to get them where I want like this one:
</p>


<div id="fig:1" class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/smarts.png"> 
</p>
<p><span class="figure-number">Figure 3:</span> An italicized <i>histogram</i> of 10000 points</p>
</div>

<p>
Here is the code to generate the full figure. Note we use the output of savefig as the filename. That lets us save some intermediate variable construction. That seems nice.
</p>

<div class="org-src-container">

<pre class="src src-python" id="fig-1"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.xkcd()

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.mlab <span style="color: #0000FF;">as</span> mlab
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">example data</span>
<span style="color: #BA36A5;">mu</span> = 100 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">mean of distribution</span>
<span style="color: #BA36A5;">sigma</span> = 15 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">standard deviation of distribution</span>
<span style="color: #BA36A5;">x</span> = mu + sigma * np.random.randn(10000)

<span style="color: #BA36A5;">num_bins</span> = 50
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the histogram of the data</span>
<span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">bins</span>, <span style="color: #BA36A5;">patches</span> = plt.hist(x, num_bins, normed=1, facecolor=<span style="color: #008000;">'green'</span>, alpha=0.5)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">add a 'best fit' line</span>
<span style="color: #BA36A5;">y</span> = mlab.normpdf(bins, mu, sigma)
plt.plot(bins, y, <span style="color: #008000;">'r--'</span>)
plt.xlabel(<span style="color: #008000;">'Smarts'</span>)
plt.ylabel(<span style="color: #008000;">'Probability'</span>)
plt.title(r<span style="color: #008000;">'Histogram of IQ: $\mu=100$, $\sigma=15$'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Tweak spacing to prevent clipping of ylabel</span>
plt.subplots_adjust(left=0.15)

org.figure(plt.savefig(<span style="color: #008000;">'smarts.png'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  label=<span style="color: #008000;">'fig:1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  caption=<span style="color: #008000;">'An italicized /histogram/ of {} points'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">len</span>(x)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  attributes=[(<span style="color: #008000;">'LATEX'</span>, <span style="color: #008000;">':width 3in'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (<span style="color: #008000;">'HTML'</span>, <span style="color: #008000;">':width 300'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (<span style="color: #008000;">'ORG'</span>, <span style="color: #008000;">':width 300'</span>)])
</pre>
</div>

<p>
That is pretty awesome. You cannot put figures in more than one place like this, and you might not want to mix results with this, but it is still pretty awesome!
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> An example table.</h2>
<div class="outline-text-2" id="text-2">
<p>
Finally, I have wanted the same thing for tables. Here is the resulting table.
</p>

<table id="table-1" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Dependence of the energy on the encut value.</caption>

<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">ENCUT</th>
<th scope="col" class="right">Energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">100</td>
<td class="right">11.233</td>
</tr>

<tr>
<td class="right">200</td>
<td class="right">21.233</td>
</tr>

<tr>
<td class="right">300</td>
<td class="right">31.233</td>
</tr>

<tr>
<td class="right">400</td>
<td class="right">41.233</td>
</tr>

<tr>
<td class="right">500</td>
<td class="right">51.233</td>
</tr>
</tbody>
</table>

<p>
Here is the code block that generated it.
</p>

<div class="org-src-container">

<pre class="src src-python" id="table-1"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

<span style="color: #BA36A5;">data</span> = [[<span style="color: #008000;">'&lt;5&gt;'</span>, <span style="color: #008000;">'&lt;11&gt;'</span>],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Column aligners</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [<span style="color: #008000;">'ENCUT'</span>, <span style="color: #008000;">'Energy (eV)'</span>],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #D0372D;">None</span>]

<span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> [100, 200, 300, 400, 500]:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">data</span> += [[encut, 1.233 + 0.1 * encut]]

org.table(data,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> name=<span style="color: #008000;">'table-1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> caption=<span style="color: #008000;">'Dependence of the energy on the encut value.'</span>)
</pre>
</div>


<p>
The only obvious improvement on this is similar to getting images to redisplay after running a code block, it might be nice to reformat tables to make sure they are pretty looking. Otherwise this is good.
</p>


<p>
Let's go ahead and try that. Here we narrow down to the results, and align the tables in that region.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-align-visible-tables</span> ()
  <span style="color: #036A07;">"Align all the tables in the results."</span>
  (<span style="color: #0000FF;">let</span> ((location (org-babel-where-is-src-block-result)) start)
    (<span style="color: #0000FF;">when</span> location
      (<span style="color: #0000FF;">setq</span> start (- location 1))
      (<span style="color: #0000FF;">save-restriction</span>
        (<span style="color: #0000FF;">save-excursion</span>
          (goto-char location) (forward-line 1)
          (narrow-to-region start (org-babel-result-end))
          (goto-char (point-min))
          (<span style="color: #0000FF;">while</span> (re-search-forward org-table-any-line-regexp nil t)
            (<span style="color: #0000FF;">save-excursion</span> (org-table-align))
            (<span style="color: #0000FF;">or</span> (looking-at org-table-line-regexp)
                (forward-char 1)))
          (re-search-forward org-table-any-border-regexp nil 1))))))

(add-hook 'org-babel-after-execute-hook
          (<span style="color: #0000FF;">lambda</span> () (org-align-visible-tables)))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">lambda</td>
<td class="left">nil</td>
<td class="left">(org-align-visible-tables)</td>
</tr>

<tr>
<td class="left">lambda</td>
<td class="left">nil</td>
<td class="left">(org-refresh-images)</td>
</tr>
</tbody>
</table>

<p>
And that seems to solve that problem now too!
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Miscellaneous outputs</h2>
<div class="outline-text-2" id="text-3">
<p>
Here are some examples of getting org-output from the pycse.orgmode module.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

org.verbatim(<span style="color: #008000;">'One liner verbatim'</span>)

org.verbatim(<span style="color: #008000;">'''multiline</span>
<span style="color: #008000;">output</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">  with indentation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">  at a few levels</span>
<span style="color: #008000;">that is verbatim.'''</span>)

org.fixed_width(<span style="color: #008000;">'your basic result'</span>)

org.fixed_width(<span style="color: #008000;">'''your</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;"> basic</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   result</span>
<span style="color: #008000;">on a few lines.'''</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A latex block</span>
org.latex(<span style="color: #008000;">'\(e^{i\pi} - 1 = 0\)'</span>)

org.org(r<span style="color: #008000;">'The equation is \(E = h \nu\).'</span>)
</pre>
</div>
<p>
<code>One liner</code>
</p>

<pre class="example">
multiline
output
   with indentation
       at a few levels
that is verbatim.
</pre>

<pre class="example">
your basic result
your
  basic
    result
on a few lines.
</pre>

<p>
The equation is \(E = h \nu\).
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Summary</h2>
<div class="outline-text-2" id="text-4">
<p>
This looks promising to me. There are a few things to get used to, like always having org output, and some minor differences in making figures. On the whole this looks like a big improvement though! I look forward to working with it more.</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/29/Expanding-orgmode.py-to-get-better-org-python-integration.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>When in python do as Pythonistas unless...</title>
      <link>http://jkitchin.github.io/blog/2016/05/06/When-in-python-do-as-Pythonistas-unless</link>
      <pubDate>Fri, 06 May 2016 19:46:51 EDT</pubDate>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">P8CGURcx2E2U9Ho9DjkpQrt9yf4=</guid>
      <description>When in python do as Pythonistas unless...</description>
      <content:encoded><![CDATA[



<p>
Many lisps have a when/unless conditional syntax that works like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">when</span> t (print <span style="color: #008000;">"when evaluated"</span>))

(<span style="color: #0000FF;">unless</span> nil (print <span style="color: #008000;">"unless evaluated"</span>))
</pre>
</div>

<pre class="example">
"when evaluated"

"unless evaluated"
</pre>

<p>
Those are actually just macros that expand to the more verbose if function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(macroexpand '(unless nil (print <span style="color: #008000;">"unless evaluated"</span>)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">if</span> nil nil
  (print <span style="color: #008000;">"unless evaluated"</span>))
</pre>
</div>

<p>
In Python, we only have this syntax for this kind of construct:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">if</span> <span style="color: #D0372D;">True</span>: <span style="color: #0000FF;">print</span> <span style="color: #008000;">"when equivalent"</span>

<span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">False</span>: <span style="color: #0000FF;">print</span> <span style="color: #008000;">"unless equivalent"</span>
</pre>
</div>

<pre class="example">
when equivalent
unless equivalent
</pre>

<p>
I thought is would be fun to get as close as possible to the lisp syntax in Python. It is not that easy though. The benefit of a macro is we do not evaluate the arguments until they need to be evaluated. In Python, all arguments of functions are immediately evaluated.
</p>

<p>
One way to avoid this is to put code inside a function. Then it will not be executed until the function is called. So, here is an example of how to get an unless function in Python that conditionally evaluates a function.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">unless</span>(condition, f):
    <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> condition:
        <span style="color: #0000FF;">return</span> f()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>():
    <span style="color: #0000FF;">return</span> <span style="color: #008000;">"executed. Condition was not true."</span>


<span style="color: #0000FF;">print</span> unless(1 &gt; 0, func)

<span style="color: #0000FF;">print</span> unless(1 &lt; 0, func)
</pre>
</div>

<pre class="example">
None
executed. Condition was not true.
</pre>

<p>
That is close, but requires us to wrap our code in a function. There does not seem to be any alternative though. It thought maybe a context manager could be used, but there does not seem to be a way to bypass the execution of the code (<a href="https://www.python.org/dev/peps/pep-0377/">https://www.python.org/dev/peps/pep-0377/</a> ). Still, it might be a useful way to change how to think about doing some things differently in Python.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/06/When-in-python-do-as-Pythonistas-unless....org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Automatic decorating of class methods to run them in a context</title>
      <link>http://jkitchin.github.io/blog/2016/05/01/Automatic-decorating-of-class-methods-to-run-them-in-a-context</link>
      <pubDate>Sun, 01 May 2016 09:16:29 EDT</pubDate>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">8cMqUEuZeisFhTdywh3H5cCl8CY=</guid>
      <description>Automatic decorating of class methods to run them in a context</description>
      <content:encoded><![CDATA[



<p>
We <a href="http://kitchingroup.cheme.cmu.edu/blog/2016/04/28/Managing-contexts-Python-vs-hy/">previously examined</a> approaches to running code in a context. With hy, we even managed to remove the need for a with statement through the use of a macro that expanded behind the scenes to manage the context. In our jasp code, we frequently need a context manager that temporarily changes the working directory to run some code, then changes back. The use of the context manager was a design decision to avoid decorating every single function. Why? There are a lot of functions that need decorating, and they are spread over a lot of files. Not all of the entries from the next block are methods, but most of them are.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> jasp <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">c</span> = Vasp()
<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">dir</span>(c))
</pre>
</div>

<pre class="example">
['__doc__', '__init__', '__module__', '__repr__', '__str__', 'add_to_db', 'archive', 'atoms', 'bader', 'bool_params', 'calculate', 'calculation_required', 'check_state', 'chgsum', 'clean', 'clone', 'create_metadata', 'dict', 'dict_params', 'exp_params', 'float_params', 'get_atoms', 'get_beefens', 'get_bz_k_points', 'get_charge_density', 'get_default_number_of_electrons', 'get_dipole_moment', 'get_eigenvalues', 'get_elapsed_time', 'get_electronic_temperature', 'get_elf', 'get_energy_components', 'get_fermi_level', 'get_forces', 'get_ibz_k_points', 'get_ibz_kpoints', 'get_infrared_intensities', 'get_k_point_weights', 'get_local_potential', 'get_magnetic_moment', 'get_magnetic_moments', 'get_name', 'get_nearest_neighbor_table', 'get_neb', 'get_nonselfconsistent_energies', 'get_number_of_bands', 'get_number_of_electrons', 'get_number_of_grid_points', 'get_number_of_ionic_steps', 'get_number_of_iterations', 'get_number_of_spins', 'get_occupation_numbers', 'get_orbital_occupations', 'get_potential_energy', 'get_property', 'get_pseudo_density', 'get_pseudo_wavefunction', 'get_pseudopotentials', 'get_required_memory', 'get_spin_polarized', 'get_stress', 'get_valence_electrons', 'get_version', 'get_vibrational_frequencies', 'get_vibrational_modes', 'get_xc_functional', 'initialize', 'input_params', 'int_params', 'is_neb', 'job_in_queue', 'json', 'list_params', 'name', 'nbands', 'org', 'output_template', 'plot_neb', 'positions', 'post_run_hooks', 'prepare_input_files', 'pretty_json', 'python', 'read', 'read_convergence', 'read_default_number_of_electrons', 'read_dipole', 'read_eigenvalues', 'read_electronic_temperature', 'read_energy', 'read_fermi', 'read_forces', 'read_ibz_kpoints', 'read_incar', 'read_k_point_weights', 'read_kpoints', 'read_ldau', 'read_magnetic_moment', 'read_magnetic_moments', 'read_metadata', 'read_nbands', 'read_number_of_electrons', 'read_number_of_iterations', 'read_occupation_numbers', 'read_outcar', 'read_potcar', 'read_relaxed', 'read_stress', 'read_version', 'read_vib_freq', 'register_post_run_hook', 'register_pre_run_hook', 'restart', 'restart_load', 'results', 'run', 'run_counts', 'set', 'set_atoms', 'set_nbands', 'set_results', 'special_params', 'string_params', 'strip', 'strip_warnings', 'todict', 'track_output', 'update', 'write_incar', 'write_kpoints', 'write_metadata', 'write_potcar', 'write_sort_file', 'xml']
</pre>

<p>
The use of a context manager is really useful for a single calculation, and it saves us a lot of boilerplate code to manage changing directories. It limits us though for looping through calculations. We are stuck with traditional for loops that have the with statement embedded in them. We also cannot get too functional, e.g. with list comprehension.
</p>

<p>
In other words, this is ok:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">E</span> = []
<span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> np.linspace(1, 1.5):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms(...,d)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">with</span> jasp(<span style="color: #008000;">'calculated-name-{}'</span>.<span style="color: #006FE0;">format</span>(d),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ...,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms) <span style="color: #0000FF;">as</span> calc:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   E.append(atoms.get_potential_energy())
</pre>
</div>

<p>
But this code is not possible:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">bond_lengths</span> = np.linspace(1, 1.5)

<span style="color: #BA36A5;">A</span> = [Atoms(...,d) <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths]

<span style="color: #BA36A5;">calcs</span> = [JASP(<span style="color: #008000;">'calculated-name-{}'</span>.<span style="color: #006FE0;">format</span>(d),...,atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> d, atoms <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(bond-lengths, A)]

<span style="color: #BA36A5;">E</span> = [atoms.get_potential_energy() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> A]
</pre>
</div>

<p>
It is not legal syntax to embed a with statement inside a list comprehension. The code will not work because to get the potential energy we have to switch into the calculation directory and read it from a file there, then switch back.
</p>

<p>
To make that possible, we need to decorate the class functions so that the right thing happens when needed. I still do not want to decorate each function manually. Although there is a case to make for it, as I mentioned earlier, the functions are all over the place, and numerous. Now is not the time to fix it.
</p>

<p>
Instead, we consider a solution that will automatically decorate class functions for us! Enter the Metaclass. This is a class that modifies how classes are created. The net effect of the code below is our Calculator class now has all functions automatically decorated with a function that changes to the working directory, runs the function, and then ensures we change back even in the event of an exception. This approach is adapted from <a href="http://stackoverflow.com/questions/3467526/attaching-a-decorator-to-all-functions-within-a-class">http://stackoverflow.com/questions/3467526/attaching-a-decorator-to-all-functions-within-a-class</a> .
</p>

<p>
I am pretty sure this is the right way to do this. We cannot simply decorate the functions of ase.calculators.vasp.Vasp because our decorator needs access to the directory defined in a <i>class instance</i>. That is what the <span class="underline"><span class="underline">init</span></span> method of the metaclass enables.
</p>

<p>
We will put this code into a library called meta_calculator.py for reuse in later examples.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> os
<span style="color: #0000FF;">import</span> types

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">WithCurrentDirectory</span>(<span style="color: #006FE0;">type</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #036A07;">"""Metaclass that decorates all of its methods except __init__."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__new__</span>(cls, name, bases, attrs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>(WithCurrentDirectory, cls).__new__(cls, name, bases, attrs)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(cls, name, bases, attrs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"""Decorate all the methods of the class instance with the classmethod cd.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> We skip __init__ because that is where the attributes are actually set.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> It is an error to access them before they are set.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">for</span> attr_name, attr_value <span style="color: #0000FF;">in</span> attrs.iteritems():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> attr_name != <span style="color: #008000;">'__init__'</span> <span style="color: #0000FF;">and</span> <span style="color: #006FE0;">isinstance</span>(attr_value, types.FunctionType):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">setattr</span>(cls, attr_name, cls.cd(attr_value))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #6434A3;">@classmethod</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">cd</span>(cls, func):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"""Decorator to temporarily run cls.func in the directory stored in cls.wd.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> The working directory is restored to the original directory afterwards.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">def</span> <span style="color: #006699;">wrapper</span>(<span style="color: #0000FF;">self</span>, *args, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'\nRunning {}'</span>.<span style="color: #006FE0;">format</span>(func.<span style="color: #006FE0;">__name__</span>))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"Started in {}"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>os.chdir(<span style="color: #0000FF;">self</span>.wd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"  Entered {}"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">try</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">result</span> = func(<span style="color: #0000FF;">self</span>, *args, **kwargs)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  {}'</span>.<span style="color: #006FE0;">format</span>(result))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> result
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span>, e:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is where you would use an exception handling function</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  Caught {}'</span>.<span style="color: #006FE0;">format</span>(e))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">finally</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(<span style="color: #0000FF;">self</span>.owd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"  Exited to {}\n"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> wrapper.<span style="color: #006FE0;">__name__</span> = func.<span style="color: #006FE0;">__name__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> wrapper.<span style="color: #006FE0;">__doc__</span> = func.<span style="color: #006FE0;">__doc__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> wrapper


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Calculator</span>(<span style="color: #006FE0;">object</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #036A07;">"""Class we use for a calculator.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  Every method is decorated by the metaclass so it runs in the working</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  directory defined by the class instance.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  """</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #BA36A5;">__metaclass__</span> = WithCurrentDirectory

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, wd, verbose=<span style="color: #D0372D;">False</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.owd = os.getcwd()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.wd = wd
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.verbose = verbose
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> os.path.isdir(wd):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>os.makedirs(wd)


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">create_input</span>(<span style="color: #0000FF;">self</span>, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'INCAR'</span>, <span style="color: #008000;">'w'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> key, val <span style="color: #0000FF;">in</span> kwargs.iteritems():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.write(<span style="color: #008000;">'{} = {}\n'</span>.<span style="color: #006FE0;">format</span>(key, val))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">exc</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"This raises an exception to see what happens"</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> 1 / 0

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">read_input</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'INCAR'</span>, <span style="color: #008000;">'r'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">return</span> f.read()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> <span style="color: #008000;">'In {}. Contains: {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> os.listdir(<span style="color: #008000;">'.'</span>))
</pre>
</div>

<p>
Here is how we might use it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> meta_calculator <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">c</span> = Calculator(<span style="color: #008000;">'/tmp/calc-1'</span>, verbose=<span style="color: #D0372D;">True</span>)
<span style="color: #0000FF;">print</span> c.create_input(xc=<span style="color: #008000;">'PBE'</span>, encut=450)
<span style="color: #0000FF;">print</span> c.read_input()
<span style="color: #0000FF;">print</span> c.exc()
<span style="color: #0000FF;">print</span> c
</pre>
</div>
<pre class="example">
Running create_input
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  None
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

None

Running read_input
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  xc = PBE
encut = 450

  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

xc = PBE
encut = 450


Running exc
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  Caught integer division or modulo by zero
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

None

Running __str__
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  In /private/tmp/calc-1. Contains: ['INCAR']
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

In /private/tmp/calc-1. Contains: ['INCAR']
</pre>

<p>
As we can see, in each function call, we evidently do change into the path that /tmp/calc-1 points to (it is apparently /private/tmp on Mac OSX), runs the method, and then changes back out, even when exceptions occur.
</p>

<p>
Here is a functional approach to using our new calculator.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> meta_calculator <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">encuts</span> = [100, 200, 300, 400]
<span style="color: #BA36A5;">calcs</span> = [Calculator(<span style="color: #008000;">'encut-{}'</span>.<span style="color: #006FE0;">format</span>(encut)) <span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> encuts]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">list-comprehension for the side-effect</span>
[calc.create_input(encut=encut) <span style="color: #0000FF;">for</span> calc,encut <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(calcs, encuts)]

<span style="color: #BA36A5;">inputs</span> = [calc.read_input() <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]

<span style="color: #0000FF;">print</span>(inputs)
<span style="color: #0000FF;">print</span>([calc.wd <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs])
</pre>
</div>
<pre class="example">
['encut = 100\n', 'encut = 200\n', 'encut = 300\n', 'encut = 400\n']
['encut-100', 'encut-200', 'encut-300', 'encut-400']
</pre>

<p>
Sweet. And here is our evidence that the directories got created and have the files in them.
</p>

<div class="org-src-container">

<pre class="src src-sh">find . -type f -print | grep <span style="color: #008000;">"encut-[1-4]00"</span> | xargs -n 1 -I {} -i bash -c <span style="color: #008000;">'echo {}; cat {}; echo'</span>
</pre>
</div>
<pre class="example">
./encut-100/INCAR
encut = 100

./encut-200/INCAR
encut = 200

./encut-300/INCAR
encut = 300

./encut-400/INCAR
encut = 400
</pre>

<p>
This looks like another winner that will be making its way into <a href="https://github.com/jkitchin/jasp">jasp</a> soon. I guess it will require at least some minor surgery on a class in ase.calculators.vasp. It might be time to move a copy of it all the way into jasp.</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/01/Automatic-decorating-of-class-methods-to-run-them-in-a-context.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Another approach to docstrings and validation of args and kwargs in Python</title>
      <link>http://jkitchin.github.io/blog/2016/04/30/Another-approach-to-docstrings-and-validation-of-args-and-kwargs-in-Python</link>
      <pubDate>Sat, 30 Apr 2016 10:22:30 EDT</pubDate>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">Rsk5tfvPgInf2xYf5XsDeSJqW34=</guid>
      <description>Another approach to docstrings and validation of args and kwargs in Python</description>
      <content:encoded><![CDATA[



<p>
We have been <a href="http://kitchingroup.cheme.cmu.edu/blog/2016/04/29/Enough-with-the-hyperbole-hy-does-things-that-are-not-as-easy-in-Python/">exploring various ways</a> to add documentation and validation to arbitrary arguments that our molecular simulation codes use. In our previous we derived a method where we created functions that provide docstrings, and validate the input. One issue we had was the duplication of keywords and function names. Here we consider an approach that allows this kind of syntax:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">calc</span> = Calculator(<span style="color: #008000;">'/tmp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut(400),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc(<span style="color: #008000;">'PBE'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> generic(<span style="color: #008000;">'kpts'</span>, [1, 1, 1]))
</pre>
</div>

<p>
Those are regular *args, not **kwargs.
</p>

<p>
Compare this to:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">calc</span> = Calculator(<span style="color: #008000;">'/tmp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=encut(400),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=xc(<span style="color: #008000;">'PBE'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=generic(<span style="color: #008000;">'kpts'</span>, [1, 1, 1]))
</pre>
</div>

<p>
where those are kwargs. The duplication of the keywords is what we aim to eliminate, because 1) they are redundant, 2) why type things twice?
</p>

<p>
Here we work out an approach with *args that avoids the duplication. We use the same kind of validation functions as before, but we will decorate each one so it returns a tuple of (key, value), where key is based on the function name. This is so we don't have to duplicate the function name ourselves; we let the decorator do it for us. Then, in our Calculator class <span class="underline"><span class="underline">init</span></span> function, we use this tuple to assign the values to self.key as the prototypical way to handle the *args. Other setter functions could also be used.
</p>

<p>
Here is the template for this approach.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">input</span>(func):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""Input decorator to convert a validation function to input function."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">inner</span>(*args, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">res</span> = func.<span style="color: #006FE0;">__name__</span>, func(*args, **kwargs)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{} validated to {}'</span>.<span style="color: #006FE0;">format</span>(func.<span style="color: #006FE0;">__name__</span>, res))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> res
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">magic incantations to make the decorated function look like the old one.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   inner.<span style="color: #006FE0;">__name__</span> = func.<span style="color: #006FE0;">__name__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   inner.<span style="color: #006FE0;">__doc__</span> = func.<span style="color: #006FE0;">__doc__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> inner

<span style="color: #6434A3;">@input</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">encut</span>(cutoff):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"Planewave cutoff in eV."</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> <span style="color: #006FE0;">isinstance</span>(cutoff, <span style="color: #006FE0;">int</span>) <span style="color: #0000FF;">and</span> (cutoff &gt; 0)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> cutoff

<span style="color: #6434A3;">@input</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">xc</span>(s):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""Exchange-correlation functional.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   Should be 'PBE' or 'LDA'</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> <span style="color: #006FE0;">isinstance</span>(s, <span style="color: #006FE0;">str</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> s <span style="color: #0000FF;">in</span> [<span style="color: #008000;">'PBE'</span>, <span style="color: #008000;">'LDA'</span>]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> s

<span style="color: #0000FF;">def</span> <span style="color: #006699;">generic</span>(key, val):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""Generic function with no validation.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   Use this for other key,val inputs not yet written.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> (key, val)

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Calculator</span>(<span style="color: #006FE0;">object</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, wd, *args):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""each arg should be of the form (attr, val)."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">self</span>.wd = wd
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">self</span>.args = args
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> attr, val <span style="color: #0000FF;">in</span> args:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">setattr</span>(<span style="color: #0000FF;">self</span>, attr, val)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> <span style="color: #008000;">'\n'</span>.join([<span style="color: #008000;">'{}'</span>.<span style="color: #006FE0;">format</span>(x) <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> <span style="color: #0000FF;">self</span>.args])

<span style="color: #8D8D84;">##################################################################</span>

<span style="color: #BA36A5;">calc</span> = Calculator(<span style="color: #008000;">'/tmp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut(400),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc(<span style="color: #008000;">'PBE'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> generic(<span style="color: #008000;">'kpts'</span>, [1, 1, 1]))

<span style="color: #0000FF;">print</span>(calc)

<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">help</span>(encut))
</pre>
</div>

<pre class="example">
encut validated to ('encut', 400)
xc validated to ('xc', 'PBE')
('encut', 400)
('xc', 'PBE')
('kpts', [1, 1, 1])
Help on function encut in module __main__:

encut(*args, **kwargs)
    Planewave cutoff in eV.

None
</pre>

<p>
This approach obviously works. I don't think I like the syntax as much, although in most python editors, it should directly give access to the docstrings of the functions. This is pretty explicit in what is happening, which is an advantage. Compare this to the following approach, which uses our traditional kwarg syntax, with dynamic, but hidden validation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">encut</span>(cutoff):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"Planewave cutoff in eV."</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> <span style="color: #006FE0;">isinstance</span>(cutoff, <span style="color: #006FE0;">int</span>) <span style="color: #0000FF;">and</span> (cutoff &gt; 0)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> cutoff

<span style="color: #0000FF;">def</span> <span style="color: #006699;">xc</span>(s):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""Exchange-correlation functional.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   Should be 'PBE' or 'LDA'.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> <span style="color: #006FE0;">isinstance</span>(s, <span style="color: #006FE0;">str</span>), <span style="color: #008000;">"xc should be a string"</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">assert</span> s <span style="color: #0000FF;">in</span> [<span style="color: #008000;">'PBE'</span>, <span style="color: #008000;">'LDA'</span>], <span style="color: #008000;">"xc should be 'PBE' or 'LDA'"</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> s


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Calculator</span>(<span style="color: #006FE0;">object</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, wd, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""each arg should be of the form (attr, val)."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">self</span>.wd = wd

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> kwarg, val <span style="color: #0000FF;">in</span> kwargs.iteritems():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f</span> = <span style="color: #006FE0;">globals</span>().get(kwarg, <span style="color: #D0372D;">None</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> f <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{} evaluated to {}'</span>.<span style="color: #006FE0;">format</span>(kwarg, f(val)))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'No validation for {}'</span>.<span style="color: #006FE0;">format</span>(kwarg))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">setattr</span>(<span style="color: #0000FF;">self</span>, kwarg, val)

<span style="color: #8D8D84;">##################################################################</span>

<span style="color: #BA36A5;">calc</span> = Calculator(<span style="color: #008000;">'/tmp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[1, 1, 1])

<span style="color: #0000FF;">print</span>(calc.encut)
<span style="color: #006FE0;">help</span>(xc)
</pre>
</div>
<pre class="example">
xc evaluated to PBE
No validation for kpts
encut evaluated to 400
400
Help on function xc in module __main__:

xc(s)
    Exchange-correlation functional.

    Should be 'PBE' or 'LDA'.
</pre>

<p>
The benefit of this approach is no change in the syntax we are used to. We still get access to docstrings via tools like pydoc. It should not be too hard to get helpful tooltips in Emacs for this, using pydoc to access the docstrings. This might be the winner.
</p>

<p>
It is up for debate if we should use assert or Exceptions. If anyone uses python with -O the assert statements are ignored. That might not be desirable though. Maybe it would be better to use Exceptions, with a user customizable variable that determines if validation is performed.</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/30/Another-approach-to-docstrings-and-validation-of-args-and-kwargs-in-Python.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Enough with the hyperbole - hy does things that are not as easy in Python</title>
      <link>http://jkitchin.github.io/blog/2016/04/29/Enough-with-the-hyperbole-hy-does-things-that-are-not-as-easy-in-Python</link>
      <pubDate>Fri, 29 Apr 2016 14:45:54 EDT</pubDate>
      <category><![CDATA[hylang]]></category>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">AlLJjsPo6vkQxkw6fZR4YP-NR98=</guid>
      <description>Enough with the hyperbole - hy does things that are not as easy in Python</description>
      <content:encoded><![CDATA[



<p>
We run a lot of molecular simulations using Python. Here is a typical script we would use. It creates an instance of a calculator inside a context manager.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> jasp <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>,[0,   0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>,[1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   cell=(6., 6., 6.))

<span style="color: #0000FF;">with</span> jasp(<span style="color: #008000;">'molecules/simple-co'</span>, <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the exchange-correlation functional</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nbands=6,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of bands</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">planewave cutoff</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=1,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Methfessel-Paxton smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> sigma=0.01,<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">very small smearing factor for a molecule</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=co) <span style="color: #0000FF;">as</span> calc:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(co.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> co.get_forces()
</pre>
</div>

<p>
This basic approach has served us for more than a decade! Still, there are things about it that bug me. Most significantly is the arbitrary keyword args. We keep a list of legitimate kwargs in the module, but there is no documentation or validation to go with them that is accessible to users (short of reading the code). There are well over 100 kwargs that are possible, so documenting them in the <span class="underline"><span class="underline">init</span></span> docstring is not that useful (we did it once, see <a href="https://gitlab.com/ase/ase/blob/master/ase/calculators/jacapo/jacapo.py#L143">https://gitlab.com/ase/ase/blob/master/ase/calculators/jacapo/jacapo.py#L143</a> , and it made a really long docstring). Providing validation for these (some can only be integers, floats, specific strings, lists, or dictionaries) is not easy. I did this for another simulation code by providing <a href="https://gitlab.com/ase/ase/blob/master/ase/calculators/jacapo/validate.py">validation functions</a> that could be looked up dynamically by name. I never did come up with a way to provide kwarg specific documentation though.
</p>

<p>
The access to documentation while writing code is becoming increasingly important to me; I don't remember all the kwargs and what values are valid. More importantly, as I teach people how to use these tools, it is not practical to tell them to "read the code". I don't even want to do that while running simulations, I just want to setup the simulation and run it.
</p>

<p>
Today, I had an idea that a macro in hy would allow me to get documentation and validation of these kwargs.
</p>

<p>
The pseudocode would look like this. Each "kwarg" will actually be a function that has a docstring, performs validation, and evaluates to its argument. "vaspm" is a macro that will expand to the calculator with the desired kwargs. We will have to be careful that these function names don't conflict with other function names, but that could be addressed in a variety of ways with namespaces and function names.
</p>

<div class="org-src-container">

<pre class="src src-hy"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">pseudocode of the macro</span>
(<span style="color: #006FE0;">setv</span> calc (vaspm <span style="color: #008000;">"molecules/simple-co"</span>
                  (xc <span style="color: #008000;">"PBE"</span>)
                  (nbands 6)
                  (encut 350)
                  (ismear 1)
                  (sigma 0.01)
                  (atoms co)))
</pre>
</div>

<p>
This would expand to the following block, which is equivalent to what we already do today. In the process of expansion though, we gain docstrings and validation!
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #006FE0;">setv</span> calc (Vasp <span style="color: #008000;">"molecules/simple-co"</span>
                 <span style="color: #D0372D;">:xc</span> <span style="color: #008000;">"PBE"</span>
                 <span style="color: #D0372D;">:nbands</span> 6
                 <span style="color: #D0372D;">:encut</span> 6
                 <span style="color: #D0372D;">:ismear</span> 1
                 <span style="color: #D0372D;">:sigma</span> 0.01
                 <span style="color: #D0372D;">:atoms</span> co))
</pre>
</div>

<p>
Here is a toy implementation that illustrates what the functions are, and how we build up the code from the macro.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">encut</span> [cutoff]
  <span style="color: #008000;">"The planewave cutoff energy in eV."</span>
  (<span style="color: #0000FF;">assert</span> (<span style="color: #006FE0;">integer?</span> cutoff))
  (<span style="color: #0000FF;">assert</span> (<span style="color: #006FE0;">&gt;</span> cutoff 0))
  (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"encut validated"</span>)
  cutoff)

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">xc</span> [exc]
  <span style="color: #008000;">"The exchange correlation functional. Should be a string of PBE or LDA."</span>
  (<span style="color: #0000FF;">assert</span> (<span style="color: #006FE0;">string?</span> exc))
  (<span style="color: #0000FF;">assert</span> (<span style="color: #006FE0;">in</span> exc [<span style="color: #008000;">"PBE"</span> <span style="color: #008000;">"LDA"</span>]))
  (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"exc validated"</span>)
  exc)


(<span style="color: #0000FF;">defclass</span> <span style="color: #6434A3;">Calculator</span> []
  <span style="color: #008000;">"Toy class representing a calculator."</span>
  (<span style="color: #0000FF;">defn</span> <span style="color: #006699;">__init__</span> [self wd <span style="color: #6434A3;">&amp;kwargs</span> kwargs]
    (setattr self <span style="color: #008000;">"wd"</span> wd)
    (<span style="color: #0000FF;">for</span> [key kwargs]
      (setattr self key (<span style="color: #006FE0;">get</span> kwargs key)))))
</pre>
</div>

<p>
We tangle that block to calculator.hy so we can reuse it. First we show the traditional syntax.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[calculator [*]]</span>)

(<span style="color: #006FE0;">setv</span> calc (Calculator <span style="color: #008000;">"some-dir"</span> <span style="color: #D0372D;">:encut</span> 400 <span style="color: #D0372D;">:xc</span> <span style="color: #008000;">"PBE"</span>))

(<span style="color: #006FE0;">print</span> calc.wd)
(<span style="color: #006FE0;">print</span> calc.encut)
(<span style="color: #006FE0;">print</span> calc.xc)
</pre>
</div>
<pre class="example">
some-dir
400
PBE
</pre>

<p>
Note, we can also do this, and get the validation too. It is verbose for my taste, but shows what we need the final code to look like, and incidentally how this would be done in Python too. We just need a macro that expands to this code.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[calculator [*]]</span>)

(<span style="color: #006FE0;">setv</span> calc (Calculator <span style="color: #008000;">"some-dir"</span> <span style="color: #D0372D;">:encut</span> (encut 400) <span style="color: #D0372D;">:xc</span> (xc <span style="color: #008000;">"PBE"</span>)))

(<span style="color: #006FE0;">print</span> calc.wd)
(<span style="color: #006FE0;">print</span> calc.encut)
(<span style="color: #006FE0;">print</span> calc.xc)
</pre>
</div>

<pre class="example">
encut validated
exc validated
some-dir
400
PBE
</pre>

<p>
That is what this macro below does. We build up that code by making a keyword of the function name, and setting it to the value of the form the function is in.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">vaspm</span> [wd <span style="color: #6434A3;">&amp;rest</span> body]
  <span style="color: #036A07;">"Macro to build a Calculator with validation of arguments in BODY"</span>
  (<span style="color: #0000FF;">let</span> [code `(Calculator ~wd)]
    (<span style="color: #0000FF;">for</span> [form body]
      (.append code (<span style="color: #006FE0;">keyword</span> (<span style="color: #006FE0;">name</span> (<span style="color: #006FE0;">car</span> form))))
      (.append code form))
    code))
</pre>
</div>

<p>
Now, lets consider the macro version.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[calculator [*]]</span>)
(<span style="color: #0000FF;">require</span> <span style="color: #006699;">calculator</span>)

(<span style="color: #006FE0;">setv</span> calc (vaspm <span style="color: #008000;">"some-dir"</span> (encut 400) (xc <span style="color: #008000;">"PBE"</span>)))
(<span style="color: #006FE0;">print</span> calc.wd)
(<span style="color: #006FE0;">print</span> calc.encut)
(<span style="color: #006FE0;">print</span> calc.xc)

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">proof we can get to the encut docstring!</span>
(help encut)
</pre>
</div>

<pre class="example">
encut validated
exc validated
some-dir
400
PBE
Help on function encut in module calculator:

encut(cutoff)
    The planewave cutoff energy in eV.
</pre>

<p>
Sweet. The macro allows us to simplify our notation to be approximately the same as the original function, but with validation and docstring availability. Here is a variation of the macro that even uses keywords and builds the validation in from the keyword. It is not clear we can access the docstrings so easily here (ok, we can build an eldoc function that works either way, but the function method above is "more native").
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[calculator [*]]</span>)
(<span style="color: #0000FF;">require</span> <span style="color: #006699;">calculator</span>)


(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">vasp2</span> [wd <span style="color: #6434A3;">&amp;rest</span> kwargs]
  (<span style="color: #0000FF;">let</span> [code `(Calculator ~wd)]
    (<span style="color: #0000FF;">for</span> [x (<span style="color: #006FE0;">range</span>   0 (len kwargs) 2)]
      (<span style="color: #0000FF;">let</span> [kw (<span style="color: #006FE0;">nth</span> kwargs x)
            val (<span style="color: #006FE0;">nth</span> kwargs (<span style="color: #006FE0;">+</span> 1 x))]
        (.append code kw)
        (.append code `(~(HySymbol (<span style="color: #006FE0;">name</span> kw)) ~val))))
    code))

(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">macroexpand</span> '(vasp2 <span style="color: #008000;">"/tmp"</span> <span style="color: #D0372D;">:encut</span> 1 <span style="color: #D0372D;">:xc</span> <span style="color: #008000;">"PBE"</span>)))

(<span style="color: #006FE0;">setv</span> calc (vasp2 <span style="color: #008000;">"some-dir"</span>
                  <span style="color: #D0372D;">:encut</span> 400
                  <span style="color: #D0372D;">:xc</span> <span style="color: #008000;">"PBE"</span>))
(<span style="color: #006FE0;">print</span> calc.wd)
(<span style="color: #006FE0;">print</span> calc.encut)
(<span style="color: #006FE0;">print</span> calc.xc)
</pre>
</div>
<pre class="example">
(u'Calculator' u'/tmp' u'\ufdd0:encut' (u'encut' 1L) u'\ufdd0:xc' (u'xc' u'PBE'))
encut validated
exc validated
some-dir
400
PBE
</pre>

<p>
To summarize here, we have looked at some ways to incorporate validation and documentation into kwargs. There are certainly ways to do this in Python, using these auxiliary functions. In fact we use them in hy too. We could build the validation into a Python <span class="underline"><span class="underline">init</span></span> function too, using dynamic lookup of the function names, and evaluation of the functions. The macro features of hy give different opportunities for this, and different syntactical sugars to work with. The hy approach leads to less duplication (e.g. only a keyword, not a keyword and a function name that are the same), which will lead to fewer mistakes of the type xc=xd(something). Overall, interesting differences to contemplate.
</p>

<p>
From a developer point of view there is the burden of writing all the validation functions, but the payoff is access to documentation and optionally, validation. Also, no kwargs that are not allowed will work. Right now, with **kwargs, they might silently fail.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/29/Enough-with-the-hyperbole---hy-does-things-that-are-not-as-easy-in-Python.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Managing contexts - Python vs hy</title>
      <link>http://jkitchin.github.io/blog/2016/04/28/Managing-contexts-Python-vs-hy</link>
      <pubDate>Thu, 28 Apr 2016 14:32:40 EDT</pubDate>
      <category><![CDATA[hylang]]></category>
      <category><![CDATA[python]]></category>
      <guid isPermaLink="false">p3sWsg64KLQplQeo8vt5xxcHh2A=</guid>
      <description>Managing contexts - Python vs hy</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. a try/except/finally approach</a></li>
<li><a href="#sec-2">2. A Python context manager</a></li>
<li><a href="#sec-3">3. A python decorator</a></li>
<li><a href="#sec-4">4. A hy macro approach</a></li>
</ul>
</div>
</div>

<p>
A common pattern we have in running molecular simulations is to temporarily change to a new directory, do some stuff, and then change back to the directory, even if something goes wrong and an exception is raised. Here we examine several approaches to handling this in Python.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> a try/except/finally approach</h2>
<div class="outline-text-2" id="text-1">
<p>
A way to handle this is with a try/except/finally block in Python. Here we illustrate the idea. Nothing fancy happens for the exception here, other than we do get back to the original directory before the program ends. There is nothing wrong with this, but it is not that reusable, and has a lot of places to make sure the right thing happens.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> os
<span style="color: #0000FF;">print</span>(os.getcwd())
<span style="color: #0000FF;">try</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cwd</span> = os.getcwd()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(<span style="color: #008000;">'/tmp'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f</span> = <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'some-file'</span>, <span style="color: #008000;">'w'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.write(<span style="color: #008000;">'5'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(os.getcwd())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   1 / 0
<span style="color: #0000FF;">except</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #0000FF;">finally</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.close()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(cwd)

<span style="color: #0000FF;">print</span>(os.getcwd())

<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">open</span>(<span style="color: #008000;">'/tmp/some-file'</span>).read())
</pre>
</div>

<pre class="example">
/Users/jkitchin/Dropbox/python/hyve
/private/tmp
/Users/jkitchin/Dropbox/python/hyve
5
</pre>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> A Python context manager</h2>
<div class="outline-text-2" id="text-2">
<p>
A more sophisticated way to handle this in Python is a context manager. We create a context manager here called cd that does the same thing. The context manager is longer, but we would presumably put this in module and import it. This allows us to to the same thing in a lot less code afterwards, and to reuse this pattern. We also use the built in context manager for opening a file. This is for the most part a syntactical sugar for the code above.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> contextlib

<span style="color: #6434A3;">@contextlib.contextmanager</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">cd</span>(wd):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">import</span> os
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cwd</span> = os.getcwd()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Started in {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(wd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Entered {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">try</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">yield</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">except</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">finally</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(cwd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Entered {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))

<span style="color: #8D8D84;">##################################################################</span>
<span style="color: #0000FF;">with</span> cd(<span style="color: #008000;">'/tmp'</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'some-other-file'</span>, <span style="color: #008000;">'w'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.write(<span style="color: #008000;">'5'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   1 / 0

<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">open</span>(<span style="color: #008000;">'/tmp/some-other-file'</span>).read())
</pre>
</div>

<pre class="example">
Started in /Users/jkitchin/Dropbox/python/hyve
Entered /private/tmp
Entered /Users/jkitchin/Dropbox/python/hyve
5
</pre>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> A python decorator</h2>
<div class="outline-text-2" id="text-3">
<p>
Here is an example of doing something like this with a decorator. I don't do this too often, but this does more or less the same thing. It does eliminate a with statement and provide some context to do work in. The overall indentation is identical to the context manager we looked at previously because we have to wrap our code in a function to delay its execution, which we have to ask for with f(). A downside of this is f is always decorated now. I am not sure you can undecorate it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> os

<span style="color: #0000FF;">def</span> <span style="color: #006699;">cd</span>(wd):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">outer</span>(func):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">inner</span>(*args):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cwd</span> = os.getcwd()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Started in {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(wd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'entered {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">try</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> func(*args)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">except</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">finally</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(cwd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'entered {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> inner
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> outer
<span style="color: #8D8D84;">##################################################################</span>

<span style="color: #6434A3;">@cd</span>(<span style="color: #008000;">'/tmp'</span>)
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'decorated-file'</span>, <span style="color: #008000;">'w'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.write(<span style="color: #008000;">"5"</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   1 / 0

f()
<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">open</span>(<span style="color: #008000;">"/tmp/decorated-file"</span>).read())
</pre>
</div>

<pre class="example">
Started in /Users/jkitchin/Dropbox/python/hyve
entered /private/tmp
entered /Users/jkitchin/Dropbox/python/hyve
5
</pre>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> A hy macro approach</h2>
<div class="outline-text-2" id="text-4">
<p>
hy gives us yet another option: a macro. We can use a macro to construct the context for us by building up the try/except/finally code we used above. The indentation used here is just for readability.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">cd</span> [wd <span style="color: #6434A3;">&amp;rest</span> body]
  `(<span style="color: #0000FF;">do</span>
    (<span style="color: #0000FF;">import</span> <span style="color: #006699;">os</span>)
    (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"started in "</span> (os.getcwd))
    (<span style="color: #0000FF;">let</span> [cwd (os.getcwd)]
      (<span style="color: #0000FF;">try</span>
       (<span style="color: #0000FF;">do</span> (os.chdir ~wd)
           (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"entered "</span> (os.getcwd))
           ~@body)
       (<span style="color: #0000FF;">except</span> [e Exception] <span style="color: #D0372D;">nil</span>)
       (<span style="color: #0000FF;">finally</span>
        (os.chdir cwd)
        (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"entered "</span> (os.getcwd)))))))


<span style="color: #8D8D84;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
(cd <span style="color: #008000;">"/tmp"</span>
    (<span style="color: #0000FF;">with</span> [f (open <span style="color: #008000;">"some-hy-file"</span> <span style="color: #008000;">"w"</span>)]
          (.write f <span style="color: #008000;">"5"</span>)
          (<span style="color: #006FE0;">/</span> 1 0)))

(<span style="color: #006FE0;">print</span> (.read (open <span style="color: #008000;">"/tmp/some-hy-file"</span>)))
</pre>
</div>

<pre class="example">
started in  /Users/jkitchin/Dropbox/python/hyve
entered  /private/tmp
entered  /Users/jkitchin/Dropbox/python/hyve
5
</pre>


<p>
The results are the same, even down to the reduced number of lines! But the mechanism that achieves that is different. In this example, we subtly changed the syntax that was possible, eliminating the need for one of the "with" statements. This is only possible with this kind of macro construction as far as I know. It still is not a game changer of programming, but does illustrate some new ways to think about writing these programs. It is not necessary to wrap the code into a function just to delay it from being executed.
</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/28/Managing-contexts---Python-vs-hy.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>More hyjinks - space - the final frontier</title>
      <link>http://jkitchin.github.io/blog/2016/04/24/More-hyjinks-space-the-final-frontier</link>
      <pubDate>Sun, 24 Apr 2016 13:23:05 EDT</pubDate>
      <category><![CDATA[unknown]]></category>
      <category><![CDATA[hylang]]></category>
      <guid isPermaLink="false">R5refcAntN1HmU_OhzC3-t2x8Z0=</guid>
      <description>More hyjinks - space - the final frontier</description>
      <content:encoded><![CDATA[



<p>
Apologies in advance if you haven't come across the programming language <a href="http://esolangs.org/wiki/ook!">ook</a> before now. It kind of looks like you recorded an orangutan as a program. It cracks me up to look at it.  You will not be a better person for learning about it here, or for what is about to follow. This would have been a great April Fool's joke.
</p>

<p>
Here is a typical ook program. The canonical one for any language. I run it in a <a href="https://github.com/jcharra/ook/blob/master/bf.py">Python ook</a> interpreter. You might notice this program actually converts ook to its <a href="https://en.wikipedia.org/wiki/Brainfuck">isomorphic relative</a> and executes that program.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ook <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">interpreter</span> = BFInterpreter()

<span style="color: #BA36A5;">program</span> = <span style="color: #008000;">"""Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!</span>
<span style="color: #008000;">Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook.</span>
<span style="color: #008000;">Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook!</span>
<span style="color: #008000;">Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook. Ook? Ook."""</span>

interpreter.run_commands(convertOokToBF(program))
</pre>
</div>

<pre class="example">
Hello World!
</pre>

<p>
Yes, that odd looking program prints "Hello World!". Ook has just three syntax elements (Ook. Ook? Ook!), which when combined in pairs lead to 8 commands. You can represent any text in ook, as well as programs. It is supposedly Turing complete.
</p>

<p>
Think it could not get worse? Prepare for disappointment. There are at least 8 different <a href="https://www.cs.tut.fi/~jkorpela/chars/spaces.html">unicode spaces</a> &#x2026; You see where this is going. Yes, this is just a <a href="http://esolangs.org/wiki/TrivialBrainfuckSubstitution">trivial substitution</a> exercise. Go ahead and queue <a href="https://www.youtube.com/watch?v=Fq3QmtV8vT0">Disturbed -- Down with the Sickness</a> . Put it on repeat.
</p>

<p>
Introducing: space - the final frontier. A place where noone should ever go. Yep. A whole, Turing complete language using different kinds of unicode spaces as the commands.  This idea is so bad that the only other language similar to it was an April Fool's joke more than a decade ago (<a href="https://en.wikipedia.org/wiki/Whitespace_(programming_language)">https://en.wikipedia.org/wiki/Whitespace_(programming_language)</a> )! They stuck with the ascii whitespace characters. Anyone else who ever had this idea probably had the decency to keep it to themselves. Here is probably the one and only (and hopefully last) space program in existence.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[space [*]]</span>)

(space <span style="color: #008000;">"&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8193;&#8199;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8196;&#8193;&#8194;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8193;&#8199;&#8192;&#8194;&#8194;&#8194;&#8194;&#8196;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8196;&#8196;&#8194;&#8194;&#8194;&#8196;&#8193;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8193;&#8199;&#8192;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8196;&#8193;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8193;&#8199;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8196;&#8193;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8194;&#8194;&#8194;&#8194;&#8193;&#8199;&#8192;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8196;&#8194;&#8194;&#8194;&#8196;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8196;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8196;&#8193;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;&#8198;&#8195;&#8192;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8193;&#8199;&#8192;&#8195;&#8195;&#8195;&#8196;&#8193;"</span>)
</pre>
</div>

<pre class="example">
Hello World!
</pre>

<p>
That's right, a program of nothing but different kinds of spaces that actually does something. Sure space can do anything any other Turing complete language can do, with an infinite sized stack, and a <a href="http://www.dictionary.com/browse/sisyphean">Sysyphean</a> patience and endurance, and a healthy dose of self-loathing. But why would you want to?
</p>

<p>
That program is hiding out in the open there. It is a special kind of noise. Like a modern ascii art interpreted in unicode spaces. Maybe <a href="http://www.bloombergview.com/articles/2014-11-14/why-pay-15-million-for-a-white-canvas">these paintings</a> really have hidden messages in them. Forget steganography to hide your messages. Just <a href="http://www.splitbrain.org/_static/ook/">encode them</a> in ook, convert them to space and put them out there. Who would even know they were there if they did not know to look. Even if they did look, what do they see? space. I am probably getting on an NSA list for that suggestion. Space is so useful. You could use a unicode space version of Morse code. Three short spaces regular space three long spaces regular space three short spaces, i.e. "           ". Those quotes are just to hint they are there. A cry for help. If a space is on the page and nobody sees it, is it really there? A space by any other name would look like &#x2026; a space?
</p>

<p>
This hackery is actually just a trivial substitution on ook that translates each different space to the ook command it corresponds to and then runs it. I built it off of this <a href="http://hackingjohnnz.blogspot.com/2011/06/ook-interpreter-in-python.html">Python ook intepreter</a> , which translates the ook command to another program to run it. I implemented space in hy below. As bad as this idea is, I did not want to build a native space interpreter, just show the absurdity of it. Oh, and write a bit of hy code with dictionaries and comprehension. Sorry to drag that interesting project to this dark corner. Hy sure looks reasonable compared to this! Here is the thin layer.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #006FE0;">setv</span> ook_lookup {(<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook."</span> <span style="color: #008000;">"Ook?"</span>) <span style="color: #008000;">"\u2000"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook?"</span> <span style="color: #008000;">"Ook."</span>) <span style="color: #008000;">"\u2001"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook."</span> <span style="color: #008000;">"Ook."</span>) <span style="color: #008000;">"\u2002"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook!"</span> <span style="color: #008000;">"Ook!"</span>) <span style="color: #008000;">"\u2003"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook!"</span> <span style="color: #008000;">"Ook."</span>) <span style="color: #008000;">"\u2004"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook."</span> <span style="color: #008000;">"Ook!"</span>) <span style="color: #008000;">"\u2005"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook!"</span> <span style="color: #008000;">"Ook?"</span>) <span style="color: #008000;">"\u2006"</span>
                  (<span style="color: #006FE0;">,</span> <span style="color: #008000;">"Ook?"</span> <span style="color: #008000;">"Ook!"</span>) <span style="color: #008000;">"\u2007"</span>}
      space_lookup (dict-comp v k [[k v] (.iteritems ook_lookup)]))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">ook2space</span> [program]
  <span style="color: #008000;">"Convert an ook PROGRAM to space syntax."</span>
  (<span style="color: #0000FF;">let</span> [chars (.split (.replace program <span style="color: #008000;">"\n"</span> <span style="color: #008000;">" "</span>) <span style="color: #008000;">" "</span>)
        p1 (<span style="color: #006FE0;">cut</span> chars 0 <span style="color: #D0372D;">nil</span> 2)
        p2 (<span style="color: #006FE0;">cut</span> chars 1 <span style="color: #D0372D;">nil</span> 2)
        pairs (<span style="color: #006FE0;">zip</span> p1 p2)
        sp <span style="color: #008000;">""</span>]
    (<span style="color: #0000FF;">for</span> [ch pairs] (<span style="color: #006FE0;">+=</span> sp (<span style="color: #006FE0;">get</span> ook_lookup ch)))
    sp))


(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">space2ook</span> [program]
  <span style="color: #008000;">"Convert a space PROGRAM to ook syntax."</span>
  (.join <span style="color: #008000;">" "</span> (<span style="color: #006FE0;">list-comp</span> (.join <span style="color: #008000;">" "</span> (<span style="color: #006FE0;">get</span> space_lookup char)) [char program])))


(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[ook [*]]</span>)
(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">space</span> [space_program]
  <span style="color: #008000;">"Run a space program."</span>
  (<span style="color: #0000FF;">let</span> [interpreter (BFInterpreter)
        bf_program (convertOokToBF (space2ook space_program))]
    (.run_commands interpreter bf_program)))
</pre>
</div>

<p>
We can convert an ook program to a space program. I put the brackets in just for a visual boundary of the space program.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[space [*]]</span>)

(<span style="color: #0000FF;">let</span> [program <span style="color: #008000;">"Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!</span>
<span style="color: #008000;">Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook.</span>
<span style="color: #008000;">Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.</span>
<span style="color: #008000;">Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook!</span>
<span style="color: #008000;">Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook!</span>
<span style="color: #008000;">Ook! Ook! Ook. Ook? Ook."</span>]
 (<span style="color: #006FE0;">print</span> (.encode (<span style="color: #006FE0;">+</span> <span style="color: #008000;">"["</span> (ook2space program) <span style="color: #008000;">"]"</span>) <span style="color: #008000;">"utf-8"</span>)))
</pre>
</div>
<pre class="example">
[                                                                                                                                                                                                             ]
</pre>

<p>
Nothing but space here folks. Move along.
</p>

<p>
What did we learn today? Evidently I have strange ideas sometimes, and I am not alone in that. Just because you can do something, certainly doesn't mean you should. Sorry for this use of your time if you got here. Please come back again!
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/24/More-hyjinks---space---the-final-frontier.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Don't get hysterical - they are just unicode function names</title>
      <link>http://jkitchin.github.io/blog/2016/04/23/Don-t-get-hysterical-they-are-just-unicode-function-names</link>
      <pubDate>Sat, 23 Apr 2016 12:57:58 EDT</pubDate>
      <category><![CDATA[hylang]]></category>
      <guid isPermaLink="false">NPMWe7J8o_Q_XO-D9v5hAuvgzK8=</guid>
      <description>Don't get hysterical - they are just unicode function names</description>
      <content:encoded><![CDATA[



<p>
<a href="http://hylang.org">Hy</a> allows us to define functions with unicode names. Here we play around with this to define logical operators with the symbols you normally see in formal papers (i.e. the LaTeX symbols). I think in Python3 you can also define unicode names for functions. It definitely does not work for Python2.7 which we use here (although remarkably via Hy it does work).
</p>

<p>
First, we define the logical operators or, and, xor and not, and a few other interesting ones. In case it is not clear why a unicode representation of and is helpful, note there are three instances of the word and in the previous sentence, and only one is a logical operator!  This is just some syntactical beauty, but it will shortly make for a different representation of code. We tangle this code block to logical_operators.hy.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8744;</span> [a b] (<span style="color: #006FE0;">or</span> a b))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8743;</span> [a b] (<span style="color: #006FE0;">and</span> a b))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8853;</span> [a b] (xor a b))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#172;</span> [a] (<span style="color: #006FE0;">not</span> a))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8704;</span> [x func]
  <span style="color: #008000;">"(func x) is True for every x."</span>
  (<span style="color: #006FE0;">every?</span> func x))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8707;</span> [x func]
  <span style="color: #008000;">"func(x) is true for at least one x."</span>
  (<span style="color: #006FE0;">some</span> func x))

(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">&#8707;!</span> [x func]
  <span style="color: #008000;">"func(x) is true for exactly one x."</span>
  (<span style="color: #006FE0;">=</span> 1 (len (list (<span style="color: #006FE0;">filter</span> func x)))))
</pre>
</div>

<p>
Here is an example of using those operators. At the moment, we use the prefix notation of Lisp.
</p>
<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[logical_operators [*]]</span>)
(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[serialize [stringify]]</span>)

(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">show</span> [body]
  `(<span style="color: #0000FF;">do</span>
    (<span style="color: #006FE0;">print</span> (.encode (.format <span style="color: #008000;">"{0} = {1}"</span> (stringify '~body) ~body) <span style="color: #008000;">"utf-8"</span>))))

(show (&#172; <span style="color: #D0372D;">True</span>))
(show (&#8743; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">False</span>))
(show (&#8743; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">True</span>))
(show (&#8744; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">False</span>))
(show (&#8744; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">True</span>))
(show (&#8853; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">False</span>))
(show (&#8853; <span style="color: #D0372D;">True</span> <span style="color: #D0372D;">True</span>))
(show (&#8853; <span style="color: #D0372D;">False</span> <span style="color: #D0372D;">False</span>))
(show (&#8704; [2 4 6] even?))
(show (&#8707; [2 3 4] odd?))
(show (&#8707;! [2 3 4] odd?))
(show (&#8707;! [2 3 5] odd?))
</pre>
</div>
<pre class="example">
(¬ True) = False
(∧ True False) = False
(∧ True True) = True
(∨ True False) = True
(∨ True True) = True
(⊕ True False) = True
(⊕ True True) = False
(⊕ False False) = False
(∀ [2 4 6] is_even) = True
(∃ [2 3 4] is_odd) = True
(∃_bang [2 3 4] is_odd) = True
(∃_bang [2 3 5] is_odd) = False
</pre>

<p>
Note the exclamation mark got expanded to _bang. It is evidently an ordinary ascii character.
</p>

<p>
We can get an infix notation if we use our infix module and the #$ reader macro defined in it. Here are some examples. Note it doesn't make sense to use this all time, e.g. it would even be a mistake to do this with the not operator.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[logical_operators [*]]</span>)
(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[serialize [stringify]]</span>)
(<span style="color: #0000FF;">import</span> <span style="color: #006699;">[infix [*]]</span>)
(<span style="color: #0000FF;">require</span> <span style="color: #006699;">infix</span>)

(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">show</span> [body]
  `(<span style="color: #0000FF;">do</span>
    (<span style="color: #006FE0;">print</span> (.encode (.format <span style="color: #008000;">"{0} = {1}"</span> (stringify '~body) ~body) <span style="color: #008000;">"utf-8"</span>))))

(show (&#172; <span style="color: #D0372D;">True</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8743; <span style="color: #D0372D;">False</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8743; <span style="color: #D0372D;">True</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8744; <span style="color: #D0372D;">False</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8744; <span style="color: #D0372D;">True</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8853; <span style="color: #D0372D;">False</span>))
(show #$(<span style="color: #D0372D;">True</span> &#8853; <span style="color: #D0372D;">True</span>))
(show #$(<span style="color: #D0372D;">False</span> &#8853; <span style="color: #D0372D;">False</span>))
</pre>
</div>
<pre class="example">
(¬ True) = False
(dispatch_reader_macro "$" (True ∧ False)) = False
(dispatch_reader_macro "$" (True ∧ True)) = True
(dispatch_reader_macro "$" (True ∨ False)) = True
(dispatch_reader_macro "$" (True ∨ True)) = True
(dispatch_reader_macro "$" (True ⊕ False)) = True
(dispatch_reader_macro "$" (True ⊕ True)) = False
(dispatch_reader_macro "$" (False ⊕ False)) = False
</pre>

<p>
The show macro shows us how the reader macro gets expanded into, you guessed it, regular old function calls. They are just syntactical sugar to help us be more concise. The unicode symbols are not quite as simple to type as ascii names, but there are solutions to this: abbreviations in Emacs (<a href="http://ergoemacs.org/emacs/emacs_n_unicode.html">http://ergoemacs.org/emacs/emacs_n_unicode.html</a> ), custom commands, learn the keystrokes (<a href="http://www.johndcook.com/blog/emacs_unicode/">http://www.johndcook.com/blog/emacs_unicode/</a> ) and C-x 8 RET and the unicode name, etc&#x2026; Is it worth it? That might depend on how ingrained those logical symbols are in your mental model of your work. If it is deeply ingrained, your code will be better aligned with your thoughts, and easier to understand.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/23/Don't-get-hysterical---they-are-just-unicode-function-names.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Alex Hallenbeck successfully defended his PhD</title>
      <link>http://jkitchin.github.io/blog/2016/04/21/Alex-Hallenbeck-successfully-defended-his-PhD</link>
      <pubDate>Thu, 21 Apr 2016 15:07:34 EDT</pubDate>
      <category><![CDATA[news]]></category>
      <guid isPermaLink="false">l-YHkZiHpiwDl5emI8XzaB41-hc=</guid>
      <description>Alex Hallenbeck successfully defended his PhD</description>
      <content:encoded><![CDATA[


<p>
Alex successfully defended his PhD on Tuesday, April 19, 2016!
</p>

<p>
Title: Micro-scale Approaches to the Bench-scale Evaluation of CO<sub>2</sub> Capture System Properties
</p>

<p>
Committee Members: Professor John Kitchin (chair), Professor Shelley Anna, Professor Neil Donahue,  and Professor Newell Washburn.
</p>

<p>
Congratulations Alex!
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/21/Alex-Hallenbeck-successfully-defended-his-PhD.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
  </channel>
</rss>
