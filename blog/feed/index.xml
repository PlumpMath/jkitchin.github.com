<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:wfw="http://wellformedweb.org/CommentAPI/"
     >
  <channel>
    <title>The Kitchin Research Group</title>
    <link>http://jkitchin.github.io/blog</link>
    <description>Chemical Engineering at Carnegie Mellon University</description>
    <pubDate>Thu, 20 Feb 2014 00:28:05 GMT</pubDate>
    <generator>Blogofile</generator>
    <sy:updatePeriod>hourly</sy:updatePeriod>
    <sy:updateFrequency>1</sy:updateFrequency>
    <item>
      <title>Extracting bibtex file from an org-buffer</title>
      <link>http://jkitchin.github.io/blog/2014/02/19/Extracting-bibtex-file-from-an-org-buffer</link>
      <pubDate>Wed, 19 Feb 2014 18:45:27 EST</pubDate>
      <category><![CDATA[org-mode]]></category>
      <category><![CDATA[bibtex]]></category>
      <guid isPermaLink="false">jz3xuLa5C0MBw0T0i0IyS7UbM7U=</guid>
      <description>Extracting bibtex file from an org-buffer</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Bibtex entries</a></li>
</ul>
</div>
</div>

<p>
We use citation links a lot in our org-files, like this: <pre>cite:thompson-2014-co2-react</pre> . Sometimes there are multiple citations like this <pre>cite:mehta-2014-ident-poten,hallenbeck-2013-effec-o2</pre> . It would be convenient at times to extract a bibtex file from these citations. That way we could easily share files. This is possible in RefTeX from a LaTeX file. Org makes it easy to export to LaTeX, so this seems like it should be easy. It would be easy, if I always put the bibliography link in the file. I usually do not, so let us check if that is the case, and if it is not add the bibliography to the end before we export. Then, with the LaTeX file in hand, we open it, and call the RefTeX functions to get the bibliography. Finally, we will create a link to the actual created file, and add it as a source block that can be tangled at the end of the file.
</p>

<p>
Here is a function that does the extraction and some house cleaning. We actually take the contents of the buffer and save it in a temporary file, so that we do not accidentally clobber a tex or bibtex file here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">kg-extract-bibtex</span> ()
  <span style="color: #228b22;">"create bibtex file of entries cited in this buffer"</span>

  (<span style="color: #8b0000;">let*</span> ((tempname (make-temp-file <span style="color: #228b22;">"extract-bib"</span>))
         (contents (buffer-string))
         (cb (current-buffer))
         basename texfile bibfile results)
    
    (find-file tempname)
    (insert contents)
    (setq basename (file-name-sans-extension 
                    (file-name-nondirectory buffer-file-name))
          texfile (concat basename <span style="color: #228b22;">".tex"</span>)
          bibfile (concat basename <span style="color: #228b22;">".bib"</span>))

  (<span style="color: #8b0000;">save-excursion</span>
    (goto-char (point-min))
    (<span style="color: #8b0000;">unless</span> (re-search-forward <span style="color: #228b22;">"^bibliography:"</span> (point-max) 'end)
      (insert (format <span style="color: #228b22;">"\nbibliography:%s"</span> (mapconcat 'identity reftex-default-bibliography <span style="color: #228b22;">","</span>)))))

    (org-latex-export-to-latex)
    (find-file texfile)
    (reftex-parse-all)
    (reftex-create-bibtex-file bibfile)
    (setq results (buffer-string))
    (kill-buffer bibfile)
    (kill-buffer texfile)
    (delete-file texfile)
    (delete-file tempname)

    (switch-to-buffer cb)
    (<span style="color: #8b0000;">save-excursion</span>
      (goto-char (point-max))
      (insert (format <span style="color: #228b22;">"</span>

<span style="color: #228b22;">** Bibtex entries</span>

<span style="color: #228b22;">#+BEGIN_EXAMPLE: </span>
<span style="color: #228b22;">%s</span>
<span style="color: #228b22;">#+END_EXAMPLE"</span> results)))))

(kg-extract-bibtex)
</pre>
</div>

<p>
There it is! The src block does not render in HTML very well, since it appears to be simple text. It looks fine in the org file though.
</p>

<p>
It might be a good idea to replace the bibliography line with the new file, but I will leave that as an exercise for later.
</p>




<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Bibtex entries</h2>
<div class="outline-text-2" id="text-1">
<p>
#+BEGIN<sub>EXAMPLE</sub>: 
@article{hallenbeck-2013-effec-o2,
  author =         "Hallenbeck, Alexander P. and Kitchin, John R.",
  title =         "Effects of \ce{O_2} and \ce{SO_2} on the Capture
                  Capacity of a Primary-Amine Based Polymeric
                  \ce{CO_2} Sorbent",
  year =         2013,
  doi =                 "10.1021/ie400582a",
  eprint =         "<a href="http://pubs.acs.org/doi/pdf/10.1021/ie400582a">http://pubs.acs.org/doi/pdf/10.1021/ie400582a</a> ",
  journal =         "Industrial \&amp; Engineering Chemistry Research",
  pages =         "10788-10794",
  url =                 "<a href="http://pubs.acs.org/doi/abs/10.1021/ie400582a">http://pubs.acs.org/doi/abs/10.1021/ie400582a</a> ",
}
</p>

<p>
@article{mehta-2014-ident-poten,
  author =         {Mehta, Prateek and Salvador, Paul A. and Kitchin,
                  John R.},
  title =         {Identifying Potential BO2 Oxide Polymorphs for
                  Epitaxial Growth Candidates},
  journal =         {ACS Applied Materials \&amp; Interfaces},
  volume =         0,
  number =         0,
  pages =         {null},
  year =         2014,
  doi =                 {10.1021/am4059149},
  URL =                 {<a href="http://pubs.acs.org/doi/abs/10.1021/am4059149">http://pubs.acs.org/doi/abs/10.1021/am4059149</a> },
  eprint =         {<a href="http://pubs.acs.org/doi/pdf/10.1021/am4059149">http://pubs.acs.org/doi/pdf/10.1021/am4059149</a> }
}
</p>

<p>
@Article{thompson-2014-co2-react,
  author =         {Thompson, Robert L. and Albenze, Erik and Shi, Wei
                  and Hopkinson, David and Damodaran, Krishnan and
                  Lee, Anita and Kitchin, John and Luebke, David
                  Richard and Nulwala, Hunaid},
  title =         {\ce{CO_2} Reactive Ionic Liquids: Effects of
                  functional groups on the anion and its influence on
                  the physical properties},
  journal =         {RSC Adv.},
  year =         2014,
  pages =         "-",
  publisher =         {The Royal Society of Chemistry},
  doi =                 {10.1039/C3RA47097K},
  url =                 {<a href="http://dx.doi.org/10.1039/C3RA47097K">http://dx.doi.org/10.1039/C3RA47097K</a> },
  abstract =         "Next generation of gas separation materials are
                  needed to alleviate issues faced in energy and
                  environmental area. Ionic liquids (ILs) are
                  promising class of material for CO2 separations. In
                  this work{,} CO2 reactive triazolides ILs were
                  synthesized and characterized with the aim of
                  developing deeper understanding on how structural
                  changes affect the overall properties for CO2
                  separation. Important insights were gained
                  illustrating the effects of substituents on the
                  anion. It was found that substituents play a crucial
                  role in dictating the overall physical properties of
                  reactive ionic liquids. Depending upon the
                  electronic and steric nature of the substituent{,}
                  CO2 capacities between 0.07-0.4 mol CO2/mol IL were
                  observed. Detailed spectroscopic{,} CO2
                  absorption{,} rheological{,} and simulation studies
                  were carried out to understand the nature and
                  influence of these substituents. The effect of water
                  content was also evaluated{,} and it was found that
                  water had an unexpected impact on the properties of
                  these materials{,} resulting in an increased
                  viscosity{,} but little change in the CO2
                  reactivity."
}
#+END<sub>EXAMPLE</sub></p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/19/Extracting-bibtex-file-from-an-org-buffer.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>yasnippets for jasp, ase and python</title>
      <link>http://jkitchin.github.io/blog/2014/02/17/yasnippets-for-jasp-ase-and-python</link>
      <pubDate>Mon, 17 Feb 2014 09:03:50 EST</pubDate>
      <category><![CDATA[emacs]]></category>
      <category><![CDATA[ase]]></category>
      <category><![CDATA[jasp]]></category>
      <guid isPermaLink="false">5IQtbu_TyyiAG1EcGdlxi4IDXtc=</guid>
      <description>yasnippets for jasp, ase and python</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Tangle the snippets, and add them to yasnippet</a></li>
<li><a href="#sec-2">2. Using the snippets</a></li>
<li><a href="#sec-3">3. Appendix</a>
<ul>
<li><a href="#sec-3-1">3.1. jasp snippets</a></li>
<li><a href="#sec-3-2">3.2. ase snippets</a></li>
<li><a href="#sec-3-3">3.3. python snippets</a></li>
</ul>
</li>
</ul>
</div>
</div>

<p>
In using [[<a href="http://github.com/jkitchin/jasp">http://github.com/jkitchin/jasp</a> for calculations, I find there are lots of small python phrases I use over and over. Today I will examine using <a href="http://capitaomorte.github.io/yasnippet/index.html">yasnippet</a> to save time and keystrokes. yasnippet is a template expansion module, where you type a small set of characters, press <code>Tab</code>, and the
characters "expand" to the full text. It is pretty sophisticated, and allows you to define "tab-stops" which you interactively fill in, and tab between like filling in a form.
</p>

<p>
All the snippets are defined in the <pre>*Appendix</pre> .
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Tangle the snippets, and add them to yasnippet</h2>
<div class="outline-text-2" id="text-1">
<p>
Each snippet definition belongs in a file in a directory. The main directory is called "snippets". Since I anticipate using these snippets in org-mode, each snippet is defined in a directory within snippets called "org-mode". First, we make the directory here. I also want to use the snippets in python mode, so we also create a python-mode directory here. We do not have to duplicate the snippets. We can create a file called <a href="http://capitaomorte.github.io/yasnippet/snippet-organization.html">.yas-parents</a> , with one line in it containing "org-mode".
</p>

<div class="org-src-container">

<pre class="src src-sh">mkdir -p snippets/org-mode
mkdir -p snippets/python-mode
<span style="color: #cd0000;">echo</span> <span style="color: #228b22;">"org-mode"</span> &gt; snippets/python-mode/.yas-parents
</pre>
</div>

<p>
Each snippet is defined in a src block with  a <code>:tangle</code> header. So, we can extract them all in one command here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-tangle)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">snippets/org-mode/iase</td>
<td class="left">snippets/org-mode/imp</td>
<td class="left">snippets/org-mode/inp</td>
<td class="left">snippets/org-mode/ij</td>
<td class="left">snippets/org-mode/pl</td>
<td class="left">snippets/org-mode/pyl</td>
<td class="left">snippets/org-mode/pxl</td>
<td class="left">snippets/org-mode/pp</td>
<td class="left">snippets/org-mode/npa</td>
<td class="left">snippets/org-mode/awt</td>
<td class="left">snippets/org-mode/avw</td>
<td class="left">snippets/org-mode/agf</td>
<td class="left">snippets/org-mode/ape</td>
<td class="left">snippets/org-mode/atms</td>
<td class="left">snippets/org-mode/atm</td>
<td class="left">snippets/org-mode/cga</td>
<td class="left">snippets/org-mode/cc</td>
<td class="left">snippets/org-mode/wjn</td>
<td class="left">snippets/org-mode/wjl</td>
</tr>
</tbody>
</table>

<p>
We also need to add our new directory to yasnippets. This is done by adding the directory to the <code>yas-snippet-dirs</code> variable. You could add this to your init.el file to permanently add these snippets.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'yas-snippet-dirs <span style="color: #228b22;">"c:/Users/jkitchin/Dropbox/blogofile-jkitchin.github.com/_blog/snippets"</span>)
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">c:/Users/jkitchin/Dropbox/blogofile-jkitchin.github.com/<sub>blog</sub>/snippets</td>
<td class="left">~/.emacs.d/snippets</td>
<td class="left">c:/users/jkitchin/Dropbox/kitchingroup/jmax/elpa/yasnippet-20140106.1009/snippets</td>
</tr>
</tbody>
</table>

<p>
Finally, we reload all the snippet definitions, so our new definitions are ready to use.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(yas-reload-all)
</pre>
</div>

<pre class="example">
[yas] Reloaded everything (snippets will load just-in-time)... (some errors, check *Messages*).
</pre>

<p>
Alternatively, you might just load this directory.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(yas-load-directory <span style="color: #228b22;">"./snippets"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Using the snippets</h2>
<div class="outline-text-2" id="text-2">
<p>
Each of these snippets is for a python phrase, but I usually write my python blocks in org-mode. You would use these by typing the shortcut name, and then pressing tab. Below I show what each shortcut expands to.
</p>

<p>
wjl &rarr; <code>with jasp('') as calc:</code>
</p>

<p>
wjn &rarr; <code>with jasp('',) as calc:</code>
    <code>calc.calculate(atoms)</code>
</p>

<p>
cc  &rarr; <code>calc.calculate(atoms)</code>
</p>

<p>
cga &rarr; <code>atoms = calc.get_atoms()</code>
</p>

<p>
atm &rarr; <code>Atom('', )</code>
</p>

<p>
atms &rarr; <code>atoms = Atoms([], cell</code>)=
</p>

<p>
ape &rarr; <code>atoms.get_potential_energy()</code>
</p>

<p>
agf &rarr; <code>atoms.get_forces()</code>
</p>

<p>
avw &rarr; <code>from ase.visualize import view</code>
<code>view(atoms)</code>
</p>

<p>
awt &rarr; <code>from ase.io import write</code>
<code>write('.png', atoms, show_unit_cell=2)</code>
</p>

<p>
npa &rarr; <code>np.array()</code>
</p>

<p>
pp &rarr; <code>plt.plot(, )</code>
</p>

<p>
pxl &rarr; <code>plt.xlabel()</code>
</p>

<p>
pyl &rarr; <code>plt.ylabel()</code>
</p>

<p>
pl &rarr; <code>plt.legend()</code>
</p>

<p>
ij &rarr; <code>from jasp import *</code>
</p>

<p>
inp &rarr; <code>import numpy as np</code>
</p>

<p>
imp &rarr; <code>import matplotlib.pyplot as plt</code>
</p>

<p>
iase &rarr; <code>from ase import Atom, Atoms</code>
</p>

<p>
What other snippets would be handy?
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Appendix</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> jasp snippets</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
with jasp('$1') as calc:
    $0
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
with jasp('$1',$0) as calc:
    calc.calculate(atoms)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
calc.calculate(atoms)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
atoms = calc.get_atoms()
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> ase snippets</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Template for an ase.Atom
</p>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
Atom('$1', $2)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
atoms = Atoms([$1], cell=$2)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
atoms.get_potential_energy()
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
atoms.get_forces()
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
from ase.visualize import view
view(${1:atoms})
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
from ase.io import write
write('$1.png', ${2:atoms}, show_unit_cell=${3:2})
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> python snippets</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
import numpy as np
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
import matplotlib.pyplot as plt
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
from ase import Atom, Atoms
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
np.array($0)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
plt.plot($1, $2)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
plt.xlabel($1)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
plt.ylabel($1)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
plt.legend($1)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-snippet"># -*- mode: snippet -*-
# --
from jasp import *
</pre>
</div>
</div>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/17/yasnippets-for-jasp,-ase-and-python.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>A dynamic snippet for a task due 7 days from now</title>
      <link>http://jkitchin.github.io/blog/2014/02/16/A-dynamic-snippet-for-a-task-due-7-days-from-now</link>
      <pubDate>Sun, 16 Feb 2014 13:50:27 EST</pubDate>
      <category><![CDATA[org-mode]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">Tx9jFOYH5plEncsdx7wUpo9okjg=</guid>
      <description>A dynamic snippet for a task due 7 days from now</description>
      <content:encoded><![CDATA[



<p>
I have been playing with yasnippets. A pretty cool feature is that you can run elisp code in the template to generate text. Below, I define a snippet that will create a todo item due 7 days from the time you define it. This is an unconventional way to define a snippet, but I did not want to save it to a file just to try it out. So, I put it in a temporary buffer, and load it from there. When you run this block, it will note it is a new snippet, and ask if you want to save it. You can say no. 
</p>

<p>
We will use the code we developed <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/02/05/Add-time-to-a-deadline/">here</a> to create a timestamp from the
current time plus seven days.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(yas-global-mode)
(<span style="color: #8b0000;">with-temp-buffer</span>
  (insert <span style="color: #228b22;">"# name : todo-followup</span>
<span style="color: #228b22;"># --</span>

<span style="color: #228b22;">*************** TODO $1</span>
<span style="color: #228b22;">${2:             DEADLINE: `(let ((seven-days (seconds-to-time (* 7 24 60 60))))</span>
<span style="color: #228b22;">  (format-time-string \"&lt;%Y-%m-%d %a&gt;\" (time-add (current-time) seven-days)))`}$0</span>
<span style="color: #228b22;">*************** END </span>
<span style="color: #228b22;">"</span>)
  (yas-load-snippet-buffer-and-close 'org-mode))
</pre>
</div>

<p>
Now, you will have a new entry in the YASnippet menu that is called todo-followup. If you put the cursor on a blank line, and select that entry you get this below (after you fill in the text for the headline, of course!):
</p>

<pre class="example">
*************** TODO see how many times this was viewed
		DEADLINE: &lt;2014-02-23 Sun&gt;
*************** END
</pre>



<p>
That is pretty nice, as it saves a lot of keystrokes for that
particular kind of task. Let us up the ante, and see if we can make it
interactive so you can enter the number of days from now the task is
due.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(yas-global-mode)
(<span style="color: #8b0000;">with-temp-buffer</span>
  (insert <span style="color: #228b22;">"# name : todo-followup</span>
<span style="color: #228b22;"># --</span>

<span style="color: #228b22;">*************** TODO $1</span>
<span style="color: #228b22;">${2:             DEADLINE: `(let ((ndays (seconds-to-time (* (string-to-int (read-from-minibuffer \"Days until due: \")) 24 60 60))))</span>
<span style="color: #228b22;">  (format-time-string \"&lt;%Y-%m-%d %a&gt;\" (time-add (current-time) ndays)))`}$0</span>
<span style="color: #228b22;">*************** END </span>
<span style="color: #228b22;">"</span>)
  (yas-load-snippet-buffer-and-close 'org-mode))
</pre>
</div>

<pre class="example">
*************** TODO sweet!
		DEADLINE: &lt;2014-02-26 Wed&gt;
*************** END
</pre>
<p>
Well, that made it just a bit sweeter! I was prompted for the "Days
until due:", entered 10 days, and a date 10 days from now was
automatically entered!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/16/A-dynamic-snippet-for-a-task-due-7-days-from-now.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Merging bibtex files and avoiding duplicates</title>
      <link>http://jkitchin.github.io/blog/2014/02/10/Merging-bibtex-files-and-avoiding-duplicates</link>
      <pubDate>Mon, 10 Feb 2014 07:42:49 EST</pubDate>
      <category><![CDATA[bibtex]]></category>
      <guid isPermaLink="false">cCVfCOJw44JQk37CFcO6zUkTWkk=</guid>
      <description>Merging bibtex files and avoiding duplicates</description>
      <content:encoded><![CDATA[


<p>
I usually advocate to have a master bibtex file with all entries in it. Emacs is helpful at avoiding duplicate entries as you enter them. Sometimes though, you have more than one bibtex file. Maybe you started one for a new project, or someone sent you one. In any case, you want to merge the files into one file. Bibtex requires each entry to have a unique key. 
</p>

<p>
Let us begin. I have two bibtex files I exported from Endnote. I have
already removed all the non-ascii characters and cleaned them up
pretty well. We start with some analysis. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries1</span> = bp.get_entry_list()

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0} entries in file 1'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">len</span>(entries1))

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/perovskite-strain/perovskite-strain.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries2</span> = bp.get_entry_list()

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0} entries in file 2'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">len</span>(entries2))
</pre>
</div>

<pre class="example">
100 entries in file 1
129 entries in file 2
</pre>

<p>
Now, let see how many duplicates there are. It is easy to use sets for this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">store keys to check for duplicates</span>
<span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries1</span> = bp.get_entry_list()

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/perovskite-strain/perovskite-strain.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries2</span> = bp.get_entry_list()

<span style="color: #8b008b;">entry1_keys</span> = <span style="color: #cd0000;">set</span>([entry[<span style="color: #228b22;">'id'</span>] <span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries1])
<span style="color: #8b008b;">entry2_keys</span> = <span style="color: #cd0000;">set</span>([entry[<span style="color: #228b22;">'id'</span>] <span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries2])

<span style="color: #8b008b;">duplicates</span> = entry1_keys &amp; entry2_keys
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'There are {0} duplicates'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">len</span>(duplicates))
<span style="color: #8b0000;">print</span> duplicates
</pre>
</div>

<pre class="example">
There are 20 duplicates
set(['nolan-2008-vacan-co', 'giocondi-2001-spatial', 'giocondi-2001-spatial-batio3', 'wang-2006-oxidat-gga', 'piskunov-2008-elect-lamno3', 'pala-2007-modif-oxidat', 'chretien-2006-densit-funct', 'giocondi-2008-sr2nb-batio3', 'kushima-2010-compet-lacoo3', 'pala-2009-co-ti', 'giocondi-2007-srtio3', 'lee-2009-ab-labo3', 'balasubramanian-2005-epitax-phase', 'mastrikov-2010-pathw-oxygen', 'shapovalov-2007-catal', 'evarestov-2005-compar-lcao', 'choi-2007-comput-study', 'havelia-2009-nucleat-growt', 'lee-2009-ab-defec', 'lee-2009-predic-surfac'])
</pre>

<p>
Ok, now we make a function to format each entry. We take that code from this <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/02/09/Sorting-fields-in-bibtex-entries/">this post</a> and turn it into a function. Then we add all the entries from the first file. Then, we add entries from the second file as long as the key is not in the list from the first file.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser
<span style="color: #8b0000;">import</span> os, textwrap

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">format_bibtex_entry</span>(entry):
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">field, format, wrap or not</span>
    <span style="color: #8b008b;">field_order</span> = [(u<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'title'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'journal'</span>,<span style="color: #228b22;">'"{0}",\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'volume'</span>,<span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'number'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'pages'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'year'</span>, <span style="color: #228b22;">'{0},\n'</span>, <span style="color: #cd0000;">True</span>),
                   (u<span style="color: #228b22;">'doi'</span>,<span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">False</span>),
                   (u<span style="color: #228b22;">'url'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>),
                   (u<span style="color: #228b22;">'link'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>)]
    
    <span style="color: #8b008b;">keys</span> = <span style="color: #cd0000;">set</span>(entry.keys())

    <span style="color: #8b008b;">extra_fields</span> = keys.difference([f[0] <span style="color: #8b0000;">for</span> f <span style="color: #8b0000;">in</span> field_order])
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we do not want these in our entry</span>
    extra_fields.remove(<span style="color: #228b22;">'type'</span>)
    extra_fields.remove(<span style="color: #228b22;">'id'</span>)

    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now build up our entry string</span>
    <span style="color: #8b008b;">s</span> = <span style="color: #228b22;">'@{type}{{{id},\n'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">type</span>=entry[<span style="color: #228b22;">'type'</span>].upper(),
                                  <span style="color: #cd0000;">id</span>=entry[<span style="color: #228b22;">'id'</span>])

    <span style="color: #8b0000;">for</span> field, fmt, wrap <span style="color: #8b0000;">in</span> field_order:
        <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
            <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
            <span style="color: #8b008b;">s2</span> = fmt.<span style="color: #cd0000;">format</span>(entry[field])
            <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{1}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
            <span style="color: #8b0000;">if</span> wrap:
                <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">fill seems to remove trailing '\n'</span>
                <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
            <span style="color: #8b008b;">s</span> += s3  

    <span style="color: #8b0000;">for</span> field <span style="color: #8b0000;">in</span> extra_fields:
        <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
            <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
            <span style="color: #8b008b;">s2</span> = entry[field]
            <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{{{1}}}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
            <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
            <span style="color: #8b008b;">s</span> += s3  

    <span style="color: #8b008b;">s</span> += <span style="color: #228b22;">'}\n\n'</span>
    <span style="color: #8b0000;">return</span> s

<span style="color: #8b0000;">if</span> os.path.exists(<span style="color: #228b22;">'merged.bib'</span>): os.unlink(<span style="color: #228b22;">'merged.bib'</span>)    

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries1</span> = bp.get_entry_list()

<span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries1:
    <span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'merged.bib'</span>, <span style="color: #228b22;">'a'</span>) <span style="color: #8b0000;">as</span> f:
        f.write(format_bibtex_entry(entry))

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">store keys to check for duplicates</span>
<span style="color: #8b008b;">entry1_keys</span> = [entry[<span style="color: #228b22;">'id'</span>] <span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries1]

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/perovskite-strain/perovskite-strain.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries2</span> = bp.get_entry_list()

<span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries2:
    <span style="color: #8b0000;">if</span> <span style="color: #8b0000;">not</span> entry[<span style="color: #228b22;">'id'</span>] <span style="color: #8b0000;">in</span> entry1_keys:
        <span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'merged.bib'</span>, <span style="color: #228b22;">'a'</span>) <span style="color: #8b0000;">as</span> f:
            f.write(format_bibtex_entry(entry))
</pre>
</div>

<p>
Here is the merged file: <a href="/media/2014-02-10-Merging-bibtex-files-and-avoiding-duplicates/merged.bib">merged.bib</a> and the corresponding bibliography <a href="/media/2014-02-10-Merging-bibtex-files-and-avoiding-duplicates/merged.pdf">merged.pdf</a> . There are 209 entries in it, which is what we expected given that there were 20 duplicates. There are no doubt other programs that merge bibtex files, but I like this approach for the following reasons:
</p>
<ol class="org-ol">
<li>I learned a new python module that parses bibtex files.
</li>
<li>I got my entries formatted exactly the way I wanted them.
</li>
<li>I defined what constituted a duplicate.
</li>
</ol>

<p>
Of course, here we only eliminate entries with duplicate keys. If the same entry has different keys, they will be merged. This is a very hard problem to get right, since there are many possible ways to abbreviate author names, journal names, and multiple ways to write the title. That is a problem best solved by using a systematic way of generating the keys, so that you minimize the possibility of duplicates that way.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/10/Merging-bibtex-files-and-avoiding-duplicates.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Sorting fields in bibtex entries</title>
      <link>http://jkitchin.github.io/blog/2014/02/09/Sorting-fields-in-bibtex-entries</link>
      <pubDate>Sun, 09 Feb 2014 15:22:18 EST</pubDate>
      <category><![CDATA[bibtex]]></category>
      <guid isPermaLink="false">HtsaQDD_1BRxbGjZLGDZn5C6cZQ=</guid>
      <description>Sorting fields in bibtex entries</description>
      <content:encoded><![CDATA[



<p>
I like consistency. In particular, for bibtex entries, I would like
all the fields to be in the same order, and in all caps. Why? Because then I know where to look, and incorrect entries stand out more easily. My current
bibtex file does not look like this! That is a result of adding bibtex
entries from various journals, which all have different
conventions. Today, I am going to look at a way to achieve what I
want.
</p>

<p>
The principle idea is that we will parse the bibtex file into a list
of entries represented by a convenient data structure. Then, we will
format each entry the way we want, and print the result back out to a
new file. I will use <a href="https://bibtexparser.readthedocs.org/en/latest/index.html">bibtexparser</a> and python to do this. 
</p>

<p>
Let us examine what bibtexparser does for us. Here we read in a file
and get the entries. Each entry is represented as a dictionary.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries</span> = bp.get_entry_list()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">look at the first entry</span>
<span style="color: #8b0000;">print</span> entries[0]
</pre>
</div>

<pre class="example">
{u'title': u'Effect of growth conditions on formation of TiO2-II\nthin films in atomic layer deposition process', u'journal': u'Journal of Crystal Growth', u'author': u'Aarik, J. and Aidla, A. and Sammelselg, V. and\nUustare, T.', u'number': u'3', 'id': 'aarik-1997-effec-tio2', u'volume': u'181', u'link': u'&lt;Go to ISI&gt;://A1997YD52700011', u'year': u'1997', 'type': u'article', u'pages': u'259-264'}
</pre>


<p>
Let us take a moment to analyze our bibtex file. Let us see how many
types of entries we have. That gives a chance to practice <a href="http://kitchingroup.cheme.cmu.edu/blog/2013/05/29/Getting-a-dictionary-of-counts/">counting</a> .
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries</span> = bp.get_entry_list()

<span style="color: #8b008b;">types</span> = [entry[<span style="color: #228b22;">'type'</span>] <span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries]
<span style="color: #8b0000;">print</span> <span style="color: #cd0000;">dict</span>((typ, types.count(typ)) <span style="color: #8b0000;">for</span> typ <span style="color: #8b0000;">in</span> types)
</pre>
</div>

<pre class="example">
{u'inbook': 2, u'article': 90, u'book': 4, u'misc': 3, u'phdthesis': 1}
</pre>

<p>
Indeed, there are a lot of entries that we do not want to do by hand. Here is the order I would like the fields to be for articles. A similar order for the other types would be fine too.
</p>

<pre class="example">
AUTHOR
TITLE
JOURNAL
VOLUME
ISSUE
PAGES
YEAR
DOI
URL or link
other fields
</pre>

<p>
Bibtex lets you define arbitrary fields, and we do not want to lose
these in the entries. I have for example defined fields for the path to a pdf, or to a notes file in some files. We will use python sets to handle this for
us. With sets, we can conveniently compute the difference in fields between our ordered list, and the entry. Here is an example. We have a master list of keys, and an entry
with extra keys. We use the <code>difference</code> function to get the list of
extra keys. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">entry</span> = <span style="color: #cd0000;">set</span>([<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'title'</span>, <span style="color: #228b22;">'journal'</span>, <span style="color: #228b22;">'field1'</span>])
<span style="color: #8b008b;">master</span> = <span style="color: #cd0000;">set</span>([<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'title'</span>])

<span style="color: #8b0000;">print</span> entry.difference(master)
</pre>
</div>

<pre class="example">
set(['journal', 'field1'])
</pre>

<p>
So, we will use the list we want the order of, and then add the rest
of the keys.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries</span> = bp.get_entry_list()

<span style="color: #8b008b;">field_order</span> = [<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'title'</span>, <span style="color: #228b22;">'journal'</span>, <span style="color: #228b22;">'volume'</span>, <span style="color: #228b22;">'issue'</span> <span style="color: #228b22;">'pages'</span>, <span style="color: #228b22;">'year'</span>, <span style="color: #228b22;">'doi'</span>, <span style="color: #228b22;">'url'</span>, <span style="color: #228b22;">'link'</span>]

<span style="color: #8b008b;">entry_keys</span> = <span style="color: #cd0000;">set</span>(entries[0].keys())
<span style="color: #8b0000;">print</span> entry_keys.difference(field_order)
</pre>
</div>
<pre class="example">
set([u'number', 'id', 'type', u'pages'])
</pre>

<p>
You can see a subtlety here, the pages key is a unicode string, but
our field<sub>order</sub> is a regular string. Also, number is a unicode
string. It appears that all the keys are unicode except type and id. In the next block we will address that. 
</p>

<p>
You should probably go ahead and <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/01/08/Finding-bibtex-entries-with-non-ascii-characters/">remove non-ascii characters</a> from your bib-file. We got lucky with this entry, but some entries have non-ascii characters and these cause errors. 
</p>

<p>
So we need to specify the order of fields, how they should be formatted, and whether we should wrap the field contents into a nice block. We do that in the next block. Note that in the formats we use double {{ to get a literal { when we use string formatting. We use the formats to wrap the fields in brackets or quotes as needed. We use the textwrap module to neatly wrap multiline fields with indentation of the second line and beyond. By some iteration, I have made this print an entry that emacs-bibtex likes, and does not need to further reformat.
</p>

<p>
WARNING: The code below creates new files, and deletes files. Make sure you pay attention to this to avoid losing your own files. You do keep your bib-file under version control right ;).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser
<span style="color: #8b0000;">import</span> textwrap

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries</span> = bp.get_entry_list()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">field, format, wrap or not</span>
<span style="color: #8b008b;">field_order</span> = [(u<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'title'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'journal'</span>,<span style="color: #228b22;">'"{0}",\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'volume'</span>,<span style="color: #228b22;">'{0},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'number'</span>, <span style="color: #228b22;">'{0},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'pages'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'year'</span>, <span style="color: #228b22;">'{0},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'doi'</span>,<span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">False</span>),
               (u<span style="color: #228b22;">'url'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>),
               (u<span style="color: #228b22;">'link'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>)]

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">pick an entry, this time second to last one</span>
<span style="color: #8b008b;">entry</span> = entries[-2]
<span style="color: #8b008b;">keys</span> = <span style="color: #cd0000;">set</span>(entry.keys())

<span style="color: #8b008b;">extra_fields</span> = keys.difference([f[0] <span style="color: #8b0000;">for</span> f <span style="color: #8b0000;">in</span> field_order])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we do not want these in our entry, they go in the "header"</span>
extra_fields.remove(<span style="color: #228b22;">'type'</span>)
extra_fields.remove(<span style="color: #228b22;">'id'</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now build up our entry string</span>
<span style="color: #8b008b;">s</span> = <span style="color: #228b22;">'@{type}{{{id},\n'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">type</span>=entry[<span style="color: #228b22;">'type'</span>].upper(),
                              <span style="color: #cd0000;">id</span>=entry[<span style="color: #228b22;">'id'</span>])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now handle the ordered fields, then the extra fields</span>
<span style="color: #8b0000;">for</span> field, fmt, wrap <span style="color: #8b0000;">in</span> field_order:
    <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
        <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
        <span style="color: #8b008b;">s2</span> = fmt.<span style="color: #cd0000;">format</span>(entry[field])
        <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{1}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
        <span style="color: #8b0000;">if</span> wrap:
            <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">fill seems to remove trailing '\n'</span>
            <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
        <span style="color: #8b008b;">s</span> += s3  

<span style="color: #8b0000;">for</span> field <span style="color: #8b0000;">in</span> extra_fields:
    <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
        <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
        <span style="color: #8b008b;">s2</span> = entry[field]
        <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{{{1}}}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
        <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
        <span style="color: #8b008b;">s</span> += s3  

<span style="color: #8b008b;">s</span> += <span style="color: #228b22;">'}\n\n'</span>

<span style="color: #8b0000;">print</span> s
</pre>
</div>

<pre class="example">
@ARTICLE{yang-2008-anatas-tio2,
  AUTHOR =       {Yang, H. G. and Sun, C. H. and Qiao, S. Z. and Zou,
                  J. and Liu, G. and Smith, S. C. and Cheng, H. M. and
                  Lu, G. Q.},
  TITLE =        {Anatase \ce{TiO_2} single crystals with a large
                  percentage of reactive facets},
  JOURNAL =      "Nature",
  VOLUME =       453,
  NUMBER =       7195,
  PAGES =        {638-U4},
  YEAR =         2008,
  DOI =          {10.1038/nature06964},
  LINK =         {\url{http://www.nature.com/nature/journal/v453/n7195/pdf/nature06964.pdf}},
  KEYWORD =      {TOTAL-ENERGY CALCULATIONS WAVE BASIS-SET
                  HYDROTHERMAL CONDITIONS TITANIUM-DIOXIDE SURFACE
                  OXIDE NANOSTRUCTURES NANOPARTICLES NANOCRYSTALS
                  EFFICIENCY}
}
</pre>

<p>
That looks pretty good. Now, we are ready to try the whole file. We simply loop through all the entries, and append the string to a file for each entry. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> bibtexparser.bparser <span style="color: #8b0000;">import</span> BibTexParser
<span style="color: #8b0000;">import</span> os, textwrap

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'../../CMU/proposals/link-to-2014/bo2-polymorphs/bo2-polymorphs.bib'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> bibfile:
    <span style="color: #8b008b;">bp</span> = BibTexParser(bibfile)
    <span style="color: #8b008b;">entries</span> = bp.get_entry_list()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">field, format, wrap or not</span>
<span style="color: #8b008b;">field_order</span> = [(u<span style="color: #228b22;">'author'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'title'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'journal'</span>,<span style="color: #228b22;">'"{0}",\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'volume'</span>,<span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'number'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'pages'</span>, <span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'year'</span>, <span style="color: #228b22;">'{0},\n'</span>, <span style="color: #cd0000;">True</span>),
               (u<span style="color: #228b22;">'doi'</span>,<span style="color: #228b22;">'{{{0}}},\n'</span>, <span style="color: #cd0000;">False</span>),
               (u<span style="color: #228b22;">'url'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>),
               (u<span style="color: #228b22;">'link'</span>,<span style="color: #228b22;">'{{\url{{{0}}}}},\n'</span>, <span style="color: #cd0000;">False</span>)]

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">rm file if it exists. this is a new file, not our bibliography!</span>
<span style="color: #8b0000;">if</span> os.path.exists(<span style="color: #228b22;">'bib.bib'</span>): os.unlink(<span style="color: #228b22;">'bib.bib'</span>)

<span style="color: #8b0000;">for</span> entry <span style="color: #8b0000;">in</span> entries:
    
    <span style="color: #8b008b;">keys</span> = <span style="color: #cd0000;">set</span>(entry.keys())

    <span style="color: #8b008b;">extra_fields</span> = keys.difference([f[0] <span style="color: #8b0000;">for</span> f <span style="color: #8b0000;">in</span> field_order])
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we do not want these in our entry</span>
    extra_fields.remove(<span style="color: #228b22;">'type'</span>)
    extra_fields.remove(<span style="color: #228b22;">'id'</span>)

    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now build up our entry string</span>
    <span style="color: #8b008b;">s</span> = <span style="color: #228b22;">'@{type}{{{id},\n'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">type</span>=entry[<span style="color: #228b22;">'type'</span>].upper(),
                                  <span style="color: #cd0000;">id</span>=entry[<span style="color: #228b22;">'id'</span>])

    <span style="color: #8b0000;">for</span> field, fmt, wrap <span style="color: #8b0000;">in</span> field_order:
        <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
            <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
            <span style="color: #8b008b;">s2</span> = fmt.<span style="color: #cd0000;">format</span>(entry[field])
            <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{1}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
            <span style="color: #8b0000;">if</span> wrap:
                <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">fill seems to remove trailing '\n'</span>
                <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
            <span style="color: #8b008b;">s</span> += s3  

    <span style="color: #8b0000;">for</span> field <span style="color: #8b0000;">in</span> extra_fields:
        <span style="color: #8b0000;">if</span> field <span style="color: #8b0000;">in</span> entry:
            <span style="color: #8b008b;">s1</span> = <span style="color: #228b22;">'  {0} ='</span>.<span style="color: #cd0000;">format</span>(field.upper())
            <span style="color: #8b008b;">s2</span> = entry[field]
            <span style="color: #8b008b;">s3</span> = <span style="color: #228b22;">'{0:17s}{{{1}}}'</span>.<span style="color: #cd0000;">format</span>(s1, s2)
            <span style="color: #8b008b;">s3</span> = textwrap.fill(s3, subsequent_indent=<span style="color: #228b22;">' '</span>*18, width=70) + <span style="color: #228b22;">'\n'</span>
            <span style="color: #8b008b;">s</span> += s3  

    <span style="color: #8b008b;">s</span> += <span style="color: #228b22;">'}\n\n'</span>

    <span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'bib.bib'</span>, <span style="color: #228b22;">'a'</span>) <span style="color: #8b0000;">as</span> f:
        f.write(s)
</pre>
</div>

<p>
This results in <a href="/media/2014-02-09-Sorting-fields-in-bibtex-entries/bib.bib">bib.bib</a> with 100 entries, which according to emacs is a syntactically correct bibtex file, and which builds this bibliography <a href="/media/2014-02-09-Sorting-fields-in-bibtex-entries/bib.pdf">bib.pdf</a> , which also has 100 entries. That usually means everything is in order (minor intention of pun there). More importantly, the fields are ordered the way I want them! 
</p>

<p>
Getting to this point was an iterative process. You will want to make sure the original bib file is under version control or backed up someway, in case something happens during this transformation! 
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/09/Sorting-fields-in-bibtex-entries.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Separating code blocks from results in org-mode</title>
      <link>http://jkitchin.github.io/blog/2014/02/08/Separating-code-blocks-from-results-in-org-mode</link>
      <pubDate>Sat, 08 Feb 2014 08:54:57 EST</pubDate>
      <category><![CDATA[org-mode]]></category>
      <guid isPermaLink="false">dFO-whe_7X7Ue6HD96_pX_PL9bo=</guid>
      <description>Separating code blocks from results in org-mode</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Appendix of code</a>
<ul>
<li><a href="#sec-1-1">1.1. Area of a circle</a></li>
<li><a href="#sec-1-2">1.2. Hello function</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I often put my code blocks right where I need them in my org documents. It usually has a section explaining what I want to do, then the code block that implements the idea, following by the output. Sometimes the code blocks are long, however, and it might be desirable for that code to be in an appendix. <sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>

<p>
Org-mode enables this with #+CALL. For example, I have a function named <code>circle-area</code> in the appendix of this post that calculates the area of a circle given its radius. The function is "named" by a line like this:
</p>

<pre class="example">
#+name: function-name
</pre>

<p>
I can use the function like this:
</p>

<pre class="example">
#+CALL: circle-area(1)
</pre>

<pre class="example">
3.14159265359
</pre>

<p>
That is pretty nice. You can separate the code out from the main document. You still have to put the #+CALL: line in though. It may be appropriate to put a call inline with your text. If you add the following sentence, and put your cursor on the call<sub>circle</sub>-area and press C-c C-c, the output is put in verbatim markers right after it. 
</p>

<pre class="example">
The area of a circle with unit radius is call_circle-area(1).
</pre>

<p>
The area of a circle with unit radius is <code>3.14159265359</code>. 
</p>

<p>
Here is another interesting way to do it. We can specify a named results block. Let us consider another function named <code>hello-block</code> that prints output. We specify a named results block like this:
</p>

<pre class="example">
#+RESULTS: function-name
</pre>

<p>
Now, whenever you execute that block, the results will get put where this line is like this.
</p>

<pre class="example">
hello John
</pre>

<p>
These could be useful approaches to making the "top" of your document cleaner, with less code in it. The code of course is still in the document, but at the end, in an appendix for example. This kind of separation might make it a little harder to find the code, and to reevaluate it,<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup> but it might improve the readability for others. 
</p>




<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Appendix of code</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Area of a circle</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-python" id="circle-area"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">return</span> np.pi * r**2
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Hello function</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-python" id="hello-block"><span style="color: #8b0000;">print</span> <span style="color: #228b22;">'hello '</span> + name
</pre>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>
I know I can pretty conveniently collapse a code block by pressing tab on the header. Sometimes that is not enough.
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p>
It is not much harder, C-s will let you search for the named block. I do not know if there are nice convenient navigation commands for this.
</p></div>


</div>
</div><p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/08/Separating-code-blocks-from-results-in-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>New publication in Applied Materials and Interfaces</title>
      <link>http://jkitchin.github.io/blog/2014/02/06/New-publication-in-Applied-Materials-and-Interfaces</link>
      <pubDate>Thu, 06 Feb 2014 16:04:06 EST</pubDate>
      <category><![CDATA[news]]></category>
      <guid isPermaLink="false">dq98SZyXWUQwhQ3N8aPH63guxMo=</guid>
      <description>New publication in Applied Materials and Interfaces</description>
      <content:encoded><![CDATA[


<p>
<b>Identifying Potential BO2 Oxide Polymorphs for Epitaxial Growth Candidates</b>,
by Prateek Mehta, Paul A. Salvador, and John R. Kitchin
<a href="http://pubs.acs.org/doi/full/10.1021/am4059149">http://pubs.acs.org/doi/full/10.1021/am4059149</a> 
</p>

<p>
Transition metal dioxides (BO2) exhibit a number of polymorphic structures with distinct properties, but the isolation of different polymorphs for a given composition is carried out using trial and error experimentation. We present computational studies of the relative stabilities and equations of state for six polymorphs (anatase, brookite, rutile, columbite, pyrite, and fluorite) of five different BO2 dioxides (B = Ti, V, Ru, Ir, and Sn). These properties were computed in a consistent fashion using several exchange correlation functionals within the density functional theory formalism, and the effects of the different functionals are discussed relative to their impact on predictive synthesis. We compare the computational results to prior observations of high-pressure synthesis and epitaxial film growth and then use this discussion to predict new accessible polymorphs in the context of epitaxial stabilization using isostructural substrates. For example, the relative stabilities of the columbite polymorph for VO2 and RuO2 are similar to those of TiO2 and SnO2, the latter two of which have been previously stabilized as epitaxial films.
</p>

<p>
As with other recent papers, the supporting information file contains embedded data files that enable the reproduction of the data and figures in the paper.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/06/New-publication-in-Applied-Materials-and-Interfaces.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Invisible text in emacs</title>
      <link>http://jkitchin.github.io/blog/2014/02/06/Invisible-text-in-emacs</link>
      <pubDate>Thu, 06 Feb 2014 09:02:44 EST</pubDate>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">d-sdbifU5WUlyiyI_U_vbrhULy0=</guid>
      <description>Invisible text in emacs</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#beginner">1. subsection 1</a></li>
<li><a href="#sec-2">2. subsection 2</a></li>
<li><a href="#sec-3">3. subsection 3</a></li>
</ul>
</div>
</div>
<p>
Emacs supports <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Invisible-Text.html">invisible text</a> . In other words, you can use code to set properties on text in a buffer that make it visible, or invisible. You can use code to change the invisibility properties of text. 
</p>

<p>
I have been exploring ways to conditionally navigate in org documents using links. These links may validate that some property has been set in a heading, for example. An alternative approach is to make regions visible, depending on some criteria. That is what we do today. You will probably want to see this  <a href="/media/2014-02-06-Invisible-text-in-emacs/invisible-text.swf">video</a> , since what happens in this post is dynamic, and you will not see visible and invisible text.
</p>

<p>
What I have below here are a set of headings with properties that indicate what "level" they are at: beginner, medium and advanced. 
First, we mark each org subtree  with an overlay that has an 'invisible property that contains the "level". Then, we add the "level" to the list of symbols that marks invisible sections.  If you run this block, the headings all disappear.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-map-entries (<span style="color: #8b0000;">lambda</span> () 
                   (<span style="color: #8b0000;">let</span> ((level (org-entry-get (point) <span style="color: #228b22;">"level"</span>))
                          (symbol-level))
                     (<span style="color: #8b0000;">when</span> level
                       (setq symbol-level (intern level))
                       (org-mark-subtree)                 
                       (overlay-put (make-overlay (point) (mark))
                                    'invisible 
                                    symbol-level)
                       <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">make regions with symbol-level invisible</span>
                       (add-to-invisibility-spec `(,symbol-level))))))
</pre>
</div>

<p>
Now, we can selectively make them appear with these links.
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(beginner))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(medium))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(advanced))</pre> 
</p>

<p>
I imagine this could be useful to show selective content based on user choices. I am not sure it is better than links to external files. I imagine you would have to open this org file by some elisp command that would run the block at the top to make everything invisible, and then show it to the user. You could definitely build in more complex code to determine if a user was allowed to open a section. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">level2-p</span> ()
  <span style="color: #228b22;">"return if user is ready for level 2 based on value of property named correct"</span>
  (interactive)
  (<span style="color: #8b0000;">save-excursion</span>
    (org-open-link-from-string <span style="color: #228b22;">"[[#beginner]]"</span>)
    (<span style="color: #8b0000;">let</span> ((val (org-entry-get (point) <span style="color: #228b22;">"correct"</span>)))
      (<span style="color: #8b0000;">if</span> (and val (string= val <span style="color: #228b22;">"true"</span>))
          t
        nil))))
</pre>
</div>

<pre class="example">
level2-p
</pre>

<p>
Now, we can build this link: <pre>elisp:(when (level2-p) (remove-from-invisibility-spec '(medium)))</pre> 
</p>

<p>
This will show the medium level, provided we have already opened the beginner level and set the property value correctly.
</p>

<div id="outline-container-beginner" class="outline-2">
<h2 id="beginner"><a id="sec-1"></a><span class="section-number-2">1</span> subsection 1</h2>
<div class="outline-text-2" id="text-beginner">
<p>
some text in 1
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> subsection 2</h2>
<div class="outline-text-2" id="text-2">
<p>
more text in 2
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> subsection 3</h2>
<div class="outline-text-2" id="text-3">
<p>
last section 3
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/06/Invisible-text-in-emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Add time to a deadline</title>
      <link>http://jkitchin.github.io/blog/2014/02/05/Add-time-to-a-deadline</link>
      <pubDate>Wed, 05 Feb 2014 09:41:04 EST</pubDate>
      <category><![CDATA[org-mode]]></category>
      <guid isPermaLink="false">aZTTxoU6iiw0yoXhYnvYpHZepkU=</guid>
      <description>Add time to a deadline</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. s1</a></li>
<li><a href="#sec-2">2. s1</a></li>
<li><a href="#sec-3">3. s1</a></li>
</ul>
</div>
</div>
<p>
I have an application where an org-file is a template with some due dates in it. I would like to update the deadlines to make them all relative to today. In this post I explore a way to do that. The strategy is to find deadlines, parse the time out of the time stamp, add an appropriate amount of time, and replace the time stamp. For this exercise, we use this org-file, which has one DEADLINE of "2014-01-13 Mon", and I want to add 60 days to the time stamp. 
</p>

<p>
Amazingly, emacs can parse time strings into a format that it can understand. I do not claim to understand what this function returns, but it is some representation of time that emacs understands.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>)
</pre>
</div>

<p>
(21203 11392)
</p>

<p>
Now, we can add time to that format. Let us say I want to add 60 days. In emacs, we add seconds to a time, so 60 days is 60 days * 24 hours * 60 minutes * 60 seconds, or in elisp: (* 60 24 60 60).
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days))
</pre>
</div>

<p>
(21282 18048 0 0)
</p>

<p>
That does not make too much sense, so we can use another function to format it like a new time stamp.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (format-time-string <span style="color: #228b22;">"&lt;%Y-%m-%d %a&gt;"</span>
                      (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days)))
</pre>
</div>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2014-03-13 Thu&gt;</span></span>
</p>

<p>
Beautiful. We just got a timestamp that is 60 days later than the original timestamp. Now we just search forward to find deadline, get the time stamp, add the time to it, and replace the line. I specifically want to change deadlines, so we will develop a regular expression for that. Here is a block that searches forward for a DEADLINE, parses it, adds 60 days to it, and replaces the deadline. The regular expression is limited to timestamps that look like &lt;yyyy-mm-dd day&gt;, i.e. no warnings or repeaters are found. In this post, there is subheading that looks like this initially:
</p>

<p>
#+BEGIN<sub>EXAMPLE</sub>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> s1</h2>
<div class="outline-text-2" id="text-1">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">progn</span>
  (<span style="color: #8b0000;">save-excursion</span>
    <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">go to timestamp</span>
    (re-search-forward <span style="color: #228b22;">"DEADLINE:\\s-*&lt;</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{4\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">\\s-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">Mon</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Tue</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Wed</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Thu</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Fri</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sat</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sun</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">&gt;"</span>)
    (<span style="color: #8b0000;">let</span> ((ts (match-string 1)) <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">this is the timestamp</span>
          (sixty-days (seconds-to-time (* 60 24 60 60)))
          (new-ts))
      (setq new-ts (format-time-string <span style="color: #228b22;">"    DEADLINE: &lt;%Y-%m-%d %a&gt;"</span>
                                       (time-add (date-to-time ts) sixty-days)))
      <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">now we kill the old time stamp, and insert the new one</span>
      (beginning-of-line)
      (kill-line)
      (insert new-ts))))
</pre>
</div>

<p>
After we run the code above, the deadline looks like this:
#+BEGIN<sub>EXAMPLE</sub>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> s1</h2>
<div class="outline-text-2" id="text-2">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<p>
We succeeded in moving it by 60 days. An interesting application of this would be to make all the deadlines in an org-file relative to some baseline date. For example, you have a series of deadlines for assignments throughout a semester, and it would be tedious to update these by hand. Suppose you could just establish a new beginning date, and make all deadlines relative to that date with a command. That seems useful. 
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> s1</h2>
<div class="outline-text-2" id="text-3">
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/05/Add-time-to-a-deadline.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
    <item>
      <title>Literate programming example with Fortran and org-mode</title>
      <link>http://jkitchin.github.io/blog/2014/02/04/Literate-programming-example-with-Fortran-and-org-mode</link>
      <pubDate>Tue, 04 Feb 2014 10:22:00 EST</pubDate>
      <category><![CDATA[org-mode]]></category>
      <category><![CDATA[literate-programming]]></category>
      <guid isPermaLink="false">OrewfEby-EkWfWYRcNHp2BNoFwg=</guid>
      <description>Literate programming example with Fortran and org-mode</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. A slightly more complicated example.</a></li>
<li><a href="#sec-2">2. Summary key points</a></li>
</ul>
</div>
</div>
<p>
Update: see a short video of how this post works here: <a href="/media/2014-02-04-Literate-programming-example-with-Fortran-and-org-mode/literate-programming.swf">video</a> 
</p>

<p>
I want to illustrate the literate programming capabilities of org-mode. One idea in literate programming is to have code in blocks surrounded by explanatory text. There is a process called "tangling", which extracts the code, and possibly compiles and runs it. I have typically used python and emacs-lisp in org-mode, but today we look at using Fortran. 
</p>

<p>
The first simple example is a hello world fortran program. Typically you create a file containing code like this:
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span style="color: #8b0000;">PROGRAM</span> <span style="color: #8b2323;">hello</span>

<span style="color: #8b0000;">PRINT</span> *, <span style="color: #228b22;">"Hello world"</span>

<span style="color: #8b0000;">END</span> <span style="color: #8b0000;">PROGRAM</span> <span style="color: #8b2323;">hello</span>
</pre>
</div>

<p>
That file can be named something like hello.f90. We specify that in the source block header like this:
</p>

<pre class="example">
:tangle hello.f90
</pre>

<p>
There are a variety of ways to build your program. Let us create a makefile to do it. We will specify that this block is tangled to a Makefile like this:
</p>
<pre class="example">
:tangle Makefile
</pre>

<p>
Our Makefile will have three targets: 
</p>
<ol class="org-ol">
<li>hello, which compiles our program to an executable called a.out. 
</li>
<li>execute, which depends on hello, and runs the executable
</li>
<li>clean, which deletes a.out if it exists
</li>
</ol>

<div class="org-src-container">

<pre class="src src-makefile"><span style="color: #8b2323;">hello</span>:  hello.f90
        gfortran hello.f90

<span style="color: #8b2323;">execute</span>: hello
        ./a.out

<span style="color: #8b2323;">clean</span>:
        rm -f a.out *.o
</pre>
</div>

<p>
Now, we can run <pre>elisp:(org-babel-tangle)</pre> , which will extract these files to the current directory. Here is evidence that the files exist.
</p>

<div class="org-src-container">

<pre class="src src-sh">ls
</pre>
</div>

<pre class="example">
hello.f90
literate.org
Makefile
</pre>

<p>
Let us go a step further, and use the makefile to execute our program. The first time you run this, you will see that the 
</p>

<div class="org-src-container">

<pre class="src src-sh">make clean execute
</pre>
</div>

<pre class="example">
rm -f a.out *.o
gfortran hello.f90
./a.out
 Hello world
</pre>

<p>
That works well! The only really inconvenient issue is that if you update the Fortran code above, you have to manually rerun  <pre>elisp:(org-babel-tangle)</pre> , then run the <code>make execute</code> command. We can combine that in a single block, where you do both things at once. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-tangle)
(shell-command-to-string <span style="color: #228b22;">"make clean execute"</span>)
</pre>
</div>

<pre class="example">
rm -f a.out *.o
gfortran hello.f90
./a.out
 Hello world
</pre>

<p>
That is it in a nutshell. We had a source block for a Fortran program, and a source block for the Makefile. After tangling the org-file, we have those files available for us to use. Next, let us consider a little more complicated example.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> A slightly more complicated example.</h2>
<div class="outline-text-2" id="text-1">
<p>
Now, let us consider a Fortran code with two files. We will define a module file, and a program file. The module file contains a function to compute the area of a circle as a function of its radius. Here is our module file, which is tangled to circle.f90.
</p>

<div class="org-src-container">

<pre class="src src-fortran">MODULE Circle
      <span style="color: #4682b4;">implicit None</span>
      public :: area
<span style="color: #ff0000; font-weight: bold;">c</span><span style="color: #ff0000; font-weight: bold;">ontains</span>
      <span style="color: #8b0000;">function</span> <span style="color: #8b2323;">area</span>(r) 
      <span style="color: #4682b4;">implicit none</span>
      <span style="color: #4682b4;">real</span>, intent(in) :: r
      <span style="color: #4682b4;">real</span> :: area
      area = 3.14159 * r**2
      <span style="color: #8b0000;">return</span>
      <span style="color: #8b0000;">end</span> <span style="color: #8b0000;">function</span> <span style="color: #8b2323;">area</span>
<span style="color: #8b0000;">END</span> MODULE Circle
</pre>
</div>

<p>
Now, we write a program that will print a table of circle areas. Here we hard-code an array of 5 radius values, then loop through the values and get the area of the circle with that radius. We will print some output that generates an org-mode <a href="http://orgmode.org/manual/Tables.htm">table</a> . In this program, we <code>use</code> our module defined above.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span style="color: #8b0000;">program</span> <span style="color: #8b2323;">main</span>
      
use circle, only: area

<span style="color: #4682b4;">implicit none</span>
<span style="color: #4682b4;">integer</span> :: i
<span style="color: #4682b4;">REAL</span>, <span style="color: #4682b4;">DIMENSION</span>(<span style="color: #8b008b;">5</span>) :: R
R = (/1.0, 2.0, 3.0, 4.0, 5.0 /)

<span style="color: #8b0000;">print</span> *, <span style="color: #228b22;">"#+tblname: circle-area"</span>
<span style="color: #ff0000; font-weight: bold;">d</span><span style="color: #ff0000; font-weight: bold;">o i = 1, 5</span>
  <span style="color: #8b0000;">print</span> *, <span style="color: #228b22;">"|"</span>, R(i), <span style="color: #228b22;">"|"</span>, area(R(i)), <span style="color: #228b22;">"|"</span>
<span style="color: #8b0000;">end</span> <span style="color: #8b0000;">do</span>

<span style="color: #8b0000;">end</span> <span style="color: #8b0000;">program</span> <span style="color: #8b2323;">main</span>
</pre>
</div>

<p>
Now, we make a makefile that will build this program. I use a different name for the file, since we already have a Makefile in this directory from the last example.  I also put @ at the front of each command in the makefile to suppress it from being echoed when we run it. Later, we will use the makefile to compile the program, and then run it, and we only want the output of the program. 
</p>

<p>
The compiling instructions are more complex. We have to compile the circle module first, and then the main program. Here is our makefile. 
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span style="color: #8b2323;">circle</span>:
        <span style="color: #4682b4;">@</span>gfortran -c circle.f90

<span style="color: #8b2323;">main</span>: circle
        <span style="color: #4682b4;">@</span>gfortran -c main.f90
        <span style="color: #4682b4;">@</span>gfortran circle.o main.o -o main

<span style="color: #8b2323;">clean</span>:
        <span style="color: #4682b4;">@</span>rm -f *.o main
</pre>
</div>

<p>
Now, we run this block, which tangles out our new files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-tangle)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">main.f90</td>
<td class="left">circle.f90</td>
<td class="left">hello.f90</td>
<td class="left">makefile-main</td>
<td class="left">Makefile</td>
</tr>
</tbody>
</table>

<p>
Note that results above show we have tangled <i>all</i> the source blocks in this file. You can limit the scope of tangling, by narrowing to a subtree, but that is beyond our aim for today.
</p>

<p>
Finally, we are ready to build our program. We specify the new makefile with the <code>-f</code> option to make. We use the clean target to get rid of old results, and then the main target with builds the program. Since main depends on circle, the circle file is compiled first. 
</p>

<p>
Note in this block I use this header:
</p>
<pre class="example">
#+BEGIN_SRC sh :results raw
</pre>

<p>
That will tell the block to output the results directly in the buffer. I have the fortran code prename the table, and put | around the entries, so this entry is output directly as an org table. 
</p>

<div class="org-src-container">

<pre class="src src-sh">make -f makefile-main clean main
./main
</pre>
</div>

<table id="circle-area" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1.000000</td>
<td class="right">3.141590</td>
</tr>

<tr>
<td class="right">2.000000</td>
<td class="right">12.56636</td>
</tr>

<tr>
<td class="right">3.000000</td>
<td class="right">28.27431</td>
</tr>

<tr>
<td class="right">4.000000</td>
<td class="right">50.26544</td>
</tr>

<tr>
<td class="right">5.000000</td>
<td class="right">78.53975</td>
</tr>
</tbody>
</table>



<p>
It takes some skill getting used to using <code>:results raw</code>. The results are not replaced if you run the code again. That can be inconvenient if you print a very large table, which you must manually delete. 
</p>


<p>
Now that we have a named org table, I can use that table as data in other source blocks, e.g. here in python. You define variables in the header name by referring to the tblname like this.
</p>

<pre class="example">
#+BEGIN_SRC python :var data=circle-area
</pre>

<p>
Then, data is available as a variable in your code. Let us try it and plot the area vs. radius here. For more fun, we will make the plot <a href="http://xkcd.com/">xkcd</a> , so it looks like I sketched it by hand.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.xkcd()

<span style="color: #8b0000;">print</span> data <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">data is a list </span>
<span style="color: #8b008b;">data</span> = np.array(data)
plt.plot(data[:, 0], data[:, 1])
plt.xlabel(<span style="color: #228b22;">'radius'</span>)
plt.ylabel(<span style="color: #228b22;">'area'</span>)
plt.savefig(<span style="color: #228b22;">'circle-area.png'</span>)
</pre>
</div>

<pre class="example">
[[1.0, 3.14159], [2.0, 12.56636], [3.0, 28.27431], [4.0, 50.26544], [5.0, 78.53975]]
</pre>


<div class="figure">
<p><img src="/media/2014-02-04-Literate-programming-example-with-Fortran-and-org-mode/circle-area.png"> 
</p>
</div>

<p>
It appears the area increases quadratically with radius. No surprise there! For fun, let us show that. If we divide each area by \(r^2\), we should get back &pi;. Let us do this in emacs-lisp, just to illustrate how flexibly we can switch between languages. In lisp, the data structure will be a list of items like ((radius1 area1) (radius2 area2)&#x2026;). So, we just map a function that divides the area (the second element of an entry) by the square of the first element. My lisp-fu is only average, so I use the <code>nth</code> function to get those elements. We also load the calc library to get the math-pow function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">require</span> '<span style="color: #cd0000;">calc</span>)
(mapcar (<span style="color: #8b0000;">lambda</span> (x) (/ (nth 1 x) (math-pow (nth 0 x) 2))) data)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
</tr>
</tbody>
</table>


<p>
Indeed, we get &pi; for each element, which shows in fact that the area does increase quadratically with radius.
</p>

<p>
You can learn more about tangling source code from org-mode here <a href="http://orgmode.org/manual/Extracting-source-code.html">http://orgmode.org/manual/Extracting-source-code.html</a> .
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Summary key points</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>You can organize source files in org-mode as source blocks which can be "tangled" to "real" source code.
</li>
<li>You can build into your org-file(s) even the Makefile, or other building instructions.
</li>
<li>You can even run the build program, and the resulting programs from org-mode to capture data.
</li>
<li>Once that data is in org-mode, you can reuse it in other source blocks, including other languages. 
</li>
</ol>

<p>
What benefits could there be for this? One is you work in org-mode, which allows you to structure a document in different ways than code does. You can use headings to make the hierarchy you want. You can put links in places that allow you to easily navigate the document. Second, you can build in the whole workflow into your document, from building to execution. Third, you could have a self-contained file that extracts what someone else needs, but which has documentation and explanation built into it, <i>which you wrote as you developed the program</i>, rather than as an afterthought. You can still edit each block in its native emacs-mode, and have org-mode too. That is something like having cake, <i>and eating it too</i>!
</p>

<p>
Downsides? Probably. Most IDE/project type environments are designed for code. These tools offer nice navigation between functions and files. I don't use those tools, but I imagine if you are hooked on them, you might have to learn something new this way.
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/04/Literate-programming-example-with-Fortran-and-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>]]></content:encoded>
    </item>
  </channel>
</rss>
