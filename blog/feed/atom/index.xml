<?xml version="1.0" encoding="UTF-8"?>
<feed
  xmlns="http://www.w3.org/2005/Atom"
  xmlns:thr="http://purl.org/syndication/thread/1.0"
  xml:lang="en"
   >
  <title type="text">The Kitchin Research Group</title>
  <subtitle type="text">Chemical Engineering at Carnegie Mellon University</subtitle>

  <updated>2014-12-21T16:46:35Z</updated>
  <generator uri="http://blogofile.com/">Blogofile</generator>

  <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog" />
  <id>http://jkitchin.github.io/blog/feed/atom/</id>
  <link rel="self" type="application/atom+xml" href="http://jkitchin.github.io/blog/feed/atom/" />
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Capturing stderr from Python in org-mode - take 2]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2" />
    <id>http://jkitchin.github.io/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2</id>
    <updated>2014-12-21T11:46:11Z</updated>
    <published>2014-12-21T11:46:11Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="python" />
    <category scheme="http://jkitchin.github.io/blog" term="orgmode" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[Capturing stderr from Python in org-mode - take 2]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2"><![CDATA[


<p>
In a previous <a href="http://kitchingroup.cheme.cmu.edu/blog/2013/09/27/Capturing-stderr-and-exceptions-from-python-in-org-mode/">post</a> I wrote about a sandbox module to help capture stderr in Python code blocks in org-mode. That module worked, but ran as a script. 
</p>

<p>
stderr is not captured in the output of a code block in org-mode. For example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stdout, <span style="color: #228b22;">"message on stdout"</span>
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stderr, <span style="color: #228b22;">"testing stderr"</span>
</pre>
</div>

<pre class="example">
message on stdout
</pre>

<p>
The messages to stderr just disappears. Not good for code like this:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
[[ 1.]
 [ 1.]]
</pre>

<p>
There is an error in that code, k is not defined. If you run that as a script, you get this output:
</p>
<pre class="example">
&gt;&gt;&gt; Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
</pre>

<p>
But, that is evidently going to stderr, and not getting captured in org-mode. Boo. A silent error that returns a value! This behavior of odeint may be <a href="https://github.com/scipy/scipy/pull/4052">fixed</a> in scipy 0.15, but it is a general deficiency of org-mode babel code blocks. So, today I am looking back into a way to fix it. We try something as mundane as just redefining stderr in Python at runtime.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sys.stderr</span> = sys.stdout

<span style="color: #8b0000;">print</span> &gt;&gt;sys.stdout, <span style="color: #228b22;">"message on stdout"</span>
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stderr, <span style="color: #228b22;">"testing stderr"</span>
</pre>
</div>

<pre class="example">
message on stdout
testing stderr
</pre>

<p>
That works fine. Let us test it with the other block.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sys.stderr</span> = sys.stdout

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
[[ 1.]
 [ 1.]]
</pre>

<p>
Sweet, we get the errors. We still get the returned value, but it is immediately obvious something is wrong. I have wrapped that little tidbit into a Python module in <a href="https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py">pycse.orgmode</a> , which you can import to get the same effect.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> pycse.orgmode

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined

[[ 1.]
 [ 1.]]
</pre>

<p>
Finally, you can avoid the import by setting your org-babel Python command like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-babel-python-command <span style="color: #228b22;">"python -i -c \"import pycse.orgmode\""</span>)
</pre>
</div>

<pre class="example">
python -i -c "import pycse.orgmode"
</pre>

<p>
Now, we run our faulty block again:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined

[[ 1.]
 [ 1.]]
</pre>

<p>
Excellent. The stderr is captured.
</p>

<p>
And we get basically the same output as before for regular code blocks. There is an extra line before and after the output for some reason. I can live with that!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span> + <span style="color: #000000; background-color: #cccccc; font-weight: bold;">7</span>
</pre>
</div>

<pre class="example">
13
</pre>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/21/Capturing-stderr-from-Python-in-org-mode---take-2.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[A new mode for Python documentation]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation" />
    <id>http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation</id>
    <updated>2014-12-20T17:49:34Z</updated>
    <published>2014-12-20T15:02:05Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="python" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[A new mode for Python documentation]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation"><![CDATA[



<p>
The emacs-lisp documentation in Emacs is inspiring. It is interlinked, you can click on links to open source files, other commands, etc&#x2026; Python documentation is not that nice. It should be.
</p>

<p>
I wrote a little pydoc function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)
  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min)))
</pre>
</div>

<p>
which at least accesses python documentation in emacs. It looks like this:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-jasp.png"> 
</p>
</div>

<p>
But, this lacks functionality. I want there to be useful links in this, so I can click on the filename to open the source, or click on the packages to get their documentation. Below, we walk through a few functions that will operate on the buffer and put text properties on different pieces.
</p>

<p>
First, let us make the source file clickable so it opens the source.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-file-link</span> ()
  <span style="color: #228b22;">"Find FILE in a pydoc buffer and make it a clickable link"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^FILE</span>
<span style="color: #228b22;">    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">.*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">$"</span> nil t)

    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1))
          (source-file (match-string 1)))
      
      ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (find-file ,source-file)))
      ;<span style="color: #ff0000; font-weight: bold;">(remove-text-properties start end '(mouse-face nil))</span>
      (set-text-properties
       start end
       `(local-map, map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo <span style="color: #228b22;">"mouse-1: click to open"</span>)))))
</pre>
</div>

<pre class="example">
pydoc-make-file-link
</pre>

<p>
Next, sometimes there are URLs in the python documentation. These should all open up in a browser when you click on them. Here we propertize anything we recognize as a URL to make it open when clicked on.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-url-links</span> ()
  (goto-char (point-min))
  (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">http</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">s</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?://.*$</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1)))
        
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (browse-url ,(buffer-substring start end))))
        
      (set-text-properties
       start end
       `(local-map ,map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo (format <span style="color: #228b22;">"mouse-1: click to open"</span>))))))
</pre>
</div>

<p>
When we get documentation for a package, we should make each entry of the package clickable, so we can get to the documentation for that package easily. We store the name of the current package so we can construct the path to the subpackage.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-get-name</span> ()
  <span style="color: #228b22;">"get NAME and store locally"</span>
  (make-variable-buffer-local 'pydoc-name)
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^NAME</span>
<span style="color: #228b22;">\\s-*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">-][a-zA-Z]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (setq pydoc-name (match-string 1))))


(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-package-links</span> ()
  <span style="color: #228b22;">"make links in PACKAGE CONTENTS"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^PACKAGE CONTENTS"</span> nil t)
    (forward-line)

    (<span style="color: #8b0000;">while</span> (string-match
            <span style="color: #228b22;">"^    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-Z0-9_]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">[ ]?</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">(package)</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?"</span>
            (buffer-substring
             (line-beginning-position)
             (line-end-position)))
                
      (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
            (start (match-beginning 1))
            (end (match-end 1))
            (package (concat
                      pydoc-name <span style="color: #228b22;">"."</span>
                      (match-string 1
                                    (buffer-substring
                                     (line-beginning-position)
                                     (line-end-position))))))
        
        (define-key map [mouse-1]
          `(<span style="color: #8b0000;">lambda</span> ()
            (interactive)
            (pydoc ,package)))
          
        (set-text-properties
         (+ (line-beginning-position) start)
         (+ (line-beginning-position) end)
         `(local-map, map
                      font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                      mouse-face highlight
                      help-echo (format <span style="color: #228b22;">"mouse-1: click to open %s"</span> ,package))))
      (forward-line))))
</pre>
</div>

<p>
Next, we put some eye candy on function names and arguments. This won't do anything functionally, but it breaks up the monotony of all black text.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-colorize-functions</span> ()
  <span style="color: #228b22;">"Change color of function names and args."</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^Functions"</span> nil t)  
    (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-z0-9-]+</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">(</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">)]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">)"</span> nil t)
      (set-text-properties
       (match-beginning 1)
       (match-end 1)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"brown"</span>)))

      (set-text-properties
       (match-beginning 2)
       (match-end 2)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"red"</span>))))))
</pre>
</div>

<p>
I have gotten used to the [back] link in emacs-lisp documentation, so we try to emulate it here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-insert-back-link</span> ()
  <span style="color: #228b22;">"Insert link to previous buffer"</span>
  (goto-char (point-max)) 
  (insert <span style="color: #228b22;">"</span>
<span style="color: #228b22;">[back]"</span>)
  (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap)))
    
    ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
    (define-key map [mouse-1]
      (<span style="color: #8b0000;">lambda</span> ()
        (interactive)
        (pydoc *pydoc-last*)))

      (set-text-properties
       (line-beginning-position)
       (line-end-position)
       `(local-map, map
                    font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                    mouse-face highlight
                    help-echo <span style="color: #228b22;">"mouse-1: click to return"</span>))))
</pre>
</div>

<pre class="example">
pydoc-insert-back-link
</pre>

<p>
Ok, finally we remake the pydoc function. 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-current*</span> nil
 <span style="color: #228b22;">"Stores current pydoc command"</span>)

(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-last*</span> nil
 <span style="color: #228b22;">"Stores the last pydoc command"</span>)

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)

  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (setq buffer-read-only nil)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min))

  ;; <span style="color: #ff0000; font-weight: bold;">save </span>
  (<span style="color: #8b0000;">when</span> *pydoc-current*
      (setq *pydoc-last* *pydoc-current*))
  (setq *pydoc-current* name)


  (<span style="color: #8b0000;">save-excursion</span>
    (pydoc-get-name)
    (pydoc-make-url-links)
    (pydoc-make-file-link)
    (pydoc-make-package-links)
    (pydoc-colorize-functions)
    (pydoc-insert-back-link))

  ;; <span style="color: #ff0000; font-weight: bold;">make read-only and press q to quit</span>
  (setq buffer-read-only t)
  (use-local-map (copy-keymap org-mode-map))
  (local-set-key <span style="color: #228b22;">"q"</span> #'(<span style="color: #8b0000;">lambda</span> () (interactive) (kill-buffer)))

  (font-lock-mode))
</pre>
</div>

<pre class="example">
pydoc
</pre>

<p>
Now, we get a much more functional pydoc:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-enhanced-jasp.png"> 
</p>
<p><span class="figure-number">Figure 2:</span> Annotated screenshot</p>
</div>

<p>
and with the colorized function names:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-potcar.png"> 
</p>
</div>

<p>
Admittedly, there seems to be a lot of boilerplate code for propertizing the strings, but it doesn't seem too bad. I will probably use this documentation tool this spring, so maybe I will think of new functionality to add to pydoc. Any ideas?
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/20/A-new-mode-for-Python-documentation.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[org-mode + Python + git in a graduate engineering course]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/18/org-mode-+-Python-+-git-in-a-graduate-engineering-course" />
    <id>http://jkitchin.github.io/blog/2014/12/18/org-mode-+-Python-+-git-in-a-graduate-engineering-course</id>
    <updated>2014-12-19T11:19:51Z</updated>
    <published>2014-12-18T21:10:30Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="orgmode" />
    <category scheme="http://jkitchin.github.io/blog" term="education" />
    <summary type="html"><![CDATA[org-mode + Python + git in a graduate engineering course]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/18/org-mode-+-Python-+-git-in-a-graduate-engineering-course"><![CDATA[



<p>
The Fall 2014 semester is over! I thought I would summarize here what we did. I taught a Master's course in Chemical Reaction Engineering for the second time. This time we had 58 students from around the world. What is remarkable about this course is that this time it was taught completely from Emacs. Every lecture was given from Emacs, every assignment completed in Emacs, turned in from Emacs, graded in Emacs, returned in Emacs. 
</p>

<p>
Students came to class, opened Emacs, and ran a command that downloaded the latest syllabus and opened it. They opened the day's lecture notes from a link in the syllabus. I lectured from the notes in Emacs, editing them on the screen live, running Python code to illustrate engineering concepts. Students did exercises in class in Emacs, and ran an Emacs command to "turn it in" which pushed their work to a git server. Later, I ran an Emacs command to collect and grade the work, then return it. Students could run a menu command in Emacs to see their grade report.
</p>

<p>
Techela provided a menu of commands to turn in assignments, check grade reports, send me feedback, open the syllabus, etc&#x2026; The notes were written in org-mode, and we used org-latex-fragments to see the equations. We used code-blocks to show Python examples of problem solving, every day in class.  It was awesome!
</p>

<p>
The way this worked is that most of my students got laptops as part of the MS program they enrolled in. I had my <a href="http://github.com/jkitchin/jmax">jmax</a> repo installed on those computers, along with git, TexLive and Canopy Python. jmax provided a starter-kit for emacs that gave it the functionality I use on a regular basis. In jmax, I created a package of code I call techela, which interfaces Emacs with git, and which provides commands to download and turn in assignments, and to control permissions on each repo. This enabled me to change repos to read-only after they were due, and to grant read access when I wanted students to see them. About 15% of the class had their own computer, and we had to help them get this software installed. This got done in the first week of class, thanks to the help of my teaching assistants.
</p>

<p>
I ran a <a href="http://gitolite.com/gitolite/index.html">gitolite</a> server that served the course materials, and a repo for each assignment for each student. When students first ran techela, it created a set of ssh keys which were used to authenticate each student in the gitolite server. Techela automates creation of the repos, and the permissions on each repo. Grading of assignments was done in Emacs. Every assignment turned in was an org-file, and we stored grades in the assignments as file tags.  Techela constructed a dynamic gradebook on demand, among other things.
</p>

<p>
Org-mode played a central role in the success of this course! It enabled the distribution of the notes in a readable, functional form. The programmable aspects of org-mode made it possible to create custom links for machine-gradable multiple choice questions, assignments, and solutions. It made it possible to use the assignments as a data storage source for grades, and later to pull the grades out for analysis.
</p>

<p>
Overall, the experience was just awesome. Techela has a few edges that need smoothed out, but I look forward to using it again this spring, this time on a course on Molecular Simulation!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/18/org-mode-+-Python-+-git-in-a-graduate-engineering-course.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[New MS students joining the Kitchin Research Group]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/17/New-MS-students-joining-the-Kitchin-Research-Group" />
    <id>http://jkitchin.github.io/blog/2014/12/17/New-MS-students-joining-the-Kitchin-Research-Group</id>
    <updated>2014-12-17T09:32:11Z</updated>
    <published>2014-12-17T09:01:14Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="news" />
    <summary type="html"><![CDATA[New MS students joining the Kitchin Research Group]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/17/New-MS-students-joining-the-Kitchin-Research-Group"><![CDATA[


<p>
Four new MS students are joining the group!
</p>

<p>
Zhaofeng Chen will use density functional theory to model segregation in noble metal alloys.
</p>

<p>
Venkatesh Naik will investigate the apeciation of carbon dioxide in alkaline and amine‐containing solutions using Raman spectroscopy.
</p>

<p>
Hari Thirumalai will examine the effects of dispersion on scaling relations of atomic adsorbates using density functional theory.
</p>

<p>
Siddharth Deshpande will be co-advised by <a href="http://www.cmu.edu/me/people/venkat-viswanathan.html">Prof. Viswanathan</a> in Mechanical Engineering to use density functional theory to investigate non-precious metal sulfides for the oxygen reduction reaction.
</p>

<p>
Welcome to the group!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/17/New-MS-students-joining-the-Kitchin-Research-Group.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[New fellowships in the group]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/16/New-fellowships-in-the-group" />
    <id>http://jkitchin.github.io/blog/2014/12/16/New-fellowships-in-the-group</id>
    <updated>2014-12-16T17:35:59Z</updated>
    <published>2014-12-16T17:35:59Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="news" />
    <summary type="html"><![CDATA[New fellowships in the group]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/16/New-fellowships-in-the-group"><![CDATA[


<p>
Congratulations to Jake Boes for being selected to receive a Bertucci Graduate Fellowship in recognition of his accomplishments to date and potential for continued success! This fellowship was created through the generosity of John and Claire Bertucci and it was established to provide merit fellowships to graduate students pursuing doctoral degrees in Engineering in CIT.
</p>

<p>
Also congratulations to Mehak Chawla for being selected as the as the H. William and Ruth Hamilton Prengle Fellow of Chemical Enginering for 2014-2015 again!
</p>

<p>
Congratulations both of you!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/16/New-fellowships-in-the-group.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Selective auto-capitalization in org-buffers]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/12/03/Selective-auto-capitalization-in-org-buffers" />
    <id>http://jkitchin.github.io/blog/2014/12/03/Selective-auto-capitalization-in-org-buffers</id>
    <updated>2014-12-03T12:20:24Z</updated>
    <published>2014-12-03T12:20:24Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="orgmode" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[Selective auto-capitalization in org-buffers]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/12/03/Selective-auto-capitalization-in-org-buffers"><![CDATA[



<p>
I have been using auto-capitalize.el for a short time to automatically capitalize the beginning of sentences. I mostly like what it does, but in org-mode I tend to write short code blocks while still in org-mode, and it is pretty irritating for auto-capitalize to "fix" the capitalization of your code. Of course, I can type C-c ' to edit the block in its native mode, but I do not always want to do that.
</p>

<p>
Below, I illustrate an approach to turn off auto-capitalize-mode when the cursor is inside a code-block. Basically, we write a function that checks if you are in a src-block, and if auto-capitalize is on, turn it off. If you are not in the code-block, we turn auto-capitalize on if it is not on. Then we hook the function into post-command-hook, which will run it after every emacs command, including cursor movements.
</p>

<p>
Here is that code:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">dwiw-auto-capitalize</span> ()
  (<span style="color: #8b0000;">if</span> (org-in-block-p '(<span style="color: #228b22;">"src"</span>))
      (<span style="color: #8b0000;">when</span> auto-capitalize
        (auto-capitalize-mode -1))
    (<span style="color: #8b0000;">unless</span> auto-capitalize
      (auto-capitalize-mode 1))))

(add-hook 'post-command-hook 'dwiw-auto-capitalize)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">dwiw-auto-capitalize</td>
</tr>
</tbody>
</table>

<p>
It works! Now the minor mode turns on and off depending on where the cursor is in my org document.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/03/Selective-auto-capitalization-in-org-buffers.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[A database of quiz questions to generate quizzes and solutions]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/11/28/A-database-of-quiz-questions-to-generate-quizzes-and-solutions" />
    <id>http://jkitchin.github.io/blog/2014/11/28/A-database-of-quiz-questions-to-generate-quizzes-and-solutions</id>
    <updated>2014-11-28T14:41:45Z</updated>
    <published>2014-11-28T14:41:45Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="education" />
    <summary type="html"><![CDATA[A database of quiz questions to generate quizzes and solutions]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/11/28/A-database-of-quiz-questions-to-generate-quizzes-and-solutions"><![CDATA[


<p>
In this <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex/">post</a> I talked about a machine gradable quiz. One issue I have been trying to resolve is how to keep questions and solutions together. Currently, I have them separated, and that occasionally leads to them not being synchronized. One tricky part is if they are together, how do you create the quiz without answers in them? The answer is you have to "export" the quiz and selected problems, with selective content, and you want the elements of the question exported in some format, e.g. html or LaTeX.
</p>

<p>
I am going to explore representing a question as some data structure, not in org-mode for now. Then, we will use emacs-lisp to format the question the way we want it. The data we need about a question include the type of question, a unique id, the question, the choices, and the answer. For the choices, we might want some descriptive text for the solution. Here is one example of how we could represent a question as a struct in emacs-lisp. I do not claim here that this is the best or most complete way to represent it; it is simply a way that we could do it so we can discuss it later.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defstruct question type id question choices)
</pre>
</div>

<pre class="example">
question
</pre>

<p>
The defstruct macro creates a constructor function "make-question" for us, and we create questions like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq q1 (make-question
          <span style="color: #cd0000;">:type</span> 'multiple-choice
          <span style="color: #cd0000;">:id</span> <span style="color: #228b22;">"id:1"</span>
          <span style="color: #cd0000;">:question</span> <span style="color: #228b22;">"What is 2 + 2?"</span>
          <span style="color: #cd0000;">:choices</span> '(('choice 0 <span style="color: #228b22;">"Not correct"</span>)
                     ('choice 2 <span style="color: #228b22;">"Not correct"</span>)
                     ('choice 4 nil 'answer)
                     ('choice <span style="color: #228b22;">"None of the above"</span> <span style="color: #228b22;">"Not correct"</span>))))
</pre>
</div>

<pre class="example">
[cl-struct-question multiple-choice "id:1" "What is 2 + 2?" (((quote choice) 0 "Not correct") ((quote choice) 2 "Not correct") ((quote choice) 4 nil (quote answer)) ((quote choice) "None of the above" "Not correct"))]
</pre>

<p>
The defstruct macro also creates accessor functions to get the information stored in the question. These go by "question-SLOTNAME" and they make it pretty easy to get the data. We can convert this structure to an org-mode formatted question by using a formatted string, substituting values from the question object where we want them. I will make the headline contain the question, create some properties, and then make an org-link for each choice. The mc link is something I defined in the previous post.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(format <span style="color: #228b22;">"** %s</span>
<span style="color: #228b22;">  :PROPERTIES:</span>
<span style="color: #228b22;">  :ID: %s</span>
<span style="color: #228b22;">  :END:</span>
<span style="color: #228b22;">%s"</span> (question-question q1)
(question-id q1) 
(mapconcat 'identity (loop for i to (length (question-choices q1))
                           for choice in (question-choices q1)
                           collect
                           (format <span style="color: #228b22;">"[[mc:%s]] %s"</span> i (elt choice 1)))
           <span style="color: #228b22;">"\n"</span>))
</pre>
</div>

<pre class="example">
** What is 2 + 2?
  :PROPERTIES:
  :ID: id:1
  :END:
[[mc:0]] 0
[[mc:1]] 2
[[mc:2]] 4
[[mc:3]] None of the above
</pre>

<p>
To generate a quiz, we would just need to loop over several questions and insert the strings into a buffer then save it to a file. 
</p>

<p>
To generate the key, we use pretty similar code, and additionally find the choice that is the answer, and print any hints with the choices.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(format <span style="color: #228b22;">"** %s</span>
<span style="color: #228b22;">  :PROPERTIES:</span>
<span style="color: #228b22;">  :ID: %s</span>
<span style="color: #228b22;">  :CORRECT-ANSWER: %s</span>
<span style="color: #228b22;">  :END:</span>
<span style="color: #228b22;">%s"</span> (question-question q1)
    (question-id q1)
    ;; <span style="color: #ff0000; font-weight: bold;">here we loop through the choices looking for the answer </span>
    (loop for choice in (question-choices q1)
          until (-contains? choice '(quote answer))
          finally return (elt choice 1))
    (mapconcat 'identity (loop for i to (length (question-choices q1))
                               for choice in (question-choices q1)
                               collect
                               (format <span style="color: #228b22;">"[[mc:%s]] %s</span>
<span style="color: #228b22;">%s"</span> i (elt choice 1) (or (elt choice 2) <span style="color: #228b22;">""</span>)))
               <span style="color: #228b22;">"\n"</span>))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #8b008b;">** What is 2 + 2?</span>
<span style="color: #8b0000;">  :PROPERTIES:</span>
  <span style="color: #8b0000;">:ID:</span> id:1
  <span style="color: #8b0000;">:CORRECT-ANSWER:</span> 4
<span style="color: #8b0000;">  :END:</span>
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:0">mc:0</a></span> 0
Not correct
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:1">mc:1</a></span> 2
Not correct
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:2">mc:2</a></span> 4

<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:3">mc:3</a></span> None of the above
Not correct
</pre>
</div>

<p>
It is a similar process to convert to LaTeX or HTML as well, just different syntax in the format statement. 
</p>

<p>
The next question is how to make authoring the questions pretty easy, i.e. with a minimal amount of syntax that represents the question data and is easy to transform. The lisp data structure is not too bad, but might be less familiar to many. Next we consider how to represent this question in org-mode. For example the question would be in a headline, and the ID and answer stored as properties. The choices might be stored as sub-headings that are tagged as choices. Then, constructing the question would entail going to the question headline, getting the information you want, and formatting it like I did above. The next section represents a question in org-mode. I think it actually takes more typing to do this, but some of it reuses some org-machinery I am familiar with. In any case, it is possible to store all the same kind of information using combinations of tags and properties. The next section is the question (only really visible in org-mode, not in the html post), and the section after that is how to use it.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a id="ID-99D480BD-9651-4987-9646-4BE90BA6CAEC" name="ID-99D480BD-9651-4987-9646-4BE90BA6CAEC"></a><span class="section-number-2">1</span> What is 2 + 2?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multiple_choice">multiple_choice</span></span></h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 0&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-1">
<p>
Not correct, This is the answer to 2 - 2.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-2">
<p>
Not correct
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> 4&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span>&#xa0;<span class="answer">answer</span></span></h3>
<div class="outline-text-3" id="text-1-3">
<p>
Correct. 
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> None of the above&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-4">
<p>
This is not correct
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Working with the org representation of a question</h2>
<div class="outline-text-2" id="text-2">
<p>
Now, we use the org-machinery to work with the question and represent it in different formats. Here we just get the choices for a question with a specific id. We jump to the question, find headings tagged choice, and collect them.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">save-excursion</span>
  (org-open-link-from-string <span style="color: #228b22;">"id:99D480BD-9651-4987-9646-4BE90BA6CAEC"</span>)
  (<span style="color: #8b0000;">save-restriction</span>
    (org-narrow-to-subtree)
    (<span style="color: #8b0000;">let</span> ((choices '()))
      (org-map-entries
       (<span style="color: #8b0000;">lambda</span> ()
         (add-to-list
          'choices
          (org-heading-components)
          t))
       <span style="color: #228b22;">"choice"</span>)
      choices)))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="right" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">0</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">2</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">4</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">None of the above</td>
<td class="left">:choice:</td>
</tr>
</tbody>
</table>

<p>
You could use the headline for each choice to construct a question. For example, here we output some HTML to represent checkboxes in an HTML form.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">save-excursion</span>
  (org-open-link-from-string <span style="color: #228b22;">"id:99D480BD-9651-4987-9646-4BE90BA6CAEC"</span>)
  (<span style="color: #8b0000;">let</span> ((all-choices 
         (<span style="color: #8b0000;">save-restriction</span>
           (org-narrow-to-subtree)
           (<span style="color: #8b0000;">let</span> ((choices '()))
             (org-map-entries
              (<span style="color: #8b0000;">lambda</span> ()
                (add-to-list
                 'choices
                 (elt (org-heading-components) 4)
                 t))
              <span style="color: #228b22;">"choice"</span>)
             choices)))
        (question (elt (org-heading-components) 4))
        )
    (concat
     <span style="color: #228b22;">"&lt;html&gt;&lt;body&gt;\n"</span>
     <span style="color: #228b22;">"&lt;h1&gt;"</span> question <span style="color: #228b22;">"&lt;/h1&gt;\n"</span>
     <span style="color: #228b22;">"&lt;form action = \"\"&gt;"</span>
     (mapconcat
      'identity
      (loop for choice in all-choices
            collect       
            (format <span style="color: #228b22;">"  &lt;input type=\"checkbox\" name=\"choice\" value=\"%s\"&gt;%s&lt;br&gt;"</span>
                    choice choice))
      <span style="color: #228b22;">"\n"</span>)
     <span style="color: #228b22;">"\n&lt;/form&gt;\n"</span>
     <span style="color: #228b22;">"&lt;/body&gt;&lt;/html&gt;"</span>)))
</pre>
</div>
<html><body>
<h1>What is 2 + 2?</h1>
<form action = "">  <input type="checkbox" name="choice" value="0">0<br>
  <input type="checkbox" name="choice" value="2">2<br>
  <input type="checkbox" name="choice" value="4">4<br>
  <input type="checkbox" name="choice" value="None of the above">None of the above<br>
</form>
</body></html>

<p>
There is no action button to submit this answer, but you could add one if wanted. Clearly, you will have custom functions to export each format you want, with the information you want in it. The code for the org-mode representation is a little more verbose than the lisp data representation, but they accomplish basically the same thing. One thing that would be necessary to do is create some functions that take a list of question IDs and generate the quiz and solution in a buffer, and a helm interface for question selection would be pretty sweet.
</p>

<p>
I can see adding several other pieces of information about a problem, including categories or keywords, level of difficulty, how many points the problem is worth, last time it was assigned, relationship to course learning objectives, maybe information about who authored the problem, and a source if that is appropriate. These would allow you to consider machine grading, or correlating performance between problems, assessing how a class is doing on a problem, etc&#x2026; Lots of potential here.</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/11/28/A-database-of-quiz-questions-to-generate-quizzes-and-solutions.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[New publication in J. Physical Chemistry C on oxygen vacancies in perovskites]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/11/26/New-publication-in-J-Physical-Chemistry-C-on-oxygen-vacancies-in-perovskites" />
    <id>http://jkitchin.github.io/blog/2014/11/26/New-publication-in-J-Physical-Chemistry-C-on-oxygen-vacancies-in-perovskites</id>
    <updated>2014-11-26T10:55:10Z</updated>
    <published>2014-11-26T10:52:54Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="news" />
    <summary type="html"><![CDATA[New publication in J. Physical Chemistry C on oxygen vacancies in perovskites]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/11/26/New-publication-in-J-Physical-Chemistry-C-on-oxygen-vacancies-in-perovskites"><![CDATA[



<p>
"Effects of Concentration, Crystal Structure, Magnetism, and Electronic Structure Method on First-Principles Oxygen Vacancy Formation Energy Trends in Perovskites"
J. Phys. Chem. C, Article ASAP
DOI: 10.1021/jp507957n
</p>

<p>
Check out the amazing supporting information file: <a href="http://pubs.acs.org/doi/suppl/10.1021/jp507957n">http://pubs.acs.org/doi/suppl/10.1021/jp507957n</a> 
It has embedded data files and code in it for reproducing the results in the manuscript.
</p>

<p>
Congratulations Matt!
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">curnan-2014-effec-concen</span>,
  <span style="color: #8b008b;">author</span> =       {Curnan, Matthew T. and Kitchin, John R.},
  <span style="color: #8b008b;">title</span> =        {Effects of Concentration, Crystal Structure,
                  Magnetism, and Electronic Structure Method on
                  First-Principles Oxygen Vacancy Formation Energy
                  Trends in Perovskites},
  <span style="color: #8b008b;">journal</span> =      {The Journal of Physical Chemistry C},
  <span style="color: #8b008b;">volume</span> =       0,
  <span style="color: #8b008b;">number</span> =       0,
  <span style="color: #8b008b;">pages</span> =        {null},
  <span style="color: #8b008b;">year</span> =         2014,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/jp507957n</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;"> http://dx.doi.org/10.1021/jp507957n </span>},
  <span style="color: #8b008b;">eprint</span> =       { http://dx.doi.org/10.1021/jp507957n },
}
</pre>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/11/26/New-publication-in-J.-Physical-Chemistry-C-on-oxygen-vacancies-in-perovskites.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Machine-gradable quizzes in emacs+org-modex]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex" />
    <id>http://jkitchin.github.io/blog/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex</id>
    <updated>2014-11-23T16:49:52Z</updated>
    <published>2014-11-23T16:49:52Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org" />
    <category scheme="http://jkitchin.github.io/blog" term="education" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[Machine-gradable quizzes in emacs+org-modex]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex"><![CDATA[



<p>
In a previous <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/01/01/Interactive-quizzes-with-feedback-in-org-mode/">post</a> , we considered interactive quizzes in emacs and org-mode. Here we consider a variation of that idea with the aim of creating a machine-gradable quiz, i.e. a modern version of a scantron.
</p>

<p>
The idea is simple, we will let each question be represented by an org headline, and the choices will be clickable links that store the answer as a property in the headline. Each headline will have a unique id. The grading key will contain these ids and the correct answer, and a function will determine if the right answer was selected for each question.
</p>

<p>
Here is a simple link that will store the value of the link as a property. Note that the path must be at least two characters long to be recognized as a link, unless you wrap the link in double brackets. We will have the link insert a comment to indicate to the user what they chose. We do that because the PROPERTIES drawer is usually hidden, and it is not obvious it was changed.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-add-link-type 
 <span style="color: #228b22;">"mc"</span> 
 (<span style="color: #8b0000;">lambda</span> (link)
   (<span style="color: #8b0000;">save-restriction</span>
     (org-narrow-to-subtree)
     (goto-char (point-max))
     (insert (concat
              (<span style="color: #8b0000;">unless</span> (bolp) <span style="color: #228b22;">"\n"</span>)
              (format <span style="color: #228b22;">"# you chose %s"</span> link))))
       
   (org-entry-put (point) <span style="color: #228b22;">"ANSWER"</span> link)))
</pre>
</div>

<p>
Next, we add a subheading with some questions to test the link.
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Some questions</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><a id="ID-19C7BA30-A761-4C94-9F3B-E6010E263949" name="ID-19C7BA30-A761-4C94-9F3B-E6010E263949"></a><span class="section-number-3">1.1</span> question 1</h3>
<div class="outline-text-3" id="text-1-1">
<p>
What is 2 + 2?
</p>

<p>
<a href="a">a</a> 1
</p>

<p>
<a href="b">b</a> 2
</p>

<p>
<a href="c">c</a> 4
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><a id="ID-38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9" name="ID-38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9"></a><span class="section-number-3">1.2</span> question 2</h3>
<div class="outline-text-3" id="text-1-2">
<p>
What is 2 - 2?
</p>

<p>
<a href="a">a</a> 0
</p>

<p>
<a href="b">b</a> 2
</p>

<p>
<a href="c">c</a> 4
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Grading</h2>
<div class="outline-text-2" id="text-2">
<p>
We will store an alist of id and answer for each problem. To grade, we simple map over the alist, go to the section with the id, and compare the answers. When the answer is correct, we save a point, and when not, no point. We can use the org-mode machinery to jump to the problems and get the stored answer. We put some feedback at the end of the file to see what was right, and what was wrong.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((key '((<span style="color: #228b22;">"19C7BA30-A761-4C94-9F3B-E6010E263949"</span> . <span style="color: #228b22;">"c"</span>)
              (<span style="color: #228b22;">"38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9"</span> . <span style="color: #228b22;">"a"</span>)))
       (MAX (length key))
       (points 0)
       (answer))
  
  (<span style="color: #8b0000;">dolist</span> (tup key)
    (<span style="color: #8b0000;">save-excursion</span>
      (org-open-link-from-string
       (format <span style="color: #228b22;">"id:%s"</span> (car tup)))
      (setq answer (org-entry-get (point) <span style="color: #228b22;">"ANSWER"</span>))
      (<span style="color: #8b0000;">if</span> (string= answer (cdr tup))
          (<span style="color: #8b0000;">progn</span>
            (setq points (+ 1 points))
            (goto-char (point-max))
            (insert (format <span style="color: #228b22;">"# id:%s: %s correct\n"</span> (car tup) answer)))
        (goto-char (point-max))
        (insert (format <span style="color: #228b22;">"# id:%s: %s wrong (%s is correct)\n"</span>
                        (car tup)
                        answer
                        (cdr tup))))))
  (goto-char (point-max))
  (insert (format
           <span style="color: #228b22;">"#+GRADE: %s"</span> (/ (float points) (float MAX)))))
</pre>
</div>

<p>
That works pretty well. I need to think about how to codify the key, since this would usually be stored in some file. We would also need to wrap the code block in a function that we could call easily. The org-id key is easy, but not very readable. It would make it easy to keep a database of these problems though. 
</p>
<p>
Just for completeness, I want to save the key to a file, and use it. We simply write the alist in a file. Here are the contents, which are tangled to key.el. One alternative might be to have a solution copy of the quiz which has the answers in it, and we read the answers from the file.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">((<span style="color: #228b22;">"19C7BA30-A761-4C94-9F3B-E6010E263949"</span> . <span style="color: #228b22;">"c"</span>)
 (<span style="color: #228b22;">"38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9"</span> . <span style="color: #228b22;">"a"</span>))
</pre>
</div>

<p>
Now, we read it in like this. The rest of the code is basically the same.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((key (<span style="color: #8b0000;">with-temp-buffer</span> 
              (insert-file-contents <span style="color: #228b22;">"key.el"</span>)
              (read (current-buffer))))
       (MAX (length key))
       (points 0)
       (answer))
  
  (<span style="color: #8b0000;">dolist</span> (tup key)
    (<span style="color: #8b0000;">save-excursion</span>
      (org-open-link-from-string
       (format <span style="color: #228b22;">"id:%s"</span> (car tup)))
      (setq answer (org-entry-get (point) <span style="color: #228b22;">"ANSWER"</span>))
      (<span style="color: #8b0000;">if</span> (string= answer (cdr tup))
          (<span style="color: #8b0000;">progn</span>
            (setq points (+ 1 points))
            (goto-char (point-max))
            (insert (format <span style="color: #228b22;">"# id:%s: %s correct\n"</span> (car tup) answer)))
        (goto-char (point-max))
        (insert (format <span style="color: #228b22;">"# id:%s: %s wrong (%s is correct)\n"</span>
                        (car tup)
                        answer
                        (cdr tup))))))
  (goto-char (point-max))
  (insert (format
           <span style="color: #228b22;">"#+GRADE: %s"</span> (/ (float points) (float MAX)))))
</pre>
</div>

<p>
It is probably much easier to have a solution version of the quiz, and generate the key from it. For example, we can collect the ID and ANSWER from the problems in this file like this.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((key '()))
  (org-map-entries
   (<span style="color: #8b0000;">lambda</span> ()
     (<span style="color: #8b0000;">let</span> ((id) (ans))
       (<span style="color: #8b0000;">when</span> (and
              (setq id (org-entry-get (point) <span style="color: #228b22;">"ID"</span>))
              (setq ans (org-entry-get (point) <span style="color: #228b22;">"ANSWER"</span>)))
         (add-to-list 'key (cons id ans))))))
key)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">((<span style="color: #228b22;">"38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9"</span> . <span style="color: #228b22;">"a"</span>)
 (<span style="color: #228b22;">"19C7BA30-A761-4C94-9F3B-E6010E263949"</span> . <span style="color: #228b22;">"c"</span>))
</pre>
</div>

<p>
So, if we had a master solution file, we could read the key from there. That is the way to do this.
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[A helm interface to ps]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/11/22/A-helm-interface-to-ps" />
    <id>http://jkitchin.github.io/blog/2014/11/22/A-helm-interface-to-ps</id>
    <updated>2014-11-22T15:00:25Z</updated>
    <published>2014-11-22T12:57:42Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="helm emacs" />
    <summary type="html"><![CDATA[A helm interface to ps]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/11/22/A-helm-interface-to-ps"><![CDATA[


<p>
Occassionally, I need to find the PID of a process to kill it or do something else. Usually I do the old-school unix thing  of piping the output of one command (ps) to another command (grep) to filter out interesting lines. Then, I can do something with that output.
</p>

<div class="org-src-container">

<pre class="src src-sh">ps aux | grep emacs
</pre>
</div>

<pre class="example">
jkitchin         4781   3.1  0.8  2639316  70432 s002  S    12:45PM   0:06.68 /usr/local/Cellar/emacs/HEAD/Emacs.app/Contents/MacOS/Emacs
jkitchin         4777   0.0  0.0  2433364    932 s002  S    12:45PM   0:00.00 /bin/bash /usr/local/bin/emacs
jkitchin         4874   0.0  0.0  2432784    604   ??  S    12:46PM   0:00.00 grep emacs
</pre>

<p>
Today, I will explore using helm in emacs to do something like that. The idea is to create a helm command that uses the output of ps as candidates, and then you select the process you want through the helm interface, and then select an action.
</p>

<p>
It is easy enough to get the output of the ps command in emacs like this. Here, we just get the first three results, and specify the output we want.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((results (split-string
                (shell-command-to-string
                 <span style="color: #228b22;">"ps x -o ruser,pid,command"</span>) <span style="color: #228b22;">"\n"</span>)))
  (loop for i from 1 to 3
        collect (elt results i)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #228b22;">"jkitchin   139 /sbin/launchd"</span> <span style="color: #228b22;">"jkitchin   151 /usr/libexec/UserEventAgent (Aqua)"</span> <span style="color: #228b22;">"jkitchin   152 /usr/sbin/distnoted agent"</span>)
</pre>
</div>

<p>
These will be the candidates for the helm command. We will create a few actions. One will provide details about the pid, and one could in principle kill the pid or send some signal to it. We will just have these actions create message boxes for us to see helm in action. We will make the kill function interactive, so it allows an arbitrary signal to be sent. The other actions are placeholders for future actions, and so we can show off some shortcuts in helm later.
</p>

<p>
For the candidates, we will construct a list of cons cells where the car is a line from ps, and that is what will show in the helm selection interface, and the cdr will be the pid which we get by parsing the line to get the second element. When you select an entry in helm, the cdr of that entry (if it exists) is passed to the action function selected.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-candidates</span> ()
  <span style="color: #228b22;">"return a list of cons cells (line . pid) for the output of ps"</span>
  (loop for line in
        ;; <span style="color: #ff0000; font-weight: bold;">skip the first line which is a header</span>
        (cdr (split-string
              (shell-command-to-string
               <span style="color: #228b22;">"ps ax -o ruser,pid,command"</span>) <span style="color: #228b22;">"\n"</span>))
        collect
        (cons
         line
         (elt (split-string line) 1))))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-details</span> (pid)
  <span style="color: #228b22;">"give details of PID."</span>
  (message-box <span style="color: #228b22;">"%s"</span> (shell-command-to-string (format <span style="color: #228b22;">"ps ux %s"</span> pid))))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-kill</span> (pid)
  <span style="color: #228b22;">"Message box instead of killing PID."</span>
  (<span style="color: #8b0000;">let</span> ((SIG (read-string <span style="color: #228b22;">"Kill with signal: "</span>)))
    (message-box <span style="color: #228b22;">"Killing pid %s with signal %s"</span> pid SIG)))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-hello</span> (pid)
  (message-box <span style="color: #228b22;">"Silly 3rd action for %s"</span> pid))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-bye</span> (pid)
  (message-box <span style="color: #228b22;">"Silly 4th action for %s"</span> pid))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">ps-byebye</span> (pid)
  (message-box <span style="color: #228b22;">"Silly 5th action for %s"</span> pid))

;; <span style="color: #ff0000; font-weight: bold;">the source variable for helm</span>
(setq helm-source-ps '((name . <span style="color: #228b22;">"ps output"</span>)
                       ;; <span style="color: #ff0000; font-weight: bold;">these are the entries you can select</span>
                       (candidates . ps-candidates)
                       ;; <span style="color: #ff0000; font-weight: bold;">these are the actions available for the</span>
                       ;; <span style="color: #ff0000; font-weight: bold;">selected entry. each function gets the cdr</span>
                       ;; <span style="color: #ff0000; font-weight: bold;">of the entry selected.</span>
                       (action . ((<span style="color: #228b22;">"details"</span> . ps-details)
                                  (<span style="color: #228b22;">"kill"</span> . ps-kill)
                                  (<span style="color: #228b22;">"hello"</span> . ps-hello)
                                  (<span style="color: #228b22;">"bye"</span> . ps-bye)
                                  (<span style="color: #228b22;">"byb-bye"</span> . ps-byebye)))))

;; <span style="color: #ff0000; font-weight: bold;">now we run the helm command</span>
(helm <span style="color: #cd0000;">:sources</span> '(helm-source-ps))
</pre>
</div>


<p>
You can navigate the helm interface with the arrows, or C-n (next/down) C-p (previous/up), or by typing in the pattern you want to match. There are only two actions here. The first one is the default action, which you can run by pressing tab or enter. The subtle difference between them is that tab leaves the helm window open, while enter runs the default action and closes the helm window. You can get it back with C-c h r (or M-x helm-resume). 
</p>

<p>
To get the kill function, you can press C-z to get the action menu, and then press enter. Helm provides a shortcut for this. C-e selects the second action, so when you remember what the second action is and you want it, you can skip the C-z activity. You can access the third action with C-j. There is a command like helm-select-4th-action, but it is not bound to a key, so we have to make one like this.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(define-key helm-map (kbd <span style="color: #228b22;">"C-k"</span>) 'helm-select-4th-action)
</pre>
</div>

<p>
You can also define a 5th action like this. It does not seem possible to define an arbitrary nth action, because you cannot get an input for n while helm uses the minibuffer. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">5th-action</span> ()
 (interactive)
 (<span style="color: #8b0000;">let</span> ((n 5))
   ;; <span style="color: #ff0000; font-weight: bold;">actions start at 0, so the 5th action is actually indexed at 4</span>
   (helm-select-nth-action (- n 1))))

(define-key helm-map (kbd <span style="color: #228b22;">"C-l"</span>) '5th-action)
</pre>
</div>

<p>
That is the proof of concept in using a helm interface to interact with unix commands. There are other actions you might choose, like renice, or maybe it is possible to suspend a job by pid. The real application for this I had in mind was interaction with the Torque queue system, where you might want to modify, kill jobs in the queue system this way. I could also see applications in user management, where you have some well defined functions to run, e.g. checking quotas, changing passwords, etc&#x2026; Clearly the utility of this approach rests heavily on there being a set of actions you do regularly enough to justify coding them into functions, and often enough you would remember to use your helm command! It is an interesting approach as an alternative to writing shell scripts to do this though.
</p>

<p>
This post might make more sense if you watch this video of the helm interface in action: <a href="http://www.youtube.com/watch?v=3FImB6OwHI0">http://www.youtube.com/watch?v=3FImB6OwHI0</a> </p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/11/22/A-helm-interface-to-ps.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
</feed>
