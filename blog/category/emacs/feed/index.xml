<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:wfw="http://wellformedweb.org/CommentAPI/"
     >
  <channel>
    <title>The Kitchin Research Group</title>
    <link>http://jkitchin.github.io/blog</link>
    <description>Chemical Engineering at Carnegie Mellon University</description>
    <pubDate>Mon, 09 Mar 2015 19:15:16 GMT</pubDate>
    <generator>Blogofile</generator>
    <sy:updatePeriod>hourly</sy:updatePeriod>
    <sy:updateFrequency>1</sy:updateFrequency>
    <item>
      <title>Bibtex Entries from Arxiv.org</title>
      <link>http://jkitchin.github.io/blog/2015/03/09/Bibtex-Entries-from-Arxiv-org</link>
      <pubDate>Mon, 09 Mar 2015 15:14:52 EDT</pubDate>
      <category><![CDATA[bibtex]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">HE-BdWxxqUIs7VAhvRQXrqoIpes=</guid>
      <description>Bibtex Entries from Arxiv.org</description>
      <content:encoded><![CDATA[



<p>
<a href="http://arxiv.org">http://arxiv.org</a> is an open-source physics preprint server where copies of scientific manuscripts can be found. For example, <a href="http://arxiv.org/abs/0801.1144">http://arxiv.org/abs/0801.1144</a> is a paper I wrote, and you can find the PDF for that paper here: <a href="http://arxiv.org/pdf/0801.1144v1">http://arxiv.org/pdf/0801.1144v1</a> . Each entry at Arxiv has an arxiv number, and for this paper the number is "0801.1144". In this post, we explore some capabilities of the <a href="https://github.com/jkitchin/org-ref/blob/master/arxiv.el">arxiv.el</a> library which is part of org-ref (<a href="https://github.com/jkitchin/org-ref">https://github.com/jkitchin/org-ref</a> ).
</p>

<p>
To use this library, get the org-ref distribution, make sure it is on your path, and then require the library:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">arxiv</span>)
</pre>
</div>

<p>
First, there is a new org-link:  <a href="http://arxiv.org/abs/0801.1144">arxiv:0801.1144</a>. This is a clickable link that simply opens arxiv.org at the URL for an arxiv number, and exports as a link to that entry in arxiv.
</p>

<p>
On the right hand side of the arxiv page, there is a link under References &amp; Citations that takes you to a page where you can get a bibtex entry. The link for this entry is <a href="http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:0801.1144">http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:0801.1144</a> . On that page, there is a link to a bibtex entry (<a href="http://adsabs.harvard.edu/cgi-bin/nph-bib_query?bibcode=2008PhRvB..77g5437K&data_type=BIBTEX&db_key=PHY&nocookieset=1">http://adsabs.harvard.edu/cgi-bin/nph-bib_query?bibcode=2008PhRvB..77g5437K&data_type=BIBTEX&db_key=PHY&nocookieset=1</a> ).  We can construct this link pretty easily, we just need the bibcode for that entry. arxiv.el provides a function for that.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(arxiv-get-bibliographic-code <span style="color: #008000;">"0801.1144"</span>)
</pre>
</div>

<pre class="example">
2008PhRvB..77g5437K
</pre>

<p>
Next, once we have a url, we can get the text of the bibtex entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(arxiv-get-bibtex-entry <span style="color: #008000;">"2008PhRvB..77g5437K"</span>)
</pre>
</div>

<pre class="example">
@ARTICLE{2008PhRvB..77g5437K,
   author = {{Kitchin}, J.~R. and {Reuter}, K. and {Scheffler}, M.},
    title = "{Alloy surface segregation in reactive environments: First-principles atomistic thermodynamics study of Ag$_{3}$Pd(111) in oxygen atmospheres}",
  journal = {\prb},
archivePrefix = "arXiv",
   eprint = {0801.1144},
 primaryClass = "cond-mat.mtrl-sci",
 keywords = {Ab initio calculations of adsorbate structure and reactions, Density functional theory local density approximation gradient and other corrections, Oxidation},
     year = 2008,
    month = feb,
   volume = 77,
   number = 7,
      eid = {075437},
    pages = {075437},
      doi = {10.1103/PhysRevB.77.075437},
   adsurl = {http://adsabs.harvard.edu/abs/2008PhRvB..77g5437K},
  adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}
</pre>

<p>
Finally, arxiv.el wraps those to functions together into an interactive function <code>arxiv-add-bibtex-entry</code> which prompts you for an arxiv number, and then a bibtex file, and then adds the text above to your bibtex file. You can then clean the entry as you see fit. It is also possible to get the pdf for an arxiv entry via <code>arxiv-get-pdf</code>. This is an interactive function that will prompt you for an arxiv number and a pdf file name, and it will then get the pdf for you and open it. I have not integrated this with the bibtex entry function yet, but one would ideally clean the bibtex entry to get a uniform key, and then get the pdf and name it according to the key like we do in org-ref.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(arxiv-get-pdf <span style="color: #008000;">"0801.1144"</span> <span style="color: #008000;">"0801.1144.pdf"</span>)
</pre>
</div>

<p>
If you use <a href="https://github.com/jkitchin/jmax/blob/master/words.el">words.el</a> you will find a new function <code>words-arxiv</code> which allows you to search the selected text or word at point on arxiv.org.
</p>

<p>
I do not use arxiv.org a lot, so this is not super well tested on many articles in arxiv.org, but it has worked on the few examples I have tested so far.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/03/09/Bibtex-Entries-from-Arxiv.org.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>org-mode links meet hydra</title>
      <link>http://jkitchin.github.io/blog/2015/02/22/org-mode-links-meet-hydra</link>
      <pubDate>Sun, 22 Feb 2015 19:06:41 EST</pubDate>
      <category><![CDATA[orgmode]]></category>
      <category><![CDATA[hydra]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">TYEqdqY8zmTBakbJFQgkXPMjC88=</guid>
      <description>org-mode links meet hydra</description>
      <content:encoded><![CDATA[


<p>
I have played with a lot of options to give org-mode links extra functionality. Here are a few of the ideas I have looked at so far.
</p>

<ol class="org-ol">
<li><a href="http://kitchingroup.cheme.cmu.edu/blog/2013/10/21/Enabling-right-clicks-in-org-mode-links/">Enabling right clicks on links</a> 
</li>
<li>A home made minibuffer menu in org-ref
</li>
<li>A helm buffer in org-ref
</li>
</ol>

<p>
Here, I want to explore a hydra menu for a link. The idea is pretty simple, we need functions that do something with the link at point, and a hydra interface to call them. This turned out to be a little tricky. I could not get the path from the link in the link lambda function, and we need a way to pass the path to the function. I use a global variable for that. I wish there was another way to do that, but this does actually work. We illustrate it here with a more functional doi link.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">doi-crossref</span> ()
  <span style="color: #036A07;">"Search DOI in CrossRef."</span>
  (interactive)
  (browse-url
   (format
    <span style="color: #008000;">"http://search.crossref.org/?q=%s"</span> *doi-hydra-path*)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">doi-google-scholar</span> ()
  <span style="color: #036A07;">"Google scholar the doi."</span>
  (interactive)
  (browse-url
   (format
    <span style="color: #008000;">"http://scholar.google.com/scholar?q=%s"</span> *doi-hydra-path*)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">doi-pubmed</span> ()
  <span style="color: #036A07;">"Pubmed the doi."</span>
  (interactive)
  (browse-url
   (format
    <span style="color: #008000;">"http://www.ncbi.nlm.nih.gov/pubmed/?term=%s"</span>
    (url-hexify-string *doi-hydra-path*))))

 (defhydra doi-hydra ()
   <span style="color: #008000;">"org-ref"</span>
   (<span style="color: #008000;">"c"</span> doi-crossref <span style="color: #008000;">"Crossref"</span>)
   (<span style="color: #008000;">"g"</span> doi-google-scholar <span style="color: #008000;">"Google Scholar"</span>)
   (<span style="color: #008000;">"p"</span> doi-pubmed <span style="color: #008000;">"Pubmed"</span>))

(org-add-link-type <span style="color: #008000;">"doi"</span>
  (<span style="color: #0000FF;">lambda</span> (path) (setq *doi-hydra-path* path) (doi-hydra/body)))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">lambda</td>
<td class="left">(path)</td>
<td class="left">(setq <b>doi-hydra-path</b> path)</td>
<td class="left">(doi-hydra/body)</td>
</tr>
</tbody>
</table>

<p>
Now for a test, <a href="10.1021/jp047349j">10.1021/jp047349j</a>.
</p>

<p>
It works fine, when you click on a link, you get a minibuffer menu with context hints, and pressing any other key than is defined simply cancels the command.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/22/org-mode-links-meet-hydra.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>org-ref meets hydra</title>
      <link>http://jkitchin.github.io/blog/2015/02/20/org-ref-meets-hydra</link>
      <pubDate>Fri, 20 Feb 2015 21:17:20 EST</pubDate>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">qjfPB2nhToDr-tiuGWfHxETUYh8=</guid>
      <description>org-ref meets hydra</description>
      <content:encoded><![CDATA[


<p>
I am enjoying learning about <a href="https://github.com/abo-abo/hydra">abo-abo/hydra</a> , which is a nice package for making minibuffer menus to run commands. It is light-weight solution that does not mess up your window too much, and it is easier to use than any home-grown solution I have made in the past. Here is a simple little code that gives me three options when I press "zz" quickly (a key-chord). I can press "c" to put in a cite link using helm, "r" to insert a ref link using helm, and "l" to insert a new label. Any other key just cancels the menu. One thing to remember ("zz"), and hints for the rest!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">hydra</span>)
(setq hydra-is-helpful t)

(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">key-chord</span>)
(key-chord-mode 1)
(key-chord-define-global
 <span style="color: #008000;">"zz"</span>
 (defhydra org-ref-hydra ()
   <span style="color: #008000;">"org-ref"</span>
   (<span style="color: #008000;">"c"</span> org-ref-helm-insert-cite-link <span style="color: #008000;">"cite"</span>)
   (<span style="color: #008000;">"r"</span> org-ref-helm-insert-ref-link <span style="color: #008000;">"ref"</span>)
   (<span style="color: #008000;">"l"</span> org-ref-helm-insert-label-link <span style="color: #008000;">"label"</span>)
   (<span style="color: #008000;">"R"</span> org-ref <span style="color: #008000;">"org-ref"</span>)))
</pre>
</div>

<pre class="example">
org-ref-hydra/body
</pre>

<p>
Pretty nice. Check out the nice hydra interface to <a href="https://github.com/jkitchin/jmax/blob/master/words.el">words.el</a> . A simple press of "ww" gets you easy access to single key presses of all the nice words functions. What would you hydra for?</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/20/org-ref-meets-hydra.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Extending the org-mode link syntax with attributes</title>
      <link>http://jkitchin.github.io/blog/2015/02/05/Extending-the-org-mode-link-syntax-with-attributes</link>
      <pubDate>Thu, 05 Feb 2015 10:06:25 EST</pubDate>
      <category><![CDATA[orgmode]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">lkBnYhulyhLMZBLWqqgRvAxph3o=</guid>
      <description>Extending the org-mode link syntax with attributes</description>
      <content:encoded><![CDATA[


<p>
I make super heavy use of links in org-mode. I use them extensively in org-ref to create functional citations. One detail that has never been very satisfactory is the need for pre/post text in citations. I don't need that capability often, but it seems important to some. I have implemented a kind of clunky solution where I use the description part of a link with the pre/post text separated by a ::. Although that works, I dislike the way it looks, the need to parse it, and that the description covers the link.
</p>

<pre class="example">
[[cite:key][pre text::post text]]
</pre>

<p>
Some <a href="https://lists.gnu.org/archive/html/emacs-orgmode/2010-08/msg00404.html">time ago</a> there was a suggestion of how to extend the link syntax, which was to my knowledge never implemented. Here is the proposed syntax:
</p>
<pre class="example">
$[link http://google.com
         :last-followed [2009-02-25 Wed 02:00]
         :label "click here for evil search engine"
         :export-label "click here for nice search engine"]
</pre>

<p>
This is interesting because this syntax suggests the link has attributes which can be updated.
</p>

<p>
We will show here how to implement part of this idea with the existing link syntax. We will make a link that has attributes like that. The basic idea is to simply incorporate the attributes into the path, and use lisp to read them. We will wrap the link path in parentheses and read that as a lisp data structure. So, a link like <i>link:key :pre "some pre text" :post "some post text"</i> will be parsed as:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(read <span style="color: #008000;">"(key :pre \"some pre text\" :post \"some post text\")"</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">key</td>
<td class="left">:pre</td>
<td class="left">some pre text</td>
<td class="left">:post</td>
<td class="left">some post text</td>
</tr>
</tbody>
</table>

<p>
The car of that list is the key, and the cdr contains the attributes. The quotes are necessary here to make sure all the text is correctly parsed as a single element for each attribute. So, here is an example link
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-add-link-type
 <span style="color: #008000;">"slink"</span>
 <span style="color: #8D8D84;">;;  </span><span style="color: #8D8D84; font-style: italic;">follow function</span>
 (<span style="color: #0000FF;">lambda</span> (path)
   (<span style="color: #0000FF;">let*</span> ((data (read (format <span style="color: #008000;">"(%s)"</span> path)))
          (head (car data))
          (plist (cdr data))
          (link (org-element-context))
          (begin (org-element-property <span style="color: #006FE0;">:begin</span> link))
          (end (org-element-property <span style="color: #006FE0;">:end</span> link)))
     (setq plist (plist-put plist <span style="color: #006FE0;">:last-clicked</span> (current-time-string)))
     (<span style="color: #0000FF;">save-excursion</span>
     (setf (buffer-substring begin end) <span style="color: #008000;">""</span>)
     (goto-char begin)
     (insert (format <span style="color: #008000;">"[[slink:%s %s]]"</span> head
         (substring (format <span style="color: #008000;">"%S"</span> plist) 1 -1))))))
 <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">format function</span>
 (<span style="color: #0000FF;">lambda</span> (path description backend)
   (<span style="color: #0000FF;">let*</span> ((data (read (concat <span style="color: #008000;">"("</span> path <span style="color: #008000;">")"</span>)))
          (head (car data))
          (plist (cadr data)))
     (format <span style="color: #008000;">"\\%s[%s][%s]{%s}"</span>
             (plist-get plist <span style="color: #006FE0;">:type</span>)
             (plist-get plist <span style="color: #006FE0;">:pre</span>)
             (plist-get plist <span style="color: #006FE0;">:post</span>)
             head))))
</pre>
</div>

<p>
Now, each time I click on this link, the time stamp gets updated.
</p>

<p>
\nil[nil][nil]{kitchin-2010}
</p>

<pre class="example">
[[slink:kitchin-2010 :pre "See for example" :post "page 47" :type "cite" :last-clicked "Thu Feb  5 09:31:15 2015"]]
</pre>


<p>
And, the generic export of this link is:
</p>

<pre class="example">
\cite[See for example][page 47]{kitchin-2010}
</pre>

<p>
Is this a good idea? I am not using this for anything right now. Sometimes my version of org-mode has trouble recognizing that is a link. It is strange, as I am typing, sometimes it flashes in and out of being recognized as a link. Anyway, it is an interesting idea!</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/05/Extending-the-org-mode-link-syntax-with-attributes.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Helm at the Emacs</title>
      <link>http://jkitchin.github.io/blog/2015/02/04/Helm-at-the-Emacs</link>
      <pubDate>Wed, 04 Feb 2015 08:47:40 EST</pubDate>
      <category><![CDATA[helm]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">BQa4exu2NqS2LIJDkrMHfiML8kw=</guid>
      <description>Helm at the Emacs</description>
      <content:encoded><![CDATA[


<p>
I have written several (<a href="http://kitchingroup.cheme.cmu.edu/blog/2015/01/24/Anatomy-of-a-helm-source/">intro</a> , <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/02/01/Handling-multiple-selections-in-helm/">multiple args</a> , <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/02/03/helm-and-prefix-functions/">prefix args)</a> times about using Helm in Emacs so far. Today, I want to share a way I use helm to get me where I want to be in Emacs for my daily activities. This came out of a desire to have single command that would give me a lot of options to open exactly the buffer/file I wanted when I need it. I call the command hotspots, and it is bound to f9 for me, so when I press f9 I get a helm buffer to select what I want from.
</p>

<p>
So, what kinds of things do I want. First, I want to be able to open my mail, calendar, News feed or agenda from this command. Second, I have a list of hotspots I developed using the code at <a href="http://ergoemacs.org/emacs/emacs_hotkey_open_file_fast.html">http://ergoemacs.org/emacs/emacs_hotkey_open_file_fast.html</a> , which I want easy access to. Third, I want to be able to open any org-file in my agenda list. Fourth, any bookmark I have, or to set a bookmark. Fifth, I want recent files as candidates. There is certainly some redundancy in their, but that is ok, it gets me where I want to be.
</p>

<p>
Here is the code that does that for me. There are six helm sources that provide candidates and actions.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">hotspots</span> ()
  <span style="color: #036A07;">"helm interface to my hotspots, which includes my locations,</span>
<span style="color: #036A07;">org-files and bookmarks"</span>
  (interactive)
  (helm <span style="color: #006FE0;">:sources</span> `(((name . <span style="color: #008000;">"Mail and News"</span>)
                    (candidates . ((<span style="color: #008000;">"Mail"</span> . (<span style="color: #0000FF;">lambda</span> ()
                                               (<span style="color: #0000FF;">if</span> (get-buffer <span style="color: #008000;">"*mu4e-headers*"</span>)
                                                   (<span style="color: #0000FF;">progn</span>
                                                     (switch-to-buffer <span style="color: #008000;">"*mu4e-headers*"</span>)
                                                     (delete-other-windows))

                                                 (mu4e))))
                                   (<span style="color: #008000;">"Calendar"</span> . (<span style="color: #0000FF;">lambda</span> ()  (browse-url <span style="color: #008000;">"https://www.google.com/calendar/render"</span>)))
                                   (<span style="color: #008000;">"RSS"</span> . elfeed)
                                   (<span style="color: #008000;">"Agenda"</span> . (<span style="color: #0000FF;">lambda</span> () (org-agenda <span style="color: #008000;">""</span> <span style="color: #008000;">"w"</span>)))))
                    (action . ((<span style="color: #008000;">"Open"</span> . (<span style="color: #0000FF;">lambda</span> (x) (funcall x))))))
                   ((name . <span style="color: #008000;">"My Locations"</span>)
                    (candidates . ((<span style="color: #008000;">"master"</span> . <span style="color: #008000;">"~/Dropbox/org-mode/master.org"</span>)
                                   (<span style="color: #008000;">".emacs.d"</span> . <span style="color: #008000;">"~/Dropbox/kitchingroup/jmax"</span> )
                                   (<span style="color: #008000;">"blog"</span> . <span style="color: #008000;">"~/blogofile-jkitchin.github.com/_blog/blog.org"</span>)
                                   (<span style="color: #008000;">"ese"</span> . <span style="color: #008000;">"~/Dropbox/books/ese-book/ese.org"</span> )
                                   (<span style="color: #008000;">"passwords"</span> . <span style="color: #008000;">"~/Dropbox/org-mode/passwords.org.gpg"</span>)
                                   (<span style="color: #008000;">"Pycse"</span> . <span style="color: #008000;">"~/Dropbox/books/pycse/pycse.org"</span>)
                                   (<span style="color: #008000;">"references"</span> . <span style="color: #008000;">"~/Dropbox/bibliography/references.bib"</span>)
                                   (<span style="color: #008000;">"notes"</span> . <span style="color: #008000;">"~/Dropbox/bibliography/notes.org"</span>)
                                   (<span style="color: #008000;">"journal"</span> . <span style="color: #008000;">"~/Dropbox/org-mode/journal.org"</span>)
                                   (<span style="color: #008000;">"tasks"</span> . <span style="color: #008000;">"~/Dropbox/org-mode/tasks.org"</span>)))
                    (action . ((<span style="color: #008000;">"Open"</span> . (<span style="color: #0000FF;">lambda</span> (x) (find-file x))))))

                   ((name . <span style="color: #008000;">"My org files"</span>)
                    (candidates . ,(f-entries <span style="color: #008000;">"~/Dropbox/org-mode"</span>))
                    (action . ((<span style="color: #008000;">"Open"</span> . (<span style="color: #0000FF;">lambda</span> (x) (find-file x))))))
                   helm-source-recentf
                   helm-source-bookmarks
                   helm-source-bookmark-set)))
</pre>
</div>

<p>
Interesting to me is that there are not a lot of actions in here. I mostly use this command for navigation to various places. For example, I press f9, type meet, and I can quickly get to the meetings file in my agenda list, or I can type the first few letters of a student's name and open the org-file associated with them. Or I press f9 and go down an entry to open my calendar, etc&#x2026; I find this enormously helpful because it opens these files no matter where I am in Emacs, and it relieves my mind from remembering where they are, or the keystrokes/commands to get to them.</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/04/Helm-at-the-Emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>helm and prefix functions</title>
      <link>http://jkitchin.github.io/blog/2015/02/03/helm-and-prefix-functions</link>
      <pubDate>Tue, 03 Feb 2015 11:12:53 EST</pubDate>
      <category><![CDATA[helm]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">8N-R8vMLReQ31rBXzaetXNyodro=</guid>
      <description>helm and prefix functions</description>
      <content:encoded><![CDATA[


<p>
Helm modifies how you use <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Prefix-Command-Arguments.html">prefix arguments</a> in Emacs. A prefix argument is when you type C-u before a command to modify its behavior. There are a few variations of prefix arguments. Basically, pressing C-u once sets a prefix variable to '(4), pressing twice sets it to '(16). Alternatively, C-u 7 sets the prefix to 7. In regular emacs commands, you type the prefix keys before the command. In helm, you type the after you enter the helm selection buffer, and before you press enter or select your action. In helm, you access the prefix arg in the variable helm-current-prefix-arg. Let us look at how you might use it.
</p>

<p>
We make an action function that does something conditionally depending on the prefix arg. Yes, you could write several functions to accomplish that too, but maybe there is just a little difference that you can use the prefix arg to handle. What you cannot remember 4 prefix options? You do write good doc strings on your functions right ;) If not, you probably ought to write four functions with meaningful names, and meaningful helm descriptions!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">action</span> (candidate)
  <span style="color: #036A07;">"Our action function.</span>
<span style="color: #036A07;">with no prefix message no prefix arg</span>
<span style="color: #036A07;">with one prefix arg message C-u</span>
<span style="color: #036A07;">with two prefix args message C-u C-u</span>
<span style="color: #036A07;">with a numeric prefix arg, message the number."</span>
  (interactive <span style="color: #008000;">"p"</span>)
  (<span style="color: #0000FF;">cond</span>
   ((eq nil helm-current-prefix-arg)
    (message-box <span style="color: #008000;">"no prefix arg"</span>))
   ((equal helm-current-prefix-arg '(4))
    (message-box <span style="color: #008000;">"C-u"</span>))
   ((equal helm-current-prefix-arg '(16))
    (message-box <span style="color: #008000;">"C-u C-u"</span>))
   (t
    (message-box (format <span style="color: #008000;">"C-u %s"</span> helm-current-prefix-arg)))))

(setq some-helm-source
      '((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . (1 2 3 4))
        (action . action)))

(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>

<pre class="example">
C-u (64)
</pre>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/03/helm-and-prefix-functions.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Handling multiple selections in helm</title>
      <link>http://jkitchin.github.io/blog/2015/02/01/Handling-multiple-selections-in-helm</link>
      <pubDate>Sun, 01 Feb 2015 08:51:26 EST</pubDate>
      <category><![CDATA[helm]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">N5qxsrIWtmCMMl_qTvm4aKnq_-Y=</guid>
      <description>Handling multiple selections in helm</description>
      <content:encoded><![CDATA[


<p>
The basic usage pattern of helm is you run a command which opens a buffer of choices. You enter some text in the minibuffer which eliminates choices that do not match what you type in. You can select multiple choices by using C-spc, or M-a to mark them all. When you press enter, the current selection is sent to the default action defined. The action is a function that does something, usually on the selected item(s). Here, we explore writing the action function to do what we want. The reason this is somewhat tricky is that when you mark an item in helm, the "cursor" moves to the next item, which means when you press enter it may be possible that the current highlighted item is not part of the items you have marked. If your action will perform a delete action, for example, you may have wanted to delete the marked items, and <i>not</i> the current selection! So, what we need is a way to get what we want.
</p>

<p>
An action function in helm should normally take one argument, which is going to be the currently selected item from helm. However, we can use two different functions to access either the selected item (helm-get-selection) or the marked items (helm-marked-candidates). So, we can write our function to do "do what we mean". Note, even if you do not mark any candidates,  (helm-marked-candidates) will return a list that has the current selection in it. So we can write our action function to act on this list so it works on what is marked or what is selected if nothing is marked. That is probably "what we mean".
</p>

<p>
Here is one way to work on a selection or marked list of selections. We define an action function that takes an arg, but inside we operate on each element of the marked candidates.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">some-action</span> (candidate)
  (loop for cand in (helm-marked-candidates)
        do
        (message-box <span style="color: #008000;">"working on %s"</span> cand)))

(helm <span style="color: #006FE0;">:sources</span> '(((name . <span style="color: #008000;">"HELM"</span>)
                  (candidates . (1 2 3 4))
                  (action . ((<span style="color: #008000;">"open"</span> . some-action))))))
</pre>
</div>


<p>
Here is an alternative approach. Here we define the action function to work on one candidate. That might be helpful for testing, for example. Then, we use mapc to apply the function to each marked candidate.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">some-action</span> (candidate)
  (message-box <span style="color: #008000;">"single working on %s"</span> candidate))

(helm <span style="color: #006FE0;">:sources</span> '(((name . <span style="color: #008000;">"HELM"</span>)
                  (candidates . (1 2 3 4))
                  (action . ((<span style="color: #008000;">"open"</span> . (<span style="color: #0000FF;">lambda</span> (candidate)
                                         (mapc
                                          'some-action
                                          (helm-marked-candidates)))))))))
</pre>
</div>

<p>
A little more verbose method might be like this. Here we just pull out the lambda function to another function, to make the helm source definition a little shorter. I cannot tell if this is easier to follow, it is just another option.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">some-action</span> (candidate)
  (message-box <span style="color: #008000;">"single2 working on %s"</span> candidate))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">some-actions</span> (candidate)
  (mapc 'some-action (helm-marked-candidates)))

(helm <span style="color: #006FE0;">:sources</span> '(((name . <span style="color: #008000;">"HELM"</span>)
                  (candidates . (1 2 3 4))
                  (action . some-actions))))
</pre>
</div>


<p>
So there you have it. You can select multiple things in helm, and then operate on them with your action function!
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/02/01/Handling-multiple-selections-in-helm.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>More adventures in helm - more than one action</title>
      <link>http://jkitchin.github.io/blog/2015/01/30/More-adventures-in-helm-more-than-one-action</link>
      <pubDate>Fri, 30 Jan 2015 08:00:16 EST</pubDate>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">_HTg08cujf5IREAJYfTp1bU5n2M=</guid>
      <description>More adventures in helm - more than one action</description>
      <content:encoded><![CDATA[


<p>
We continue our <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/01/24/Anatomy-of-a-helm-source/">exploration of helm</a> and now consider how to have more than one action for a selection. When you press enter, helm runs the default action defined, but you can define more than one action, and choose which one to run. How do you know if there are multiple actions? Press C-z in helm and you will get a new helm buffer showing the actions. The first action is the default, and you can select the the actions with function keys, e.g. f1 is the first action, f2 is the second action, or you can select the action and press enter.
</p>

<p>
The main difference in setting up multiple actions is that instead of a single function for action in the source definition, we provide a list of cons cells for the action element of the helm source. Each action cons cell should have a descriptive string as the car that identifies the action. This will be shown in the helm buffer. The cdr should be the function to run on the candidate. The function will be called with the selection, so the function must take one argument.
</p>

<p>
Here is an example where we have two actions. The default action will just show us the email address of the selected candidates in a message box. It will show as a list. The second action opens an email window and inserts the selected candidates in the To: field as a comma separated list. I use helm-selected-candidates in these functions instead of the just the current selected candidate so we can have multiple selections. I define the first function as a lambda function, and the second one as a defun to illustrate how to use both approaches. You can have as many actions as you want, so you could consider functions that open notes about the person, or open your contacts to look up a phone number, or functions with template emails you send often, etc&#x2026;
</p>

<p>
Now, you have these options to run those actions.
</p>

<ol class="org-ol">
<li>Make a selection and press enter. That runs the first (and default) action to show you a message box.
</li>
<li>Make a selection and press C-z to see what actions are available. Select the action you want, and press enter.
</li>
<li>Make a selection and press F1 to run the default action, or F2 to run the second action.
</li>
</ol>

<p>
Here is our code.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq data '((<span style="color: #008000;">"John"</span> . <span style="color: #008000;">"john@email.com"</span>)
             (<span style="color: #008000;">"Jim"</span> . <span style="color: #008000;">"jim@email.com"</span>)
             (<span style="color: #008000;">"Jane"</span> . <span style="color: #008000;">"jane@email.com"</span>)
             (<span style="color: #008000;">"Jill"</span> . <span style="color: #008000;">"jill@email.com"</span>)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">open-email</span> (candidates)
  <span style="color: #036A07;">"Compose an email to the candidates. Fill in the addresses and</span>
<span style="color: #036A07;">move point to the subject."</span>
  (compose-mail)
  (message-goto-to)
  (insert
   (mapconcat
    'identity
    (helm-marked-candidates)
    <span style="color: #008000;">","</span>))
  (message-goto-subject))

(setq some-helm-source
      `((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . ,data)
        (action . ((<span style="color: #008000;">"show email address"</span> . (<span style="color: #0000FF;">lambda</span> (candidate)
                                             (message-box
                                              <span style="color: #008000;">"selected: %s"</span>
                                              (helm-marked-candidates))))
                   (<span style="color: #008000;">"send email"</span> . open-email)))))

(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>

<pre class="example">
t
</pre>

<p>
Now, you can define multiple actions for your selection in helm!
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/01/30/More-adventures-in-helm---more-than-one-action.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>Anatomy of a helm source</title>
      <link>http://jkitchin.github.io/blog/2015/01/24/Anatomy-of-a-helm-source</link>
      <pubDate>Sat, 24 Jan 2015 11:15:56 EST</pubDate>
      <category><![CDATA[helm]]></category>
      <category><![CDATA[emacs]]></category>
      <guid isPermaLink="false">sKB9b8y5sNX60wQGXo0OvhrEk0c=</guid>
      <description>Anatomy of a helm source</description>
      <content:encoded><![CDATA[



<p>
I have been integrating <a href="https://github.com/emacs-helm/helm">helm</a> into my emacs work flows almost anywhere I need to make interactive selections and do something with them. In this post, I will go through the simplest helm examples I can think of that get you to writing your own example.
</p>

<p>
To run a helm selection process you basically just call a function that calls this minimal function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>

<p>
In that code, the symbol some-helm-source will provide the input for the helm buffer. Let us look at the simplest example here. Each source should have a name, a list of candidates, and an action that works on the selected candidate. We construct a source as a list of cons cells. Here, we make a source with the name "HELM at the Emacs", a static list of candidates, which are simply a list of numbers, and a single action that will operate on the selected candidate.
</p>

<p>
If you run this block, you will get a helm buffer, you can select an entry, press enter, and you should see a message box pop up telling you what entry you selected. I like to separate the source definition from the helm call like this, but only for readability.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq some-helm-source
      '((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . (1 2 3 4))
        (action . (<span style="color: #0000FF;">lambda</span> (candidate)
                    (message-box <span style="color: #008000;">"%s"</span> candidate)))))

(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>

<pre class="example">
3
</pre>


<p>
Not bad, but what if we want some dynamic candidates? The usual way we will do that is to define a function that calculates the candidates for us. Let us work out an example that just shows us random numbers between 0 and 10 to select from. In a real example, you would use this function to generate a list of candidates like bibtex keys, email-addresses, etc&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">random-candidates</span> ()
  <span style="color: #036A07;">"Return a list of 4 random numbers from 0 to 10"</span>
  (loop for i below 4 collect (random 10)))

(setq some-helm-source
      '((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . random-candidates)
        (action . (<span style="color: #0000FF;">lambda</span> (candidate)
                    (message <span style="color: #008000;">"%s"</span> candidate)))))

(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>


<p>
So far, we have looked at the simplest list of candidates: a simple list. It may be that this is not the most convenient way to see the candidates. We might like to have one set of candidates that we use for searching, but another set of equivalent candidates used for the action. For example, we might want a list of names for selecting, but then have the action work on the corresponding email address. Let us consider a case where we have a list of cons cells of names and email addresses.
</p>

<p>
We use the `, way to create the source variable to make sure our list of candidates is constructed. Then, in our function we take the selection and get the corresponding entry in the data a-list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq data '((<span style="color: #008000;">"John"</span> . <span style="color: #008000;">"john@email.com"</span>)
             (<span style="color: #008000;">"Jim"</span> . <span style="color: #008000;">"jim@email.com"</span>)
             (<span style="color: #008000;">"Jane"</span> . <span style="color: #008000;">"jane@email.com"</span>)
             (<span style="color: #008000;">"Jill"</span> . <span style="color: #008000;">"jill@email.com"</span>)))

(setq some-helm-source
      `((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . ,(mapcar 'car data))
        (action . (<span style="color: #0000FF;">lambda</span> (candidate)
                    (message <span style="color: #008000;">"%s"</span> (cdr (assoc candidate data)))))))

(helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
</pre>
</div>

<pre class="example">
jim@email.com
</pre>

<p>
That is not too bad, and might be a general way to get to the data you want. But, helm can integrate this directly by using the a-list <i>directly</i> as the list of candidates. Helm will show you the car of each cell, but return the cdr of the selected entry.
</p>

<p>
Let us try this to make a function that will give us a helm buffer to select some names from, and then insert a comma separated list of emails from our selection at the point. We make our action function just return the list of marked candidates. Then we create a function that calls helm, and inserts a concatenated string.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq data '((<span style="color: #008000;">"John"</span> . <span style="color: #008000;">"john@email.com"</span>)
             (<span style="color: #008000;">"Jim"</span> . <span style="color: #008000;">"jim@email.com"</span>)
             (<span style="color: #008000;">"Jane"</span> . <span style="color: #008000;">"jane@email.com"</span>)
             (<span style="color: #008000;">"Jill"</span> . <span style="color: #008000;">"jill@email.com"</span>)))

(setq some-helm-source
      `((name . <span style="color: #008000;">"HELM at the Emacs"</span>)
        (candidates . ,data)
        (action . (<span style="color: #0000FF;">lambda</span> (candidate)
                    (helm-marked-candidates)))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">helm-select-and-insert-emails</span> ()
  (interactive)
  (insert
   (mapconcat 'identity
              (helm <span style="color: #006FE0;">:sources</span> '(some-helm-source))
              <span style="color: #008000;">","</span>)))
</pre>
</div>
<pre class="example">
helm-select-and-insert-emails
</pre>


<p>
Here is what I get when I run the command, select John and Jill, and press enter: john@email.com,jill@email.com
</p>

<p>
That is it for this post. We looked at:
</p>

<ol class="org-ol">
<li>the simplest kind of helm interface with a fixed set of candidates
</li>
<li>A simple dynamic set of candidates
</li>
<li>A simple fixed set of candidates from a list of cons cells.
</li>
</ol>

<p>
This barely scratches the surface of helm, but is already enough to do some useful things.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/01/24/Anatomy-of-a-helm-source.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
    <item>
      <title>A prototype implementation of jasp in emacs-lisp</title>
      <link>http://jkitchin.github.io/blog/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp</link>
      <pubDate>Wed, 24 Dec 2014 11:41:00 EST</pubDate>
      <category><![CDATA[lisp]]></category>
      <category><![CDATA[vasp]]></category>
      <category><![CDATA[emacs]]></category>
      <category><![CDATA[ase]]></category>
      <guid isPermaLink="false">GB14oL8NufR3GRSfetF6V-_v3KU=</guid>
      <description>A prototype implementation of jasp in emacs-lisp</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. The Atom class</a></li>
<li><a href="#sec-2">2. The Atoms class</a></li>
<li><a href="#sec-3">3. The Calculator class</a></li>
<li><a href="#sec-4">4. Putting it all together to run calculations</a></li>
<li><a href="#sec-5">5. Summary thoughts</a></li>
</ul>
</div>
</div>

<p>
I want to try implementing an interface to <a href="http://www.vasp.at">VASP</a> in emacs-lisp. VASP is a program that uses density functional theory to calculate properties of materials. VASP was designed for the user to create several text-based input files that contain an atomic geometry, and calculation parameters. Then you run the VASP program, which reads those input files and generates output files. Finally, you parse out the results you want from the output files. 
</p>

<p>
It is moderately tedious to do that, so we already have a very extensive Python interface (<a href="http://github.com/jkitchin/jasp">http://github.com/jkitchin/jasp</a> ) that automates the input file creation and output file parsing, and with org-mode we have a pretty good literate research environment to document what we do. But, the Python/emacs environment is not as integrated as the emacs-lisp/emacs environment is, particularly when it comes to accessing documentation. So, I want to try out a lisp approach to see what this would look like, and if it has any benefits.
</p>

<p>
The bare bones implementation will have an Atom object, to store the type of atom and its coordinates, an Atoms object which will be a collection of atoms, and a unit cell, and a Calculator object that will store calculation parameters.
</p>

<p>
Then, we will try using it to see what advantages it might have. This will be a moderately long post.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> The Atom class</h2>
<div class="outline-text-2" id="text-1">
<p>
This is my first serious effort to use the <a href="https://www.gnu.org/software/emacs/manual/html_node/eieio/">object system</a> in emacs-lisp, so I do not claim it is optimal, or beautiful. It is functional though. We make a simple Atom class that holds the chemical symbol, and xyz coordinates. We do not consider having a magnetic moment at this point, and this class has no methods.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Atom</span> ()
  ((symbol <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:symbol</span>
           <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A string for the chemical symbol"</span>)
   (x <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:x</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The x coordinate"</span>)
   (y <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:y</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The y coordinate"</span>)
   (z <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:z</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The z coordinate"</span>))
 <span style="color: #228b22;">"A class to represent an atom."</span>)

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">Atom</span>)
</pre>
</div>

<pre class="example">
Atom
</pre>

<p>
Let us try it out. We make an Atom, then get the symbol using the oref function. I don't think we need a "Name" for the atom, so the second argument is nil.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
</pre>
</div>

<pre class="example">
[object Atom nil "C" 0 0 0]
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((a1 (Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0  <span style="color: #cd0000;">:z</span> 0)))
  (oref a1 symbol))
</pre>
</div>

<pre class="example">
C
</pre>

<p>
It is not difficult to modify an Atom object. We use oset.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((a1 (Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0  <span style="color: #cd0000;">:z</span> 0)))
  (oset a1 x 2.5)
  a1)
</pre>
</div>

<pre class="example">
[object Atom nil "C" 2.5 0 0]
</pre>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The Atoms class</h2>
<div class="outline-text-2" id="text-2">
<p>
We need at Atoms object, which will store a list of Atom objects, and a unit cell. I do not know how to make this class act like a list the way that the Atoms object in ase acts. We will have to access the list of atoms as a slot. We define one method here to get the ith atom from the object.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Atoms</span> ()
  ((atoms <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:atoms</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A list of `</span><span style="color: #cd0000;">Atom</span><span style="color: #228b22;">' objects"</span>)
   (cell <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:cell</span>
         <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A 3-tuple of lengths of an orthorhombic unit cell"</span>))
  <span style="color: #228b22;">"A class to represent an atoms object."</span>)


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">get-atom</span> ((atoms Atoms) <span style="color: #4682b4;">&amp;rest</span> args)
  <span style="color: #228b22;">"Get a list of atoms in ARGS.</span>
<span style="color: #228b22;">Return atom if ARGS contains one element, a list of atom objects</span>
<span style="color: #228b22;">otherwise."</span>
  (<span style="color: #8b0000;">cond</span>
   ((= 1 (length args))
    (elt (oref atoms atoms) (car args)))
   (t
    (mapcar (<span style="color: #8b0000;">lambda</span> (i)
              (elt (oref atoms atoms) i))
            args))))

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">Atoms</span>)
</pre>
</div>

<pre class="example">
get-atom
</pre>

<p>
That seems to do what we need. It has some limitations:
</p>
<ol class="org-ol">
<li>We only allowed for orthorhombic unit cells
</li>
<li>We did not enable any constraints or magnetic moments on the atoms.
</li>
</ol>

<p>
Here is an example Atoms object. Note we use `, notation to ensure each Atom is created, since Atom is a constructor function that returns the object.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(Atoms nil
       <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
       <span style="color: #cd0000;">:cell</span> '(8 9 10))
</pre>
</div>

<pre class="example">
[object Atoms nil ([object Atom nil "C" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]
</pre>

<p>
We can drill into the object, e.g. to get the second atom:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((A1 (Atoms nil
                 <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                          ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                 <span style="color: #cd0000;">:cell</span> '(8 9 10))))
  (get-atom A1 1))
</pre>
</div>

<pre class="example">
[object Atom nil "O" 1.1 0 0]
</pre>

<p>
We can modify the atoms in place like this. Suppose we want to change the symbol of the first atom to "O". We use setf for this too.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((A1 (Atoms nil
                 <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                          ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                 <span style="color: #cd0000;">:cell</span> '(8 9 10))))
  (oset (get-atom A1 0) symbol <span style="color: #228b22;">"O"</span>)
  A1)
</pre>
</div>

<pre class="example">
[object Atoms nil ([object Atom nil "O" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]
</pre>

<p>
The only think I do not like about this syntax is the need to get the list of atoms from the object. That is a little clunkier than the Python analog where the object is a list itself. That may be just my inexperience with emacs-lisp. Probably you can define some getter function to smooth this over.
</p>

<p>
This Atoms class lacks much of the functionality of the <a href="https://wiki.fysik.dtu.dk/ase/ase/atoms.html">ase.Atoms</a> class, but it is sufficient for this prototype.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> The Calculator class</h2>
<div class="outline-text-2" id="text-3">
<p>
Next, we need our Calculator. This will store the parameters, and be responsible for creating the INCAR, POSCAR, KPOINTS, and POTCAR files, running a calculation, and getting data from the output. We also create a with-current-directory macro that will temporarily change the working directory since VASP uses the same filenames over and over, but in different directories. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defmacro</span> <span style="color: #8b2323;">with-current-directory</span> (directory <span style="color: #4682b4;">&amp;rest</span> body)
  <span style="color: #228b22;">"Set the working directory temporarily set to DIRECTORY and run BODY.</span>
<span style="color: #228b22;">DIRECTORY is expanded, and create it and its parents if needed."</span>
  `(<span style="color: #8b0000;">progn</span>
     (<span style="color: #8b0000;">unless</span> (file-exists-p (file-name-as-directory
                             (expand-file-name ,directory)))
       (make-directory ,directory t))
     
     (<span style="color: #8b0000;">let</span> ((default-directory (file-name-as-directory
                                (expand-file-name ,directory)))) 
        ,@body)))


(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Jasp</span> ()
  ((wd <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:wd</span>
       <span style="color: #cd0000;">:initform</span> <span style="color: #228b22;">"."</span>  ; <span style="color: #ff0000; font-weight: bold;">default to the current working directory</span>
       <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Directory to run calculation in."</span>)
   (encut <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:encut</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Positive number in eV for planewave cutoff.</span>
<span style="color: #228b22;">See URL `</span><span style="color: #cd0000;">http://cms.mpi.univie.ac.at/vasp/vasp/ENCUT_tag.html</span><span style="color: #228b22;">'."</span>)
   (nbands <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:nbands</span>
           <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Integer number of bands.</span>
<span style="color: #228b22;">See URL `</span><span style="color: #cd0000;">http://cms.mpi.univie.ac.at/vasp/vasp/NBANDS_tag.html</span><span style="color: #228b22;">'."</span>)
   (kpts <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:kpts</span>
         <span style="color: #cd0000;">:initform</span> (1 1 1)  ; <span style="color: #ff0000; font-weight: bold;">default value</span>
         <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"3-tuple for Monkhorst-Pack K-point grid."</span>)
   (xc <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:xc</span>
       <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"String of exchange correlation functional."</span>)
   (atoms <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:atoms</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"An `</span><span style="color: #cd0000;">Atoms</span><span style="color: #228b22;">' object."</span>))
 <span style="color: #228b22;">"A class to represent a calculator that runs VASP."</span>)


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">view-atoms</span> ((calc Jasp))
  <span style="color: #228b22;">"Open the ase-gui"</span>
  (<span style="color: #8b0000;">unless</span> (and (file-exists-p <span style="color: #228b22;">"POSCAR"</span>)
               (file-exists-p <span style="color: #228b22;">"POTCAR"</span>))
    (write-poscar calc)
    (write-potcar calc))
  (shell-command <span style="color: #228b22;">"ase-gui POSCAR"</span>))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-poscar</span> ((calc Jasp))
  <span style="color: #228b22;">"create a POSCAR file for CALC."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"POSCAR"</span>
    (insert <span style="color: #228b22;">"Created by jasp.el\n"</span>)
    (insert <span style="color: #228b22;">"  1.0"</span>) ; <span style="color: #ff0000; font-weight: bold;">unit cell scale factor</span>
    (<span style="color: #8b0000;">let*</span> ((atoms (oref calc atoms))
           (cell (oref atoms cell)))
      (loop for v in cell
            for i below (length cell)     
            do
            (insert <span style="color: #228b22;">"\n"</span>)
            (loop for j below (length cell)
                  do
                  (<span style="color: #8b0000;">if</span> (equal i j)
                      (insert (format <span style="color: #228b22;">" %f "</span> (float (elt cell i))))
                    (insert (format <span style="color: #228b22;">" %f "</span> 0.0 ))))))
    ;; <span style="color: #ff0000; font-weight: bold;">The next line is counts for each atom type. For each number in</span>
    ;; <span style="color: #ff0000; font-weight: bold;">this line, there will be a copy of the POTCAR in the POTCAR</span>
    ;; <span style="color: #ff0000; font-weight: bold;">file. In ase, we sort the atoms and group them so that there is</span>
    ;; <span style="color: #ff0000; font-weight: bold;">only one POTCAR per atom. We do not do that here yet. We will</span>
    ;; <span style="color: #ff0000; font-weight: bold;">have a POTCAR for each atom.</span>
    (insert <span style="color: #228b22;">"\n"</span>)
    (loop for atom in (oref (oref calc atoms) atoms)
          do (insert (format <span style="color: #228b22;">"1 "</span>)))
    
    ;; <span style="color: #ff0000; font-weight: bold;">now we do the atoms</span>
    (insert <span style="color: #228b22;">"\nCartesian\n"</span>)
    (loop for atom in (oref (oref calc atoms) atoms)
          do
          (insert
           (format <span style="color: #228b22;">"%f %f %f\n"</span>
                   (oref atom x)
                   (oref atom y)
                   (oref atom z))))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-kpoints</span> ((calc Jasp))
  <span style="color: #228b22;">"Create KPOINTS file for CALC. </span>
<span style="color: #228b22;">Limited to automatic generation, and no offset."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"KPOINTS"</span>
    (insert <span style="color: #228b22;">"Automatic mesh</span>
<span style="color: #228b22;">0</span>
<span style="color: #228b22;">Monkhorst-Pack</span>
<span style="color: #228b22;">"</span>)
    (<span style="color: #8b0000;">dolist</span> (k (oref calc kpts))
      (insert (format <span style="color: #228b22;">"%4d "</span> k)))
    (insert <span style="color: #228b22;">"\n0.0 0.0 0.0"</span>)
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-potcar</span> ((calc Jasp))
  <span style="color: #228b22;">"Generate the POTCAR file for CALC.</span>
<span style="color: #228b22;">No `</span><span style="color: #cd0000;">Atom</span><span style="color: #228b22;">' grouping is done, there is one POTCAR for each atom."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"POTCAR"</span>
    (<span style="color: #8b0000;">let</span> ((xc (oref calc xc))
          (atoms (oref calc atoms))
          (vasp_pp_path (getenv <span style="color: #228b22;">"VASP_PP_PATH"</span>)))
      (loop for atom in (oref atoms atoms)
            do
            (insert-file-contents
             (f-join
              vasp_pp_path
              (concat <span style="color: #228b22;">"potpaw_"</span> xc)
              (oref atom symbol)
              <span style="color: #228b22;">"POTCAR"</span>))))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-incar</span> ((calc Jasp))
  <span style="color: #228b22;">"Generate the INCAR file for CALC."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"INCAR"</span>
    (insert (format <span style="color: #228b22;">"ENCUT = %f\n"</span> (oref calc encut)))
    (insert (format <span style="color: #228b22;">"NBANDS = %d\n"</span> (oref calc nbands)))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">run</span> ((calc Jasp))
  <span style="color: #228b22;">"Write out input files, and run VASP as a simple shell command"</span>
  (write-poscar calc)
  (write-kpoints calc)
  (write-potcar calc)
  (write-incar calc)
  (shell-command <span style="color: #228b22;">"vasp"</span>))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">update</span> ((calc Jasp))
  <span style="color: #228b22;">"Run vasp if needed for CALC.</span>
<span style="color: #228b22;">We just check for a properly ended OUTCAR."</span>
  (with-current-directory
   (oref calc wd)
   (<span style="color: #8b0000;">unless</span> (and (file-exists-p <span style="color: #228b22;">"OUTCAR"</span>)
                (<span style="color: #8b0000;">with-temp-buffer</span>
                  (insert-file-contents <span style="color: #228b22;">"OUTCAR"</span>)
                  (re-search-forward
                  <span style="color: #228b22;">"                 Voluntary context switches:"</span>
                  (point-max)
                  t)))
     (run calc))))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">get-potential-energy</span> ((calc Jasp))
  <span style="color: #228b22;">"Get potential energy from CALC."</span>
  (update calc)
  (with-current-directory
   (oref calc wd)
   (<span style="color: #8b0000;">with-temp-buffer</span>
     (insert-file-contents <span style="color: #228b22;">"OUTCAR"</span>)
     ;; <span style="color: #ff0000; font-weight: bold;">go to last entry</span>
     (<span style="color: #8b0000;">while</span> (re-search-forward
             <span style="color: #228b22;">"free  energy   TOTEN  =\\s-*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[-]?[0-9]*\\.[0-9]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;"> eV"</span>
             (point-max)
             t)
       nil)
     ;; <span style="color: #ff0000; font-weight: bold;">return last match</span>
     (string-to-number  (match-string 1)))))

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">jasp</span>)
</pre>
</div>

<pre class="example">
get-potential-energy
</pre>


<p>
This is worth some discussion. On one hand, the constructor is a bit more verbose than the implementation in Python. In Python we use a context handler in place of the macro here. On the other hand, that verbosity comes with detailed, accessible documentation for each argument. We only considered the simplest of input arguments. It might be trickier to include lists, and other types of input. But I think those can all be worked out like they were in ase. We only implemented the simplest job control logic, but that also can be worked out. The biggest challenge might be getting more complex data from the output. Nearly everything can be obtained from vasprun.xml also, in the event that parsing is to slow or difficult.
</p>

<p>
Now, let us test this out. We can make a calculator:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq calc (Jasp
            nil
            <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
            <span style="color: #cd0000;">:encut</span> 350
            <span style="color: #cd0000;">:nbands</span> 6
            <span style="color: #cd0000;">:atoms</span> (Atoms
                    nil
                    <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                             ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                    <span style="color: #cd0000;">:cell</span> '(8 9 10))))
</pre>
</div>

<pre class="example">
[object Jasp nil "." 350 6 (1 1 1) "PBE" [object Atoms nil ([object Atom nil "C" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]]
</pre>

<p>
We can call the class functions like this. Here we write out the corresponding POSCAR:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-poscar calc)
</pre>
</div>

<pre class="example">
Created by jasp.el
  1.0
 8.000000  0.000000  0.000000 
 0.000000  9.000000  0.000000 
 0.000000  0.000000  10.000000 
1 1 
Cartesian
0.000000 0.000000 0.000000
1.100000 0.000000 0.000000
</pre>

<p>
It looks a little backward if you have only seen Python, where this would be calc.write<sub>poscar</sub>(). It is almost the same characters, just a different order (and no . in lisp)!
</p>

<p>
Here we get the KPOINTS file:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-kpoints calc)
</pre>
</div>

<pre class="example">
Automatic mesh
0
Monkhorst-Pack
   1    1    1 
0.0 0.0 0.0
</pre>


<p>
I cannot show the POTCAR file for licensing reasons, but it works.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-potcar calc)
</pre>
</div>

<p>
and the INCAR file:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-incar calc)
</pre>
</div>

<pre class="example">
ENCUT = 350.000000
NBANDS = 6
</pre>

<p>
We run a calculation like this. This will run vasp directly (not through the queue system). 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(run calc)
</pre>
</div>

<pre class="example">
0
</pre>

<p>
The returned 0 means the shell command finished correctly.
</p>

<p>
And we retrieve the potential energy like this:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(get-potential-energy calc)
</pre>
</div>

<pre class="example">
-14.687906
</pre>

<p>
Not bad. That is close to the result we got from a similar calculation <a href="http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-3-1">here</a> . 
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Putting it all together to run calculations</h2>
<div class="outline-text-2" id="text-4">
<p>
If we put this all together the way we might use it in practice, it looks like this. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-file <span style="color: #228b22;">"Atom.el"</span>)
(load-file <span style="color: #228b22;">"Atoms.el"</span>)
(load-file <span style="color: #228b22;">"Jasp.el"</span>)

(<span style="color: #8b0000;">let*</span> ((co (Atoms
            nil
            <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                     ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
            <span style="color: #cd0000;">:cell</span> '(8 9 10)))

       (calc (Jasp
              nil
              <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
              <span style="color: #cd0000;">:nbands</span> 6
              <span style="color: #cd0000;">:encut</span> 350
              <span style="color: #cd0000;">:atoms</span> co)))
  
  (get-potential-energy calc))
</pre>
</div>

<pre class="example">
-14.687906
</pre>

<p>
Compare this with this Python code which does approximately the same thing:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase <span style="color: #8b0000;">import</span> Atoms, Atom
<span style="color: #8b0000;">from</span> jasp <span style="color: #8b0000;">import</span> *

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">co</span> = Atoms([Atom(<span style="color: #228b22;">'C'</span>, [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>]),
            Atom(<span style="color: #228b22;">'O'</span>, [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>])],
            <span style="color: #000000; background-color: #cccccc; font-weight: bold;">cell</span>=(<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>., <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>., <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>.))

<span style="color: #8b0000;">with</span> jasp(<span style="color: #228b22;">'molecules/simple-co'</span>, <span style="color: #ff0000; font-weight: bold;">#output dir</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">xc</span>=<span style="color: #228b22;">'PBE'</span>,  <span style="color: #ff0000; font-weight: bold;"># the exchange-correlation functional</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">nbands</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>,  <span style="color: #ff0000; font-weight: bold;"># number of bands</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">encut</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">350</span>, <span style="color: #ff0000; font-weight: bold;"># planewave cutoff</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span>=co) <span style="color: #8b0000;">as</span> calc:
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'energy = {0} eV'</span>.format(co.get_potential_energy())
</pre>
</div>

<p>
They look pretty similar. One thing clearly missing from emacs-lisp that Python has is full support for numerics and plotting. Some of this could be addressed via <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs/">Pymacs</a> , but certainly not all of it. Some of it could also be handled using org-mode to enable data from emacs-lisp to go to other code blocks that can handle it. 
</p>

<p>
Finally, for a little fun, we illustrate mapping over a range of bond lengths. There is more than one way to do this. For example, we could create a list of calculators, and then run over them. Here we create one calculator, and just change the x position in a loop. We use the more general setf approach instead of oset to see what it looks like.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((co (Atoms
            nil
            <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                     ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
            <span style="color: #cd0000;">:cell</span> '(8 9 10)))
       (calc (Jasp
              nil
              <span style="color: #cd0000;">:wd</span> nil
              <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
              <span style="color: #cd0000;">:nbands</span> 6
              <span style="color: #cd0000;">:encut</span> 350
              <span style="color: #cd0000;">:atoms</span> co)))
  (<span style="color: #8b0000;">dolist</span> (d '(1.05 1.1 1.15 1.2 1.25))
    ;; <span style="color: #ff0000; font-weight: bold;">change working directory</span>
    (setf (oref calc wd) (format <span style="color: #228b22;">"co-%s"</span> d))
    ;; <span style="color: #ff0000; font-weight: bold;">set x-coordinate on oxygen atom</span>
    (setf (oref (elt (oref co atoms) 1) x) d)
    (print (format <span style="color: #228b22;">"d = %s\nEnergy = %s eV"</span>
                   d
                   (get-potential-energy calc)))))
</pre>
</div>

<pre class="example">
"d = 1.05
Energy = -14.195892 eV"

"d = 1.1
Energy = -14.698456 eV"

"d = 1.15
Energy = -14.814809 eV"

"d = 1.2
Energy = -14.660395 eV"

"d = 1.25
Energy = -14.319904 eV"
</pre>

<p>
See <a href="http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-4-1">http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-4-1</a> for how this was done in Python. It looks pretty similar to me.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Summary thoughts</h2>
<div class="outline-text-2" id="text-5">
<p>
We implemented a bare bones emacs-lisp calculator for VASP. The library automates creation of input files, running the calculation, and parsing the output.
</p>

<p>
It seems pretty feasible to implement a pretty complete interface to VASP in emacs-lisp. The main reasons to do this are:
</p>
<ol class="org-ol">
<li>Integrated access to documentation
</li>
<li>Emacs editing of emacs-lisp code 
</li>
<li>Integration with org-mode
</li>
</ol>

<p>
Even with Python editor that had access to documentation as deeply integrated as emacs has with emacs-lisp, it would still just be a Python editor, i.e. you probably could not use the editor to write org-mode, LaTeX, etc&#x2026; It is time to recognize we need both scientific document creation <i>and</i> code editing capability in the same place! This kind of suggests a need to get a better Python environment going in Emacs, which deeper integration of the documentation. See <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/12/20/A-new-mode-for-Python-documentation/">this</a> post for some progress in that area!
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>]]></content:encoded>
    </item>
  </channel>
</rss>
