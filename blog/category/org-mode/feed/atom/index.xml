<?xml version="1.0" encoding="UTF-8"?>
<feed
  xmlns="http://www.w3.org/2005/Atom"
  xmlns:thr="http://purl.org/syndication/thread/1.0"
  xml:lang="en"
   >
  <title type="text">The Kitchin Research Group</title>
  <subtitle type="text">Chemical Engineering at Carnegie Mellon University</subtitle>

  <updated>2015-02-23T00:07:05Z</updated>
  <generator uri="http://blogofile.com/">Blogofile</generator>

  <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog" />
  <id>http://jkitchin.github.io/blog/feed/atom/</id>
  <link rel="self" type="application/atom+xml" href="http://jkitchin.github.io/blog/feed/atom/" />
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Another parsing of links for citations with pre and post text.]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/06/26/Another-parsing-of-links-for-citations-with-pre-and-post-text" />
    <id>http://jkitchin.github.io/blog/2014/06/26/Another-parsing-of-links-for-citations-with-pre-and-post-text</id>
    <updated>2014-06-26T20:16:43Z</updated>
    <published>2014-06-26T20:16:43Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <category scheme="http://jkitchin.github.io/blog" term="org-ref" />
    <summary type="html"><![CDATA[Another parsing of links for citations with pre and post text.]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/06/26/Another-parsing-of-links-for-citations-with-pre-and-post-text"><![CDATA[



<p>
Some LaTeX citations look like \cite[pretext][post text]{key}. Here I explore parsing a link like <a href="#(pre text)(post text)key">(pre text)(post text)key</a>. Note you cannot use [] inside the link, as it breaks the link syntax. Also, these links must be wrapped in <code>[[]]</code> because of the parentheses and spaces in the parentheses. This is a very different approach than used <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/05/19/Exporting-citations-with-biblatex/">here</a> which used the description of the link to define the pre and post text. The disadvantage of that approach is that the key is hidden, whereas in this approach it is not; you can see the key and pre/post text.
</p>

<p>
The basic strategy will be to use a regexp to parse the link path. The regexp below is pretty hairy, but basically it looks for optional text in () and uses numbered groups to store what is found. Then, we use what we found to construct the LaTeX syntax. We redefine the function in org-ref that gets the key for clicking, and we redefine the cite format function. The result is that we retain the click functionality that shows us what the key refers to.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-ref-parse-key (s)
  "return pretext, posttext and bibtex key from a string like \"(pre text)(post text)bibtexkey\""
  (string-match "\\(?1:(\\(?2:[^)]*\\))\\)?\\(?3:(\\(?4:[^]]*\\))\\)?\\(?5:.*\\)" s)
  ;; return pretext postext key
  (list (match-string 2 s) (match-string 4 s) (match-string 5 s)))

(defun org-ref-get-bibtex-key-and-file (&amp;optional key)
  "returns the bibtex key and file that it is in. If no key is provided, get one under point"
 (interactive)
 (let ((org-ref-bibliography-files (org-ref-find-bibliography))
       (file))
   (unless key
     ;; get the key
     (setq key (nth 2 (org-ref-parse-key (org-ref-get-bibtex-key-under-cursor)))))
   (setq file     (catch 'result
		    (loop for file in org-ref-bibliography-files do
			  (if (org-ref-key-in-file-p key (file-truename file)) 
			      (throw 'result file)))))
   (cons key file)))

(defun org-ref-format-cite (keyword desc format)
   (cond
    ((eq format 'latex)
     (let* ((results (org-ref-parse-key keyword))
	    (pretext (nth 0 results))
	    (posttext (nth 1 results))
	    (key (nth 2 results)))
       (concat "\\cite" 
	       (when pretext (format "[%s]" pretext))
	       (when posttext (format "[%s]" posttext))
	       (format "{%s}" key))))))
</pre>
</div>

<pre class="example">
org-ref-format-cite
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-ref-format-cite "(pre text)(post text)key" nil 'latex)
</pre>
</div>

<pre class="example">
\cite[pre text][post text]{key}
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-ref-format-cite "(pre text)key" nil 'latex)
</pre>
</div>

<pre class="example">
\cite[pre text]{key}
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-ref-format-cite "key" nil 'latex)
</pre>
</div>

<pre class="example">
\cite{key}
</pre>

<p>
It looks like they all work! Let us test the links: <a href="#mehta-2014-ident-poten">mehta-2014-ident-poten</a>, <a href="#(pre text)mehta-2014-ident-poten">(pre text)mehta-2014-ident-poten</a> and <a href="#(pre text)(post text)biskup-2014-insul-ferrom-films">(pre text)(post text)biskup-2014-insul-ferrom-films</a>. a multiple citation <a href="#mehta-2014-ident-poten">mehta-2014-ident-poten</a>,<a href="#thompson-2014-co2-react">thompson-2014-co2-react</a>,<a href="#calle-vallejo-2013-number">calle-vallejo-2013-number</a>.
</p>

<p>
This seems to work from an export point of view. You can not mix multiple citations with this syntax, and I did not define the html export above. Otherwise, it looks like this might be a reasonable addition to org-ref.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/06/26/Another-parsing-of-links-for-citations-with-pre-and-post-text..org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Using org-files like el-files]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/06/24/Using-org-files-like-el-files" />
    <id>http://jkitchin.github.io/blog/2014/06/24/Using-org-files-like-el-files</id>
    <updated>2014-06-24T21:34:15Z</updated>
    <published>2014-06-24T21:32:58Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[Using org-files like el-files]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/06/24/Using-org-files-like-el-files"><![CDATA[


<p>
I wrote some emacs-lisp code in org-mode, and load them with org-babel-load-file. I thought it would be nice if there was load path for org-files, similar to the one for lisp files. Here I document what it might look like.
</p>

<p>
We need a load path to search for the org-file.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-load-path '("~/Dropbox/kitchingroup/jmax/"))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">~/Dropbox/kitchingroup/jmax/</td>
</tr>
</tbody>
</table>

<p>
Next, we need the function to do the loading. We need to find the org-file, and then load it.
</p>



<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-require (orgfile)
  "orgfile is a symbol to be loaded"
  (let ((org-file (concat (symbol-name orgfile) ".org"))
	(path))

  ;; find the org-file
  (catch 'result
    (loop for dir in org-load-path do
	  (when (file-exists-p
		 (setq path
		       (concat
			(directory-file-name dir)
			"/"
			org-file)))
	    (throw 'result path))))
  (org-babel-load-file path)))


(org-require 'org-ref)
</pre>
</div>

<pre class="example">
Loaded ~/Dropbox/kitchingroup/jmax/org-ref.el
</pre>

<p>
That looks pretty simple. You do need write access to the location where the org-file is though. Let us look at a version that copies the file to a temporary directory. For some reason, I am not able to use org-babel-load-file with this. But, it does look like I can tangle the file, and assuming (big assumption) that the file tangles to a regularly named .el file, this seems to work too.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-require (orgfile)
  "orgfile is a symbol to be loaded"
  (let ((org-file (concat (symbol-name orgfile) ".org"))
        (el-file (concat (symbol-name orgfile) ".el"))
	(path))

  ;; find the org-file
  (catch 'result
    (loop for dir in org-load-path do
	  (when (file-exists-p
		 (setq path
		       (concat
			(directory-file-name dir)
			"/"
			org-file)))
	    (throw 'result path))))
  (copy-file path temporary-file-directory t)

  (org-babel-tangle-file (concat temporary-file-directory (file-name-nondirectory path)))
  (load-file (concat temporary-file-directory el-file))
))

(org-require 'org-ref)
</pre>
</div>

<pre class="example">
t
</pre>

<p>
This actually seems pretty reasonable. I have not thought about complications but for simple cases, e.g. single org-file, it looks ok.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/06/24/Using-org-files-like-el-files.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Better integration of org-mode and email]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/06/08/Better-integration-of-org-mode-and-email" />
    <id>http://jkitchin.github.io/blog/2014/06/08/Better-integration-of-org-mode-and-email</id>
    <updated>2014-06-08T20:57:53Z</updated>
    <published>2014-06-08T20:57:53Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="email" />
    <summary type="html"><![CDATA[Better integration of org-mode and email]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/06/08/Better-integration-of-org-mode-and-email"><![CDATA[


<p>
I like to email org-mode headings and content to people. It would be nice to have some records of when a heading was sent, and to whom. We store this information in a heading. It is pretty easy to write a simple function that emails a selected region.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun email-region (start end)
  "Send region as the body of an email."
  (interactive "r")
  (let ((content (buffer-substring start end)))
    (compose-mail)
    (message-goto-body)
    (insert content)
    (message-goto-to)))
</pre>
</div>

<p>
that function is not glamorous, and you still have to fill in the email fields, and unless you use gnus and org-contacts, the only record keeping is through the email provider. 
</p>

<p>
What I would like is to send a whole heading in an email. The headline should be the subject, and if there are TO, CC or BCC properties, those should be used. If there is <i>no TO</i>, then I want to grab the TO from the email after you enter it and store it as a property. You should be able to set OTHER-HEADERS as a property (this is just for fun. There is no practical reason for this yet). After you send the email, it should record in the heading when it was sent.
</p>

<p>
It turned out that is a relatively tall order. While it is easy to setup the email if you have everything in place, it is tricky to get the information on TO and the time sent <i>after</i> the email is sent. Past lispers had a lot of ideas to make this possible, and a day of digging got me to the answer. You can specify some "action" functions that get called at various times, e.g. after sending, and a return action when the compose window is done. Unfortunately, I could not figure out any way to do things except to communicate through some global variables.
</p>

<p>
So here is the code that lets me send org-headings, with the TO, CC, BCC properties, and that records when I sent the email after it is sent.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defvar *email-heading-point* nil
  "global variable to store point in for returning")

(defvar *email-to-addresses* nil
  "global variable to store to address in email")

(defun email-heading-return ()
  "after returning from compose do this"
  (switch-to-buffer (marker-buffer  *email-heading-point*))
  (goto-char (marker-position  *email-heading-point*))
  (setq *email-heading-point* nil)
  (org-set-property "SENT-ON" (current-time-string))
  ;; reset this incase you added new ones
  (org-set-property "TO" *email-to-addresses*)
  )

(defun email-send-action ()
  "send action for compose-mail"
  (setq *email-to-addresses* (mail-fetch-field "To")))

(defun email-heading ()
  "Send the current org-mode heading as the body of an email, with headline as the subject.

use these properties
TO
OTHER-HEADERS is an alist specifying additional
header fields.  Elements look like (HEADER . VALUE) where both
HEADER and VALUE are strings.

save when it was sent as s SENT property. this is overwritten on
subsequent sends. could save them all in a logbook?
"
  (interactive)
  ; store location.
  (setq *email-heading-point* (set-marker (make-marker) (point)))
  (org-mark-subtree)
  (let ((content (buffer-substring (point) (mark)))
	(TO (org-entry-get (point) "TO" t))
	(CC (org-entry-get (point) "CC" t))
	(BCC (org-entry-get (point) "BCC" t))
	(SUBJECT (nth 4 (org-heading-components)))
	(OTHER-HEADERS (eval (org-entry-get (point) "OTHER-HEADERS")))
	(continue nil)
	(switch-function nil)
	(yank-action nil)
	(send-actions '((email-send-action . nil)))
	(return-action '(email-heading-return)))
    
    (compose-mail TO SUBJECT OTHER-HEADERS continue switch-function yank-action send-actions return-action)
    (message-goto-body)
    (insert content)
    (when CC
      (message-goto-cc)
      (insert CC))
    (when BCC
      (message-goto-bcc)
      (insert BCC))
    (if TO
	(message-goto-body)
      (message-goto-to))       
    ))
</pre>
</div>

<p>
This works pretty well for me. Since I normally use this to send tasks to people, it keeps the task organized where I want it, and I can embed an org-id in the email so if the person replies to it telling me the task is done, I can easily navigate to the task to mark it off. Pretty handy.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/06/08/Better-integration-of-org-mode-and-email.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Finding emails from tags from org-contacts database]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/06/05/Finding-emails-from-tags-from-org-contacts-database" />
    <id>http://jkitchin.github.io/blog/2014/06/05/Finding-emails-from-tags-from-org-contacts-database</id>
    <updated>2014-06-05T14:42:21Z</updated>
    <published>2014-06-05T14:42:21Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <summary type="html"><![CDATA[Finding emails from tags from org-contacts database]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/06/05/Finding-emails-from-tags-from-org-contacts-database"><![CDATA[



<p>
Org-mode has a contacts manager called org-contacts. If you set it up, you can use it to insert email addresses using a tag in message-mode. Out of the box though, it only works on one tag. You cannot do something like +group-phd to get entries tagged group but not tagged phd. Here we develop a function to do that for us. 
</p>

<p>
We could use the org-files and map the headings to do this, but org-contacts has already done this and has a database we can use instead. We get the database from org-contacts-filter. Here is the first entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(car (org-contacts-filter))
</pre>
</div>

<p>
(Chris Jones #&lt;marker at 1 in contacts.org&gt; ((FILE . c:/Users/jkitchin/Dropbox/org-mode/contacts.org) (TAGS . :co2:) (ALLTAGS . :co2:) (BLOCKED . ) (COMPANY . Georgia Tech, Chemical Engineering) (EMAIL . Christopher.Jones@chbe.gatech.edu) (CATEGORY . contacts)))
</p>

<p>
It looks like we have (name marker (cons cells)) for each entry. We can get the tags associated with that entry like this.
</p>

<p>
We can get the tags for an entry with this code:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((entry (car (org-contacts-filter))))
  (cdr (assoc "TAGS" (nth 2 entry))))
</pre>
</div>

<pre class="example">
:co2:
</pre>

<p>
We will use some code for org tags. Notably, from a tags expression, we can automatically generate code that tells us if we have a match. Here we generate the code to test for a match on "+co2-group".
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((todo-only nil))
  (cdr (org-make-tags-matcher "+co2-group")))
</pre>
</div>

<p>
(and (progn (setq org-cached-props nil) (and (not (member group tags-list)) (member co2 tags-list))) t)
</p>

<p>
Note we will have to bind tags-list before we eval this.
</p>

<p>
So to use it, we need to split the tags from an org-contacts entry into a list of strings. It appears each entry just has the tag string, so we split the substring (skipping first and last characters) by ":" to get the list. We do that here, and test if a list of tags containing "co2" is matched by the expression "co2-junior".
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let* ((tags-list (split-string (substring ":co2:" 1 -1) ":"))
       (todo-only nil))
  (eval (cdr (org-make-tags-matcher "co2-junior"))))
</pre>
</div>

<pre class="example">
t
</pre>

<p>
It is. So, now we just need to loop through the database, and collect entries that match.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun insert-emails-from-tags (tag-expression)
  "insert emails from org-contacts that match the tags expression. For example:
group-phd will match entries tagged with group but not with phd."
  (interactive "sTags: ")
  (insert
   (mapconcat 'identity
	      (loop for contact in (org-contacts-filter)
		    for contact-name = (car contact)
		    for email = (org-contacts-strip-link (car (org-contacts-split-property
							       (or
								(cdr (assoc-string org-contacts-email-property
										   (caddr contact)))
								""))))
		    for tags = (cdr (assoc "TAGS" (nth 2 contact)))
		    for tags-list = (if tags
					(split-string (substring (cdr (assoc "TAGS" (nth 2 contact))) 1 -1) ":")
				      '())
		    if (let ((todo-only nil))
			 (eval (cdr (org-make-tags-matcher tag-expression))))
		    
		    collect (org-contacts-format-email contact-name email))
	      ",")))
</pre>
</div>

<p>
This is not quite completion in message-mode, but it is good enough. You put your cursor in the To field, and run that command, enter the tag expression, and you will get your emails!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/06/05/Finding-emails-from-tags-from-org-contacts-database.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[org-shift hooks for ordering citations]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/05/21/org-shift-hooks-for-ordering-citations" />
    <id>http://jkitchin.github.io/blog/2014/05/21/org-shift-hooks-for-ordering-citations</id>
    <updated>2014-05-21T11:37:40Z</updated>
    <published>2014-05-21T11:11:56Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="bibtex" />
    <summary type="html"><![CDATA[org-shift hooks for ordering citations]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/05/21/org-shift-hooks-for-ordering-citations"><![CDATA[


<p>
I wrote a function that sorts citations by year, but there might be a reason to order them some other way. Here we develop a method to use shift-arrow keys to do the ordering. We will need to write a function that gets the citations in a link, gets the key under point, and then swap with neighboring keys depending on the arrow pressed. It is trivial to get the key under point (org-ref-get-bibtex-key-under-cursor), and we saw before it is easy to get the keys in a link. Let us examine swapping elements of a list here. This is an old algorithm, we store the first value, replace it with the second value, and then set the second value.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-ref-swap-keys (i j keys)
 "swap the keys in a list with index i and j"
 (let ((tempi (nth i keys)))
   (setf (nth i keys) (nth j keys))
   (setf (nth j keys) tempi))
  keys)

(org-ref-swap-keys 2 3 '(1 2 3 4))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">4</td>
<td class="right">3</td>
</tr>
</tbody>
</table>

<p>
So, we need to get the keys in the link at point, the key at point, the index of the key at point, and then we can swap them, and reconstruct the link. Here is the function that does this, and that adds the hooks.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-ref-swap-citation-link (direction)
 "move citation at point in direction +1 is to the right, -1 to the left"
 (interactive)
 (let* ((object (org-element-context))	 
        (type (org-element-property :type object))
	(begin (org-element-property :begin object))
	(end (org-element-property :end object))
	(link-string (org-element-property :path object))
        (key (org-ref-get-bibtex-key-under-cursor))
	(keys (org-ref-split-and-strip-string link-string))
        (i (index key keys)) point) ;; defined in org-ref
   (if (&gt; direction 0) ;; shift right
     (org-ref-swap-keys i (+ i 1) keys)
     (org-ref-swap-keys i (- i 1) keys))	
  (setq keys (mapconcat 'identity keys ","))
  ;; and replace the link with the sorted keys
  (cl--set-buffer-substring begin end (concat type ":" keys))
  ;; now go forward to key so we can move with the key
  (re-search-forward key) 
  (goto-char (match-beginning 0))))

(add-hook 'org-shiftright-hook (lambda () (org-ref-swap-citation-link 1)))
(add-hook 'org-shiftleft-hook (lambda () (org-ref-swap-citation-link -1)))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">lambda</td>
<td class="left">nil</td>
<td class="left">(org-ref-swap-citation-link -1)</td>
</tr>
</tbody>
</table>

<p>
<a href="#kanan-2008-in-situ">kanan-2008-in-situ</a>,<a href="#kanan-2009-cobal">kanan-2009-cobal</a>,<a href="#lutterman-2009-self-healin">lutterman-2009-self-healin</a>,<a href="#mcalpin-2010-epr-eviden">mcalpin-2010-epr-eviden</a>,<a href="#liu-2014-spect-studies">liu-2014-spect-studies</a>! 
</p>

<p>
That is it! Wow, not hard at all. Check out this video of the code in action: <a href="http://screencast.com/t/YmgA0fnZ1Ogl">http://screencast.com/t/YmgA0fnZ1Ogl</a> 
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/21/org-shift-hooks-for-ordering-citations.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Exporting citations with biblatex]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/05/19/Exporting-citations-with-biblatex" />
    <id>http://jkitchin.github.io/blog/2014/05/19/Exporting-citations-with-biblatex</id>
    <updated>2014-05-19T07:29:18Z</updated>
    <published>2014-05-19T07:29:18Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <summary type="html"><![CDATA[Exporting citations with biblatex]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/05/19/Exporting-citations-with-biblatex"><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Summary</a></li>
</ul>
</div>
</div>

<p>
This post illustrates that org-ref works with biblatex. We create a simple document and export it to pdf, and HTML for this post. We also explore how to modify the export behavior of a link. You should look at the org-source at the bottom to see the whole setup; it does not all export to either format.
</p>

<p>
We need a simple export type with no default packages to avoid the natbib packages I have setup in my default list. Here is the setup. Just run C-c C-c in the block to temporarily add this to your setup.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'org-latex-classes
	     '("article-biblatex"                         
	       "\\documentclass{article}
 [NO-DEFAULT-PACKAGES]
 [PACKAGES]
 [EXTRA]"        
	       ("\\section{%s}" . "\\section*{%s}")
	       ("\\subsection{%s}" . "\\subsection*a{%s}")
	       ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
	       ("\\paragraph{%s}" . "\\paragraph*{%s}")
	       ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
</pre>
</div>

<p>
Add some citations <a href="#andriotis-2014-infor">andriotis-2014-infor</a>,<a href="#armiento-2014-high">armiento-2014-high</a>,<a href="#biskup-2014-insul-ferrom-films">biskup-2014-insul-ferrom-films</a>,<a href="#chemelewski-2014-amorp-feooh">chemelewski-2014-amorp-feooh</a>,<a href="#chen-2014-inter-effec">chen-2014-inter-effec</a>
 and then a single citation <a href="#chen-2014-inter-effec">chen-2014-inter-effec</a>.
</p>

<p>
and a complicated latex \cite[pre text][post text]{chen-2014-inter-effec}. Note this one will export to LaTeX fine, but not to HTML.
</p>

<p>
I would like to create a citation link that exports that way. We will do it by using a parseable syntax in the description of a link. We will have to temporarily define a new format function to achieve this. Here it is, just for the autocite command.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-ref-format-autocite (keyword desc format)
  (when (eq format 'latex)
    (concat "\\autocite"
	    (cond
	     ((string-match "::" desc)
	      (format "[%s][%s]" (car (setq results (split-string desc "::"))) (cadr results)))
	     (desc (format "[%s]" desc)))
	    (format "{%s}" keyword))))
</pre>
</div>

<p>
This is the syntax:
</p>
<pre class="example">
a citation with post text: [[autocite:armiento-2014-high][post text]]

a citation with pre and post text:  [[autocite:andriotis-2014-infor][pre text::post text]]
</pre>
<p>
a citation with post text: <a href="#armiento-2014-high">armiento-2014-high</a> (the post text is not rendered in html).
</p>

<p>
a citation with pre and post text:  <a href="#andriotis-2014-infor">andriotis-2014-infor</a> (the pre/post text is not rendered in html).
</p>

<p>
The links in org-mode are no longer that readable when they are collapsed as descriptive links, but they are not too bad as literal links. 
</p>

<p>
Here is the file  and <a href="/media/2014-05-19-Exporting-citations-with-biblatex/exporting-with-biblatex.pdf">exporting-with-biblatex.pdf</a> . One of those links is for the pdf, and one is for the HTML file.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
org-ref seems to work pretty well with biblatex now. 
</p>

<p>
We use a printbibliography link here. This exports to the latex command, or an html bibliography.
<h1>Bibliography</h1>
<ul><li><a id="andriotis-2014-infor">[andriotis-2014-infor] Andriotis, Antonis N. and Mpourmpakis, Giannis and  Broderick, Scott and Rajan, Krishna and Datta,  Somnath and Sunkara, Mahendra and Menon, Madhu, "Informatics guided discovery of surface  structure-chemistry relationships in catalytic  nanoparticles", The Journal of Chemical Physics, 140:094705 (2014). <a href="http://scitation.aip.org/content/aip/journal/jcp/140/9/10.1063/1.4867010">link</a> <a href="http://dx.doi.org/10.1063/1.4867010">doi</a></a></li>
<li><a id="armiento-2014-high">[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014). <a href="http://link.aps.org/doi/10.1103/PhysRevB.89.134103">link</a> <a href="http://dx.doi.org/10.1103/PhysRevB.89.134103">doi</a></a></li>
<li><a id="biskup-2014-insul-ferrom-films">[biskup-2014-insul-ferrom-films] Bi{\v{s}}kup, Neven and  Salafranca, Juan and Mehta, Virat and Oxley, Mark  P. and Suzuki, Yuri and Pennycook, Stephen J. and  Pantelides, Sokrates T. and Varela, Maria, "Insulating Ferromagnetic \ce{LaCoO_{3-$\delta$}}  Films: A Phase Induced by Ordering of Oxygen  Vacancies", Phys. Rev. Lett., 112:087202 (2014). <a href="http://link.aps.org/doi/10.1103/PhysRevLett.112.087202">link</a> <a href="http://dx.doi.org/10.1103/PhysRevLett.112.087202">doi</a></a></li>
<li><a id="chemelewski-2014-amorp-feooh">[chemelewski-2014-amorp-feooh] Chemelewski, William D. and Lee, Heung-Chan and Lin,  Jung-Fu and Bard, Allen J. and Mullins, C. Buddie, "Amorphous \ce{FeOOH} Oxygen Evolution Reaction Catalyst  for Photoelectrochemical Water Splitting", Journal of the American Chemical Society, 136:2843-2850 (2014). <a href="">link</a> <a href="http://dx.doi.org/10.1021/ja411835a">doi</a></a></li>
<li><a id="chen-2014-inter-effec">[chen-2014-inter-effec] Chen, Guangxu and Zhao, Yun and Fu, Gang and  Duchesne, Paul N. and Gu, Lin and Zheng, Yanping and  Weng, Xuefei and Chen, Mingshu and Zhang, Peng and  Pao, Chih-Wen and Lee, Jyh-Fu and Zheng, Nanfeng, "Interfacial Effects in Iron-Nickel  Hydroxide-Platinum Nanoparticles Enhance Catalytic  Oxidation", Science, 344:495-499 (2014). <a href="http://www.sciencemag.org/content/344/6183/495.abstract">link</a> <a href="http://dx.doi.org/10.1126/science.1252553">doi</a></a></li>
</ul>
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/19/Exporting-citations-with-biblatex.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Creating bibliographies in other formats with org-ref]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/05/18/Creating-bibliographies-in-other-formats-with-org-ref" />
    <id>http://jkitchin.github.io/blog/2014/05/18/Creating-bibliographies-in-other-formats-with-org-ref</id>
    <updated>2014-05-18T11:55:34Z</updated>
    <published>2014-05-18T10:11:18Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="bibtex" />
    <summary type="html"><![CDATA[Creating bibliographies in other formats with org-ref]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/05/18/Creating-bibliographies-in-other-formats-with-org-ref"><![CDATA[



<p>
org-ref automatically generates bibliographies in LaTeX export, and it does a reasonable job automatically generating HTML bibliographies (ox-bibtex probably does this better, but it relies on an external program, whereas this approach is all elisp). Here we illustrate how to generate other formats, e.g. plain text, or org-mode formatted.
</p>

<p>
org-ref provides a convenient function that generates a bibliography entry for a key formatted according to the variable org-ref-bibliography-entry-format. This variable is a string that uses the reftex percent escapes to create an entry. The default is setup for an HTML entry like this:
</p>

<pre class="example">
  "%a, %t, &lt;i&gt;%j&lt;/i&gt;, &lt;b&gt;%v(%n)&lt;/b&gt;, %p (%y). &lt;a href=\"%U\"&gt;link&lt;/a&gt;. &lt;a href=\"http://dx.doi.org/%D\"&gt;doi&lt;/a&gt;."
</pre>

<p>
We can redefine it temporarily to get other formats. Here is an example of getting an org-formatted entry with some italics and bold text.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((org-ref-bibliography-entry-format "%a, %t, /%j/, *%v(%n)*, %p (%y). [[%U][link]]. [[http://dx.doi.org/%D][doi]]."))
(org-ref-get-bibtex-entry-citation "andriotis-2014-infor"))
</pre>
</div>

<p>
"Andriotis, Mpourmpakis, , Broderick, Rajan, Datta, Somnath, Sunkara \&amp; Menon, Informatics guided discovery of surface  structure-chemistry relationships in catalytic  nanoparticles, <i>The Journal of Chemical Physics</i>, <b>140(9)</b>, 094705 (2014). <a href="http://scitation.aip.org/content/aip/journal/jcp/140/9/10.1063/1.4867010">link</a> . <a href="http://dx.doi.org/10.1063/1.4867010">doi</a> .
</p>

<p>
Now, we put some citations of various types in for water splitting <a href="#mccrory-2013-bench-heter">mccrory-2013-bench-heter</a>, CO<sub>2</sub> capture <a href="#alesi-2012-evaluat-primar">alesi-2012-evaluat-primar</a>, and microfluidic devices <a href="#voicu-2014-microf-studies">voicu-2014-microf-studies</a>. We will convert these links to a bibliography shortly.
</p>

<p>
Next, we generate an org-formatted bibliography. We will create a bracketed label at the beginning of the entry, and the org-format after that. This is a functional enough bibliography to be useful I think, and it illustrates the ideas. We will do some light transforming to replace escaped &amp; with regular &amp; in the bibliography.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">;; temorarily redefine the format
(let ((org-ref-bibliography-entry-format "%a, %t, /%j/, *%v(%n)*, %p (%y). [[%U][link]]. [[http://dx.doi.org/%D][doi]]."))

  (mapconcat 
   (lambda (key)
     (format "[%s] %s" key 
	     (replace-regexp-in-string 
	      "\\\\&amp;" 
	      "&amp;" (org-ref-get-bibtex-entry-citation key))))
   (org-ref-get-bibtex-keys) "\n\n"))
</pre>
</div>

<p>
[alesi-2012-evaluat-primar] Alesi &amp; Kitchin, Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture, <i>Industrial &amp; Engineering Chemistry Research</i>, <b>51(19)</b>, 6907-6915 (2012). <a href="http://dx.doi.org/10.1021/ie300452c">link</a> . <a href="http://dx.doi.org/10.1021/ie300452c">doi</a> .
</p>

<p>
[mccrory-2013-bench-heter] McCrory, Jung, Peters, Jonas &amp; Jaramillo, Benchmarking Heterogeneous Electrocatalysts for the  Oxygen Evolution Reaction, <i>J. Am. Chem. Soc.</i>, <b>135(45)</b>, 16977&#x2013;16987 (2013). <a href="http://dx.doi.org/10.1021/ja407115p">link</a> . <a href="http://dx.doi.org/10.1021/ja407115p">doi</a> .
</p>

<p>
[voicu-2014-microf-studies] Voicu, Abolhasani, Choueiri, Rachelle, Lestari, Seiler, , Menard, Greener, Guenther, Axel, Stephan &amp; Kumacheva, Microfluidic Studies of \ce{CO_2} Sequestration by  Frustrated {L}ewis Pairs, <i>Journal of the American Chemical Society</i>, <b>0(0)</b>, null (2014). [[][link]]. <a href="http://dx.doi.org/10.1021/ja411601a">doi</a> .
</p>

<p>
You can see some minor issues with the formatting, e.g. sometimes the link is empty, if there is no url in the bibtex entry. There is no easy way to fix that. The 0 and null values in the last entry are because that is an ASAP article, and that is what is in the bibtex entry. I do not try to expand the latex code, and do not plan to do that. I do not know why there appears to be a blank author in the last entry, or why the author full names are not used. Those are reftex issues and  low priority to fix for me. They do not exist in the LaTeX export. The main point here is to get a reasonably useful bibliography that you can adapt as you want.
</p>


<p>
<h1>Bibliography</h1>
<ul><li><a id="alesi-2012-evaluat-primar">[alesi-2012-evaluat-primar] Alesi \& Kitchin, Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture, <i>Industrial \& Engineering Chemistry Research</i>, <b>51(19)</b>, 6907-6915 (2012). <a href="http://dx.doi.org/10.1021/ie300452c">link</a>. <a href="http://dx.doi.org/10.1021/ie300452c">doi</a>.</a></li>
<li><a id="mccrory-2013-bench-heter">[mccrory-2013-bench-heter] McCrory, Jung, Peters, Jonas \& Jaramillo, Benchmarking Heterogeneous Electrocatalysts for the  Oxygen Evolution Reaction, <i>J. Am. Chem. Soc.</i>, <b>135(45)</b>, 16977--16987 (2013). <a href="http://dx.doi.org/10.1021/ja407115p">link</a>. <a href="http://dx.doi.org/10.1021/ja407115p">doi</a>.</a></li>
<li><a id="voicu-2014-microf-studies">[voicu-2014-microf-studies] Voicu, Abolhasani, Choueiri, Rachelle, Lestari, Seiler, , Menard, Greener, Guenther, Axel, Stephan \& Kumacheva, Microfluidic Studies of \ce{CO_2} Sequestration by  Frustrated {L}ewis Pairs, <i>Journal of the American Chemical Society</i>, <b>0(0)</b>, null (2014). <a href="">link</a>. <a href="http://dx.doi.org/10.1021/ja411601a">doi</a>.</a></li>
</ul>
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/18/Creating-bibliographies-in-other-formats-with-org-ref.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Exporting citations in html]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/05/17/Exporting-citations-in-html" />
    <id>http://jkitchin.github.io/blog/2014/05/17/Exporting-citations-in-html</id>
    <updated>2014-07-15T16:52:09Z</updated>
    <published>2014-05-17T14:41:43Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <summary type="html"><![CDATA[Exporting citations in html]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/05/17/Exporting-citations-in-html"><![CDATA[



<p>
Now that org-ref works well for LaTeX, I want to explore a simple approach to exporting citations with a bibliography in html. This will enable me to put citations in blogposts, like this one <a href="#armiento-2014-high">armiento-2014-high</a> and these ones <a href="#daza-2014-carbon-dioxid">daza-2014-carbon-dioxid</a>,<a href="#mehta-2014-ident-poten">mehta-2014-ident-poten</a>,<a href="#suntivich-2014-estim-hybrid">suntivich-2014-estim-hybrid</a>. We should be able to have the same citation in more than one place like this  <a href="#armiento-2014-high">armiento-2014-high</a>, but only have one entry in the bibliography. The bibliography should be sorted if we ask for it <a href="#alesi-2012-evaluat-primar">alesi-2012-evaluat-primar</a>. I am curious to see this book citation: <a href="#day-1995-scien-englis">day-1995-scien-englis</a>.
</p>

<p>
The first thing we need is a list of bibtex keys cited in this buffer.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-bibtex-keys</span> ()
  <span style="color: #228b22;">"return a list of unique keys in the buffer"</span>
  (interactive)
  (<span style="color: #8b0000;">let</span> ((keys '()))
    (org-element-map (org-element-parse-buffer) 'link
      (<span style="color: #8b0000;">lambda</span> (link)       
        (<span style="color: #8b0000;">let</span> ((plist (nth 1 link)))                          
          (<span style="color: #8b0000;">when</span> (-contains? org-ref-cite-types (plist-get plist '<span style="color: #cd0000;">:type</span>))
            (<span style="color: #8b0000;">dolist</span> 
                (key 
                 (org-ref-split-and-strip-string (plist-get plist '<span style="color: #cd0000;">:path</span>)))
              (<span style="color: #8b0000;">when</span> (not (-contains? keys key))
                (setq keys (append keys (list key)))))))))
    keys))

(org-ref-get-bibtex-keys)
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">armiento-2014-high</td>
<td class="left">daza-2014-carbon-dioxid</td>
<td class="left">mehta-2014-ident-poten</td>
<td class="left">suntivich-2014-estim-hybrid</td>
<td class="left">alesi-2012-evaluat-primar</td>
<td class="left">day-1995-scien-englis</td>
</tr>
</tbody>
</table>

<p>
Good. Now, we need to create an HTML string for the bibliography. For each key, we will create an unordered list of simple citations. Each citation will be a named anchor in html. Let us start with a function that takes a key, and generates the HTML for that entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-bibtex-entry-html</span> (key)
(interactive)

 (<span style="color: #8b0000;">let</span> ((org-ref-bibliography-files (org-ref-find-bibliography))
       (cb (current-buffer))
       (file) (entry))

   (setq file (<span style="color: #8b0000;">catch</span> '<span style="color: #cd0000;">result</span>
                (loop for file in org-ref-bibliography-files do
                      (message <span style="color: #228b22;">"looking for %s in %s"</span> key file)
                      (<span style="color: #8b0000;">if</span> (org-ref-key-in-file-p key (file-truename file)) 
                          (<span style="color: #8b0000;">throw</span> '<span style="color: #cd0000;">result</span> file)
                        (message <span style="color: #228b22;">"%s not found in %s"</span> key (file-truename file))))))
   (set-buffer (find-file-noselect file))
   (<span style="color: #8b0000;">prog1</span> 
       (bibtex-search-entry key nil 0)
     (setq entry (org-ref-bib-citation))
     (set-buffer cb))
    
   (format <span style="color: #228b22;">"&lt;li&gt;&lt;a name=\"#%s\"&gt;[%s] %s&lt;\\a&gt;&lt;li&gt;"</span> key key entry)))

(org-ref-get-bibtex-entry-html <span style="color: #228b22;">"mehta-2014-ident-poten"</span>)
</pre>
</div>

<pre class="example">
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
</pre>

<p>
That looks excellent. Now we simply map that function over the list of keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-html-bibliography</span> ()
(interactive)
(<span style="color: #8b0000;">let</span> ((keys (org-ref-get-bibtex-keys)))
(<span style="color: #8b0000;">when</span> keys
(concat <span style="color: #228b22;">"&lt;h1&gt;Bibliography&lt;/h1&gt;</span>
<span style="color: #228b22;">&lt;ul&gt;"</span>
(mapconcat (<span style="color: #8b0000;">lambda</span> (x) (org-ref-get-bibtex-entry-html x)) keys <span style="color: #228b22;">"\n"</span>)
<span style="color: #228b22;">"\n&lt;/ul&gt;"</span>))))

(org-ref-get-html-bibliography)
</pre>
</div>

<p>
&lt;h1&gt;Bibliography&lt;/h1&gt;
&lt;ul&gt;&lt;li&gt;&lt;a name="#armiento-2014-high"&gt;[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#daza-2014-carbon-dioxid"&gt;[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \&amp; Engineering Chemistry Research, 53:5828-5837 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#suntivich-2014-estim-hybrid"&gt;[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#alesi-2012-evaluat-primar"&gt;[alesi-2012-evaluat-primar] Alesi, W. Richard and Kitchin, John R., "Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture", Industrial \&amp; Engineering Chemistry Research, 51:6907-6915 (2012)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#day-1995-scien-englis"&gt;[day-1995-scien-englis] Robert A. Day, "Scientific English: A Guide for Scientists and Other Profesionals", , : (1995)&lt;\a&gt;&lt;li&gt;
&lt;/ul&gt;
&lt;h1&gt;Bibliography&lt;/h1&gt;
&lt;ul&gt;&lt;li&gt;&lt;a name="#armiento-2014-high"&gt;[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#daza-2014-carbon-dioxid"&gt;[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \&amp; Engineering Chemistry Research, 53:5828-5837 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#suntivich-2014-estim-hybrid"&gt;[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014)&lt;\a&gt;&lt;li&gt;
&lt;/ul&gt;
</p>


<p>
That is basically all we need. The citation links will export as hrefs to these named targets, so they should work fine. All we need to do is modify the blogofile code a bit to use this, and add those functions to org-ref, and we should get a bibliography in our blogposts. 
</p>

<p>
<h1>Bibliography</h1>
<ul><li><a id="armiento-2014-high">[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014). <a href="http://link.aps.org/doi/10.1103/PhysRevB.89.134103">link</a> <a href="http://dx.doi.org/10.1103/PhysRevB.89.134103">doi</a></a></li>
<li><a id="daza-2014-carbon-dioxid">[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \& Engineering Chemistry Research, 53:5828-5837 (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/ie5002185">link</a> <a href="http://dx.doi.org/10.1021/ie5002185">doi</a></a></li>
<li><a id="mehta-2014-ident-poten">[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \& Interfaces, 0:null (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/am4059149">link</a> <a href="http://dx.doi.org/10.1021/am4059149">doi</a></a></li>
<li><a id="suntivich-2014-estim-hybrid">[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/jp410644j">link</a> <a href="http://dx.doi.org/10.1021/jp410644j">doi</a></a></li>
<li><a id="alesi-2012-evaluat-primar">[alesi-2012-evaluat-primar] Alesi, W. Richard and Kitchin, John R., "Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture", Industrial \& Engineering Chemistry Research, 51:6907-6915 (2012). <a href="http://dx.doi.org/10.1021/ie300452c">link</a> <a href="http://dx.doi.org/10.1021/ie300452c">doi</a></a></li>
<li><a id="day-1995-scien-englis">[day-1995-scien-englis] Robert A. Day, "Scientific English: A Guide for Scientists and Other Profesionals", , : (1995). <a href="">link</a> <a href="http://dx.doi.org/">doi</a></a></li>
</ul>
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/17/Exporting-citations-in-html.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Using org-ref for citations and references]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/05/13/Using-org-ref-for-citations-and-references" />
    <id>http://jkitchin.github.io/blog/2014/05/13/Using-org-ref-for-citations-and-references</id>
    <updated>2014-11-15T15:12:50Z</updated>
    <published>2014-05-13T11:25:24Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="emacs" />
    <summary type="html"><![CDATA[Using org-ref for citations and references]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/05/13/Using-org-ref-for-citations-and-references"><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Installation</a></li>
<li><a href="#sec-2">2. Basic usage for citations</a></li>
<li><a href="#sec-3">3. Basic usage for references</a></li>
<li><a href="#sec-4">4. Miscellaneous links</a></li>
<li><a href="#sec-5">5. Customization</a>
<ul>
<li><a href="#sec-5-1">5.1. Default bibliography, pdf directory,</a></li>
<li><a href="#sec-5-2">5.2. New key binding</a></li>
<li><a href="#sec-5-3">5.3. Default link type</a></li>
<li><a href="#sec-5-4">5.4. New citation types</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Summary</a></li>
</ul>
</div>
</div>

<p>
<a href="https://github.com/jkitchin/jmax/blob/master/org/org-ref.org">org-ref</a> is an emacs-lisp module to handle bibliographic citations, and references to figures, tables and sections in org-mode. It was written first for use in org-mode, and for reasonable export to LaTeX. It does not work well for any other export (eg HTML) for now. The goal of org-ref is to make it easy to add citations, and that the citations be useful, clickable links. Below, I illustrate some of those features. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Installation</h2>
<div class="outline-text-2" id="text-1">
<p>
You can get the source here: <a href="https://github.com/jkitchin/jmax/blob/master/org-ref.org">https://github.com/jkitchin/jmax/blob/master/org-ref.org</a> . This is an org-mode file, and you can load it with
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-load-file <span style="color: #228b22;">"org-ref.org"</span>)
</pre>
</div>

<p>
That should be all you need for basic usage.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Basic usage for citations</h2>
<div class="outline-text-2" id="text-2">
<p>
org-ref was written with bibtex in mind. We will discuss customization to use biblatex later.
</p>

<p>
The first thing you should do is add a <i>bibliography</i> link to your document. This link is usually put at the end of the document, where you want the bibliography to be printed in a LaTeX export. Use the filename of the bibliography with its extension in the link, and you can use multiple files if they are separated by commas. The bibliography link is clickable, and it will open the bibliography that you clicked on. Depending on the LaTeX class you are exporting to, you may also need to set a bibliographystyle.
</p>

<p>
Out of the box, org-ref binds the key "C-c ]" to insert a citation. That key runs the command org-ref-insert-cite-link, which will prompt you for a regular expression to search your bibliographies for. The search is done using reftex, so you can mark several entries at once, and they will be added as a citation link. The actual kind of link used is dependent on the value of org-ref-default-citation-link, which defaults to cite. 
</p>

<p>
If your cursor is on a citation link, or at the end of the link, you can run the command again to append new citations to the link. The new entries are separated by commas. The links are clickable, and when you click on them you will see a message in the minibuffer with the citation, and options to open the entry, open a pdf (if you have it), open the url (if the entry has one), or to open notes about the entry. You get this menu for the entry that you clicked on. 
</p>

<p>
If you want a different type of citation, type C-u C-c ]. You will be prompted for a format, and you can choose a different type of link format. Most bibtex formats are supported, and some biblatex formats are supported.
</p>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Basic usage for references</h2>
<div class="outline-text-2" id="text-3">
<p>
The other use of org-ref is for references to labels in your document. You can put labels in figure and table captions, and then reference them in your document. The label link is clickable, and when you click on it there will be a message in the minibuffer telling you how many labels of that name were found (it should be one).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> An uninteresting table. (<label>tab-boring</label>)</caption>

<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">0</td>
<td class="right">3</td>
</tr>

<tr>
<td class="right">4</td>
<td class="right">7</td>
</tr>
</tbody>
</table>

<p>
You can then refer to Table (<ref>tab-boring</ref>). The ref links are also clickable, and they take you to the spot where the label is defined. You can enter ref links with completion. Press C-c C-l, type ref, press enter, and then press tab. You will get a list of the labels defined in the buffer you can choose from. There are many things you can make a ref to including a tblname, a label link, an explicit \label{}, and an org-mode #+label: line. (<ref>tab-boring</ref>)
</p>

<p>
There is an eqref link that is used for equations. You must use LaTeX labels in the equation for this.
</p>

<p>
\[e^x = 4 \label{eq-exp} \]
</p>

<p>
You can see in (<eqref>eq-exp</eqref>) the problem to solve.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Miscellaneous links</h2>
<div class="outline-text-2" id="text-4">
<p>
There are two link types for generating a LateX list of tables and list of figures. These links are clickable, and they open a temporary buffer with a list of the tables or figures that you can click on. They export to \listoftables and \listoffigures
</p>

<p>

</p>

<p>

</p>

<p>
You can run these as commands, <a href="org-ref-list-of-tables">org-ref-list-of-tables</a> and <a href="org-ref-list-of-figures">org-ref-list-of-figures</a> if you do not want a list of those things in your exported document.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Customization</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Default bibliography, pdf directory,</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This is an optional configuration, but it is handy to define a default bibliography so that you can add citations to an org-file without defining a bibliography link. I store all pdfs of bibtex entries in the directory defined by org-ref-pdf-directory, and by the name of the bibtex entry label. This enables org-ref to open the pdf if it can find it. The notes file is optional, I create org-entries for each bibtex entry, which I have experimented with various ways of organizing them with tags, and in topical headings.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-ref-bibliography-notes <span style="color: #228b22;">"~/Dropbox/bibliography/notes.org"</span>
      org-ref-default-bibliography '(<span style="color: #228b22;">"~/Dropbox/bibliography/references.bib"</span>)
      org-ref-pdf-directory <span style="color: #228b22;">"~/Dropbox/bibliography/bibtex-pdfs/"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> New key binding</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The default key binding to insert a citation is C-c ]. I chose that because I do not like pressing shift to get ). However, this key binding usurps an org-mode agenda file command. To change this, set this variable
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-ref-insert-cite-key <span style="color: #228b22;">"C-c )"</span>)
</pre>
</div>

<ul class="org-ul">
<li>You may have to restart emacs to get C-c ] back.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Default link type</h3>
<div class="outline-text-3" id="text-5-3">
<p>
If you use another citation type alot, you may change the default link type. For example, you may prefer autocite links by default. Just set it like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-ref-default-citation-link <span style="color: #228b22;">"autocite"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> New citation types</h3>
<div class="outline-text-3" id="text-5-4">
<p>
There are so many citation types between bibtex and biblatex. I did not try to add them all. You can add new citation links yourself in your init file. Here, we add a new cite link called citez, and assign a reftex menu key of z to it. This function automatically adds the new link to org-mode, with the citation menu functionality, creates the completion function, and adds the citation to the list of known types.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-ref-define-citation-link <span style="color: #228b22;">"citez"</span> ?z)
</pre>
</div>

<p>
(org-ref-define-citation-link "citeauthorfull" ?F)  citeauthorfull:hautier-2012-accur
</p>

<p>
<a href="#hautier-2012-accur">hautier-2012-accur</a>
</p>


<p>
It is assumed that this will be exported as \citez[optional stuff]{label}. If you need more flexibility than that, you will have to define everything manually.
</p>

<p>
For example, the original cite link was defined like this.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-cite-link-format</span> (keyword desc format)
   (<span style="color: #8b0000;">cond</span>
    ((eq format 'html) (format <span style="color: #228b22;">"(&lt;cite&gt;%s&lt;/cite&gt;)"</span> path))
    ((eq format 'latex)
     (concat <span style="color: #228b22;">"\\cite"</span> (<span style="color: #8b0000;">when</span> desc (format <span style="color: #228b22;">"[%s]"</span> desc)) <span style="color: #228b22;">"{"</span>
             (mapconcat (<span style="color: #8b0000;">lambda</span> (key) key) (org-ref-split-and-strip-string keyword) <span style="color: #228b22;">","</span>)
             <span style="color: #228b22;">"}"</span>))))

(org-add-link-type
 <span style="color: #228b22;">"cite"</span>
 'org-ref-cite-onclick-minibuffer-menu ;; <span style="color: #ff0000; font-weight: bold;">clicking function</span>
 'org-ref-cite-link-format) ;; <span style="color: #ff0000; font-weight: bold;">formatting function</span>
</pre>
</div>

<p>
You should also add your new citation type to the list of org-ref-cite-types.
</p>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Summary</h2>
<div class="outline-text-2" id="text-6">
<p>
This covers most of the basic org-ref functionality. There are also several utility functions for interacting with org-buffers and bibtex files that will be described later.
</p>

<p>
See <a href="http://screencast.com/t/bxfafVydE">http://screencast.com/t/bxfafVydE</a> for a screencast of using org-ref.
</p>


<p>
<a href="http://screencast.com/t/bxfafVydE">http://screencast.com/t/bxfafVydE</a> 
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/13/Using-org-ref-for-citations-and-references.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>]]></content>
  </entry>
  <entry>
    <author>
      <name></name>
      <uri>http://jkitchin.github.io/blog</uri>
    </author>
    <title type="html"><![CDATA[Finding missing citation entries in an org-file]]></title>
    <link rel="alternate" type="text/html" href="http://jkitchin.github.io/blog/2014/04/29/Finding-missing-citation-entries-in-an-org-file" />
    <id>http://jkitchin.github.io/blog/2014/04/29/Finding-missing-citation-entries-in-an-org-file</id>
    <updated>2014-04-29T10:37:51Z</updated>
    <published>2014-04-29T10:37:51Z</published>
    <category scheme="http://jkitchin.github.io/blog" term="org-mode" />
    <category scheme="http://jkitchin.github.io/blog" term="bibtex" />
    <summary type="html"><![CDATA[Finding missing citation entries in an org-file]]></summary>
    <content type="html" xml:base="http://jkitchin.github.io/blog/2014/04/29/Finding-missing-citation-entries-in-an-org-file"><![CDATA[



<p>
Today we consider how to find citations in a document that have no corresponding entries in a bibtex file. There are a couple of pieces to this which we work out in stages below. First, we specify the bibtex file using a bibliography link defined in jorg-bib.el. 
</p>


<p>

</p>

<p>
jorg-bib provides a function that gives us the relevant bibliography files found in this file.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(cite-find-bibliography)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">bib1.bib</td>
<td class="left">bib2.bib</td>
</tr>
</tbody>
</table>

<p>
We can get a list of keys in these files 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((bibtex-files (cite-find-bibliography)))
(bibtex-global-key-alist))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">(adams-1993-orien-imagin . t)</td>
<td class="left">(aarik-1997-effec-tio2 . t)</td>
<td class="left">(aruga-1985-struc-iron . t)</td>
</tr>
</tbody>
</table>


<p>
Now, here are some citations that we want to include in this document.
</p>

<p>
<pre>cite:aruga-1985-struc-iron,aarik-1997-effec-tio2</pre> 
</p>

<p>
Here is a citation that is not in the bibtex file <pre>cite:kitchin-2016-nobel-lecture</pre> 
</p>


<p>
To find out if any of these are missing, we need a list of the citation keys in this document. We first get all the content from the cite links.  We parse the buffer, and for each cite link, we get the path of the link, which contains our keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((parsetree (org-element-parse-buffer)))
  (org-element-map parsetree 'link
    (lambda (link)       
      (let ((type (nth 0 link))
            (plist (nth 1 link))
            (content (nth 2 link)))
	(when (equal (plist-get plist ':type) "cite")
	  (plist-get plist ':path))))))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">aruga-1985-struc-iron,aarik-1997-effec-tio2</td>
<td class="left">kitchin-2016-nobel-lecture</td>
</tr>
</tbody>
</table>

<p>
That is almost what we need, but we need to separate the keys that are joined by commas. That function already exists in jorg-bib as cite-split-keys. We need to make a slight variation to get a list of all the entries, since the cite-split-keys returns a list of entries for each link. Here is on approach to that.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(let ((parsetree (org-element-parse-buffer))
      (results '()))
  (org-element-map parsetree 'link
    (lambda (link)       
      (let ((plist (nth 1 link)))
	(when (equal (plist-get plist ':type) "cite")
	  (setq results (append results (cite-split-keys (plist-get plist ':path))))))))
results)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">aruga-1985-struc-iron</td>
<td class="left">aarik-1997-effec-tio2</td>
<td class="left">kitchin-2016-nobel-lecture</td>
</tr>
</tbody>
</table>

<p>
Ok, now we just need to check each entry of that list against the list of entries in the bibtex files, and highlight any that are not good. We use an index function below to tell us if an element is in a list. This index function works for strings. We use the strange remove-if-not function, which requires something like triple negative logic to get the list of keys that are not in the bibtex files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(require 'cl)

(defun index (substring list)
  "return the index of string in a list of strings"
  (let ((i 0)
	(found nil))
    (dolist (arg list i)
      (if (string-match substring arg)
	  (progn 
	    (setq found t)
	    (return i)))
      (setq i (+ i 1)))
    ;; return counter if found, otherwise return nil
    (if found i nil)))

;; generate the list of bibtex-keys and cited keys
(let* ((bibtex-files (cite-find-bibliography))
       (bibtex-keys (mapcar (lambda (x) (car x)) (bibtex-global-key-alist)))
       (parsetree (org-element-parse-buffer))
       (cited-keys))
  (org-element-map parsetree 'link
    (lambda (link)       
      (let ((plist (nth 1 link)))			     
	(when (equal (plist-get plist ':type) "cite")
	  (setq cited-keys (append cited-keys (cite-split-keys (plist-get plist ':path))))))))

(princ (remove-if-not (lambda (arg) (not (index arg bibtex-keys))) cited-keys))
)
</pre>
</div>

<pre class="example">
(kitchin-2016-nobel-lecture)
</pre>


<p>
The only improvement from here would be if this generated a temporary buffer with clickable links to find that bad entry! Let us take a different approach here, and print this to a temporary buffer of clickable links. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(require 'cl)

(defun index (substring list)
  "return the index of string in a list of strings"
  (let ((i 0)
	(found nil))
    (dolist (arg list i)
      (if (string-match substring arg)
	  (progn 
	    (setq found t)
	    (return i)))
      (setq i (+ i 1)))
    ;; return counter if found, otherwise return nil
    (if found i nil)))

;; generate the list of bibtex-keys and cited keys
(let* ((bibtex-files (cite-find-bibliography))
       (bibtex-keys (mapcar (lambda (x) (car x)) (bibtex-global-key-alist)))
       (bad-citations '()))

  (org-element-map (org-element-parse-buffer) 'link
    (lambda (link)       
      (let ((plist (nth 1 link)))			     
	(when (equal (plist-get plist ':type) "cite")
	  (dolist (key (cite-split-keys (plist-get plist ':path)) )
	    (when (not (index key bibtex-keys))
	      (setq bad-citations (append bad-citations
			    `(,(format "%s [[elisp:(progn (find-file \"%s\")(goto-char %s))][not found here]]\n"
		      key (buffer-file-name)(plist-get plist ':begin)))))
			    ))))))

(mapconcat 'identity bad-citations ""))
</pre>
</div>

<p>
kitchin-2016-nobel-lecture <pre>elisp:(progn (find-file "/home-research/jkitchin/Dropbox/blogofile-jkitchin.github.com/_blog/blog.org")(goto-char 1052))</pre> 
</p>

<p>
That is likely to come in handy. I have put a variation of this code in jorb-bib, in the function called jorg-bib-find-bad-citations.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/04/29/Finding-missing-citation-entries-in-an-org-file.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>
]]></content>
  </entry>
</feed>
