* An exporter for org to docx via pandoc

The idea here is to write a function that converts your org document to a word document using pandoc. There is not much we need to do, but we would like to convert citations to the format used by pandoc.

#+BEGIN_SRC emacs-lisp
(defun pandoc-cite-format (link contents info)
  (let ((type (org-element-property :type link))
	(path (org-element-property :path link)))
    (cond
     ((string= type "cite")
      (format "[%s]"
	      (mapconcat
	       (lambda (x) (concat "@" x))
	       (split-string path ",")
	       "; ")
	      ))
     ;; anything else, we just do the regular thing
     (t
      (org-html-link link contents info)))))

(org-export-define-derived-backend 'pandoc-docx 'org
  :translate-alist '((link . pandoc-cite-format)))
#+END_SRC


Here are some references to test cite:needs-1989-calcul. And a multiple reference.

cite:jarvi-2008-devel-reaxf,zhou-2004-first-lda-u,curnan-2014-effec-concen

This will export our file with converted links.
#+BEGIN_SRC emacs-lisp
(org-export-to-file (org-export-define-derived-backend 'pandoc-docx 'org
  :translate-alist '((link . pandoc-cite-format))) "some-filename.org")
#+END_SRC(defun my-link-format (link contents info)

Now the pandoc command looks like:
#+BEGIN_SRC sh
pandoc -s -S --biblio=../../Dropbox/bibliography/references.bib org-to-word.org -o org-to-word.docx
#+END_SRC

So, we need to get the bibliography file from the org file.

(expand-file-name (car (org-ref-find-bibliography)))

#+BEGIN_SRC emacs-lisp
(shell-command "rm some-filename.docx")
(find-file (org-export-to-file 'pandoc-docx "some-filename.org"))
(shell-command (format "pandoc -s -S --biblio=%s %s -o %s"
		       (expand-file-name (car (org-ref-find-bibliography)))
		       (buffer-file-name)
		       (replace-regexp-in-string "\\.org" ".docx" (buffer-file-name))))
(shell-command (format "open %s" (replace-regexp-in-string "\\.org" ".docx" (buffer-file-name))))
#+END_SRC

#+RESULTS:
: 1

[[./some-filename.docx]]

bibliography:org-to-docx-export.bib


*  Bibtex entries			:noexport:

#+BEGIN_SRC text :tangle org-to-docx-export.bib
@article{curnan-2014-effec-concen,
  author =       {Curnan, Matthew T. and Kitchin, John R.},
  title =        {Effects of Concentration, Crystal Structure,
                  Magnetism, and Electronic Structure Method on
                  First-Principles Oxygen Vacancy Formation Energy
                  Trends in Perovskites},
  journal =      {The Journal of Physical Chemistry C},
  volume =       118,
  number =       49,
  pages =        {28776-28790},
  year =         2014,
  doi =          {10.1021/jp507957n},
  url =          {http://dx.doi.org/10.1021/jp507957n},
  eprint =       { http://dx.doi.org/10.1021/jp507957n },
}

@article{zhou-2004-first-lda-u,
  author =	 {F. Zhou and M. Cococcioni and C. Marianetti and D. Morgan and
                  G. Ceder},
  title =	 {First-Principles Prediction of Redox Potentials in
                  Transition-Metal Compounds With Lda+u},
  journal =	 {Physical Review B},
  volume =	 70,
  number =	 23,
  pages =	 {nil},
  year =	 2004,
  doi =		 {10.1103/physrevb.70.235121},
  url =		 {http://dx.doi.org/10.1103/PhysRevB.70.235121},
}

@article{jarvi-2008-devel-reaxf,
  author =	 {T. T. J{\"a}rvi and A. Kuronen and M. Hakala and K. Nordlund and
                  A. C. T. van Duin and W. A. Goddard and T. Jacob},
  title =	 {Development of a Reaxff Description for Gold},
  journal =	 {The European Physical Journal B},
  year =	 {2008},
  volume =	 {66},
  number =	 {1},
  pages =	 {75-79},
  doi =		 {10.1140/epjb/e2008-00378-3},
  url =		 {http://dx.doi.org/10.1140/epjb/e2008-00378-3},
}

@article{needs-1989-calcul,
  author =	 {R. J. Needs and M. Mansfield},
  title =	 {Calculations of the Surface Stress Tensor and Surface Energy
                  of the (111) Surfaces of Iridium, Platinum and Gold},
  journal =	 {Journal of Physics: Condensed Matter},
  volume =	 1,
  number =	 41,
  pages =	 {7555-7563},
  year =	 1989,
  doi =		 {10.1088/0953-8984/1/41/006},
  url =		 {http://dx.doi.org/10.1088/0953-8984/1/41/006},
}
#+END_SRC
