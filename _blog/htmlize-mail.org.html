<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.47 in css mode. -->
<html>
  <head>
    <title>htmlize-mail.org</title>
    <style type="text/css">
    <!--
      body {
        color: #333333;
        background-color: #FFFFFF;
      }
      .ATTRLIST {
      }
      .ATTRLIST-1 {
      }
      .ATTRLIST-2 {
      }
      .ATTRLIST-3 {
      }
      .flyspell-incorrect {
        /* flyspell-incorrect */
        text-decoration: underline;
      }
      .highlight {
        /* highlight */
        background-color: #FFF876;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #555555;
        background-color: #E2E1D5;
        text-decoration: underline;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #555555;
        background-color: #E2E1D5;
        text-decoration: overline;
      }
      .org-code {
        /* org-code */
        color: #006400;
        background-color: #FDFFF7;
      }
      .org-latex-and-related {
        /* org-latex-and-related */
        color: #0000ff;
        background-color: #ffffff;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #3C3C3C;
        background-color: #F0F0F0;
        font-size: 130%;
        font-weight: bold;
        text-decoration: overline;
      }
      .org-link {
        /* org-link */
        color: #006DAF;
        text-decoration: underline;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #008ED1;
        background-color: #EAEAFF;
      }
      .org-table {
        /* org-table */
        color: #006400;
        background-color: #EAFFEA;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
;; This buffer is for text that is not saved, and for Lisp evaluation.
;; To create a file, visit it with C-x C-f and enter text in its buffer.

{<span class="flyspell-incorrect">googoolg</span>}

<span class="org-level-1">* Test</span>

<span class="org-table">| a | b | c |</span>
<span class="org-table">| 4 | 5 | 6 |</span>

An equation <img src="ltxpng/htmlize-mail_602c4147af78abc9245028abc638c8417a1a6bf0.png" alt="\(e^{i\pi} + 1 = 0\)" />

(require 'org-mime)

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="ATTRLIST-3">(</span><span class="ATTRLIST-2">defun</span><span class="ATTRLIST-3"> </span><span class="ATTRLIST-1">org-mime-send-subtree-org-html</span><span class="ATTRLIST-3"> ()
  (</span><span class="ATTRLIST-2">interactive</span><span class="ATTRLIST-3">)
  (</span><span class="ATTRLIST-2">save-restriction</span><span class="ATTRLIST-3">
    (org-narrow-to-subtree) 
    (</span><span class="ATTRLIST-2">let*</span><span class="ATTRLIST-3"> ((mp (</span><span class="ATTRLIST-2">lambda</span><span class="ATTRLIST-3"> (p) (org-entry-get nil p org-mime-use-property-inheritance)))
           (file (buffer-file-name (current-buffer)))
           (subject (</span><span class="ATTRLIST-2">or</span><span class="ATTRLIST-3"> (funcall mp </span><span class="ATTRLIST">"MAIL_SUBJECT"</span><span class="ATTRLIST-3">) (nth 4 (org-heading-components))))
           (to (funcall mp </span><span class="ATTRLIST">"MAIL_TO"</span><span class="ATTRLIST-3">))
           (cc (funcall mp </span><span class="ATTRLIST">"MAIL_CC"</span><span class="ATTRLIST-3">))
           (bcc (funcall mp </span><span class="ATTRLIST">"MAIL_BCC"</span><span class="ATTRLIST-3">))
           (body (buffer-substring
                  (</span><span class="ATTRLIST-2">save-excursion</span><span class="ATTRLIST-3"> (goto-char (point-min))
                                  (forward-line 1)
                                  (</span><span class="ATTRLIST-2">when</span><span class="ATTRLIST-3"> (looking-at </span><span class="ATTRLIST">"[ \t]*:PROPERTIES:"</span><span class="ATTRLIST-3">)
                                    (re-search-forward </span><span class="ATTRLIST">":END:"</span><span class="ATTRLIST-3"> nil)
                                    (forward-char))
                                  (point))
                  (point-max)))
           (html (</span><span class="ATTRLIST-2">with-current-buffer</span><span class="ATTRLIST-3"> (htmlize-buffer) (buffer-string)))
           (html-and-images (org-mime-replace-images html))
           (images (cdr html-and-images)))

      (compose-mail to subject `((cc . ,cc) (bcc . ,bcc)))
      (message-goto-body)

      (insert (org-mime-multipart
               body
               html)
              (mapconcat 'identity images </span><span class="ATTRLIST">"\n"</span><span class="ATTRLIST-3">))
      (message-goto-to))))
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-meta-line">#+RESULTS:</span>
<span class="org-code">: org-mime-send-subtree-org-html
</span>
<span class="org-link"><a href="elisp:org-mime-send-subtree-org-html">elisp:org-mime-send-subtree-org-html</a></span>
</pre>
  </body>
</html>
