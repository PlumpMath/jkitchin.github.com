(defvar ovh-current-deletion nil
 "The current deleted selection. (beg end)"
(defun ovh-before-change (beg end)
  (unless (or undo-in-progress
              (and (= beg (point-min)) (= end (point-max)))) ; this happens on buffer switches
    (if (= beg end)					     ; addition
	(message "Inserting")
      ;; when the deletion was done with backspace, point is at end.
      (message "deleting %s" (list (buffer-substring beg end) (= (point) end))))))

(defun ovh-after-change (beg end length)
  (unless (or undo-in-progress
              (not ovh-current-deletion))
    (message "deleted %s" ovh-current-deletion)
    (insert (propertize (car ovh-current-deletion) ))
    (setq ovh-current-deletion nil)))


(add-to-list 'before-change-functions 'ovh-before-change t)
(add-to-list 'after-change-functions 'ovh-after-change)
