
* selective view of org-elements
  :PROPERTIES:
  :VISIBILITY: all
  :END:

Show only verse
#+BEGIN_SRC emacs-lisp

(flatten '(0 (1 2) (3 4) 5))
#+END_SRC

#+RESULTS:
| 0 | 1 | 2 | 3 | 4 | 5 |

#+BEGIN_SRC emacs-lisp
; http://stackoverflow.com/questions/969067/name-of-this-function-in-built-in-emacs-lisp-library
(defun flatten (LIST)
  "flattens LIST"
  (cond
   ((atom LIST) (list LIST))
   ((null (cdr LIST)) (flatten (car LIST)))
   (t (append (flatten (car LIST)) (flatten (cdr LIST))))))

(defun view-verse ()
  "Hide everything but the verse blocks."
  (interactive)
  (org-cycle '(64))
  (let ((p (append
	    (list (point-min))
	    (flatten (org-element-map (org-element-parse-buffer) 'verse-block
			(lambda (vb) (list (org-element-property :begin vb)
					   (org-element-property :end vb)))))
	    (list (point-max)))))

    (add-to-invisibility-spec 'not-verse-block)
    (loop for start in p by 'cddr
	  for end in (cdr p) by 'cddr
	  do (overlay-put (make-overlay start end) 'invisible 'not-verse-block))))

(defun unhide ()
  (interactive)
  (remove-from-invisibility-spec 'not-verse-block)
  (ov-clear 'invisibility 'not-verse-block))
#+END_SRC

#+RESULTS:
: unhide


#+BEGIN_SRC emacs-lisp
(remove-from-invisibility-spec '(not-verse-block))
#+END_SRC

#+RESULTS:
| (org-babel-hide-hash . t) | (org-babel-hide-hash . t) | (org-babel-hide-hash . t) | (org-babel-hide-hash . t) | (org-babel-hide-hash . t) | (org-babel-hide-hash . t) | (org-babel-hide-result . t) | (org-hide-block . t) | (org-cwidth) | (org-link) | (outline . t) | t |



** SCENE II

description, dialogue, etc. description, dialogue, etc. description,
dialogue, etc. description, dialogue, etc. description, dialogue, etc.

#+NAME: song-name
#+BEGIN_VERSE
 la la la
 la la la

(remove-from-invisibility-spec 'not-verse-block)
  (ov-clear 'invisibility 'not-verse-block)
#+END_VERSE

#+NAME: song-name-melody
#+BEGIN_SRC lilypond :file song-name-melody.pdf
<< {
  /key d /major
  /time 3/4
  a4 a a |
  a4 a a |
 }

/addlyrics {
la la la |
la la la |
 }
>>
#+END_SRC

more description, dialogue, etc. description, dialogue, etc.
dialogue, etc. description, dialogue, etc. description, dialogue.

** SCENE III
etc.

#+NAME: song-name-2
#+BEGIN_VERSE
 tra la la
 tra la la
#+END_VERSE


Then end.
