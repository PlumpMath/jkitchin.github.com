---
title: Vectorized piecewise functions
date: 2013/02/23 09:00:00
updated: 2013/02/27 14:51:57
categories: math
tags: ''
---


<p>
<a href="http://matlab.cheme.cmu.edu/2011/11/05/vectorized-piecewise-functions/" >Matlab post</a>
Occasionally we need to define piecewise functions, e.g.
</p>

\begin{eqnarray}
f(x) &=&  0, x < 0 \\ 
     &=&  x, 0 <= x < 1\\ 
     &=&  2 - x, 1 < x <= 2\\ 
     &=&  0, x > 2 
\end{eqnarray} 

<p>
Today we examine a few ways to define a function like this. A simple way is to use conditional statements.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f1</span>(x):
    <span style="color: #8b0000;">if</span> x &lt; 0:
        <span style="color: #8b0000;">return</span> 0
    <span style="color: #8b0000;">elif</span> (x &gt;= 0) &amp; (x &lt; 1):
        <span style="color: #8b0000;">return</span> x
    <span style="color: #8b0000;">elif</span> (x &gt;= 1) &amp; (x &lt; 2):
        <span style="color: #8b0000;">return</span> 2.0 - x
    <span style="color: #8b0000;">else:</span>
        <span style="color: #8b0000;">return</span> 0

<span style="color: #8b0000;">print</span> f1(-1)
<span style="color: #8b0000;">print</span> f1([0, 1, 2, 3])  <span style="color: #ff0000; font-weight: bold;"># does not work!</span>
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... &gt;&gt;&gt; 0
0
</pre>

<p>
This works, but the function is not vectorized, i.e. f([-1 0 2 3]) does not evaluate properly (it should give a list or array). You can get vectorized behavior by using list comprehension, or by writing your own loop. This does not fix all limitations, for example you cannot use the f1 function in the quad function to integrate it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

x = np.linspace(-1, 3)
y = [f1(xx) <span style="color: #8b0000;">for</span> xx <span style="color: #8b0000;">in</span> x]

plt.plot(x, y)
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x048D6790&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise.png"><p>

<p>
Neither of those methods is convenient. It would be nicer if the function was vectorized, which would allow the direct notation f1([0, 1, 2, 3, 4]). A simple way to achieve this is through the use of logical arrays. We create logical arrays from comparison statements.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f2</span>(x):
    <span style="color: #228b22;">'fully vectorized version'</span>
    x = np.asarray(x)
    y = np.zeros(x.shape)
    y += ((x &gt;= 0) &amp; (x &lt; 1)) * x
    y += ((x &gt;= 1) &amp; (x &lt; 2)) * (2 - x)
    <span style="color: #8b0000;">return</span> y

<span style="color: #8b0000;">print</span> f2([-1, 0, 1, 2, 3, 4])
x = np.linspace(-1,3);
plt.plot(x,f2(x))
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise-2.png'</span>)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... &gt;&gt;&gt; [ 0.  0.  1.  0.  0.  0.]
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043A4910&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise-2.png"><p>

<p>
A third approach is to use Heaviside functions. The Heaviside function is defined to be zero for x less than some value, and 0.5 for x=0, and 1 for x &gt;= 0. If you can live with y=0.5 for x=0, you can define a vectorized function in terms of Heaviside functions like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">heaviside</span>(x):
    x = np.array(x)
    <span style="color: #8b0000;">if</span> x.shape != ():
        y = np.zeros(x.shape)
        y[x &gt; 0.0] = 1
        y[x == 0.0] = 0.5
    <span style="color: #8b0000;">else:</span> <span style="color: #ff0000; font-weight: bold;"># special case for 0d array (a number)</span>
        <span style="color: #8b0000;">if</span> x &gt; 0: y = 1
        <span style="color: #8b0000;">elif</span> x == 0: y = 0.5
        <span style="color: #8b0000;">else:</span> y = 0
    <span style="color: #8b0000;">return</span> y

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f3</span>(x):
    x = np.array(x)
    y1 = (heaviside(x) - heaviside(x - 1)) * x <span style="color: #ff0000; font-weight: bold;"># first interval</span>
    y2 = (heaviside(x - 1) - heaviside(x - 2)) * (2 - x) <span style="color: #ff0000; font-weight: bold;"># second interval</span>
    <span style="color: #8b0000;">return</span> y1 + y2

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad
<span style="color: #8b0000;">print</span> quad(f3, -1, 3)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... ... ... &gt;&gt;&gt; ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; (1.0, 1.1102230246251565e-14)
</pre>

<div class="org-src-container">

<pre class="src src-python">plt.plot(x, f3(x))
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise-3.png'</span>)
</pre>
</div>

<pre class="example">
[&lt;matplotlib.lines.Line2D object at 0x048F96F0&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise-3.png"><p>

<p>
There are many ways to define piecewise functions, and vectorization is not always necessary. The advantages of vectorization are usually notational simplicity and speed; loops in python are usually very slow compared to vectorized functions.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/23/Vectorized-piecewise-functions.org">org-mode source</a><p>