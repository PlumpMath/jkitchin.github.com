---
title: Linear least squares fitting with linear algebra
date: 2013/02/18 09:00:00
updated: 2013/02/27 14:38:52
categories: data analysis, linear algebra
tags: ''
---


<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/24/linear-least-squares-fitting-with-linear-algebra/" >Matlab post</a>
</p>

<p>
The idea here is to formulate a set of linear equations that is easy to solve. We  can express the equations in terms of our unknown fitting parameters \(p_i\) as:
</p>

<pre class="example">
x1^0*p0 + x1*p1 = y1
x2^0*p0 + x2*p1 = y2
x3^0*p0 + x3*p1 = y3
etc...
</pre>

<p>
Which we write in matrix form as \(A p = y\) where \(A\) is a matrix of column vectors, e.g. [1, x_i]. \(A\) is not a square matrix, so we cannot solve it as written. Instead, we form \(A^T A p = A^T y\) and solve that set of equations.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
x = np.array([0, 0.5, 1, 1.5, 2.0, 3.0, 4.0, 6.0, 10])
y = np.array([0, -0.157, -0.315, -0.472, -0.629, -0.942, -1.255, -1.884, -3.147])

A = np.column_stack([x**0, x])

M = np.dot(A.T, A)
b = np.dot(A.T, y)

i1, slope1 = np.dot(np.linalg.inv(M), b)
i2, slope2 = np.linalg.solve(M, b) <span style="color: #ff0000; font-weight: bold;"># an alternative approach.</span>

<span style="color: #8b0000;">print</span> i1, slope1
<span style="color: #8b0000;">print</span> i2, slope2

<span style="color: #ff0000; font-weight: bold;"># plot data and fit</span>
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot(x, y, <span style="color: #228b22;">'bo'</span>)
plt.plot(x, np.dot(A, [i1, slope1]), <span style="color: #228b22;">'r--'</span>)
plt.xlabel(<span style="color: #228b22;">'x'</span>)
plt.ylabel(<span style="color: #228b22;">'y'</span>)
plt.savefig(<span style="color: #228b22;">'images/la-line-fit.png'</span>)
</pre>
</div>

<pre class="example">
0.00062457337884 -0.3145221843
0.00062457337884 -0.3145221843
</pre>

<p><img src="/img/./images/la-line-fit.png"><p>

<p>
This method can be readily extended to fitting any polynomial model, or other linear model that is fit in a least squares sense. This method does not provide confidence intervals.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Linear-least-squares-fitting-with-linear-algebra.org">org-mode source</a><p>