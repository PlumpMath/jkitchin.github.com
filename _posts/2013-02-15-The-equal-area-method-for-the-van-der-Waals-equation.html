---
title: The equal area method for the van der Waals equation
date: 2013/02/15 09:00:00
updated: 2013/09/25 09:13:03
categories: plotting
tags: Thermodynamics
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Compute areas</a></li>
</ul>
</div>
</div>
<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/11/the-equal-area-method-for-the-van-der-waals-equation/">Matlab post</a> 
</p>

<p>
When a gas is below its Tc the van der Waal equation oscillates. In the portion of the isotherm where \(\partial P_R/\partial V_r > 0\), the isotherm fails to describe real materials, which phase separate into a liquid and gas in this region.
</p>

<p>
Maxwell proposed to replace this region by a flat line, where the area above and below the curves are equal. Today, we examine how to identify where that line should be.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b008b;">Tr</span> = 0.9 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">A Tr below Tc:  Tr = T/Tc</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">analytical equation for Pr. This is the reduced form of the van der Waal</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">equation.</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">Prfh</span>(Vr):
    <span style="color: #8b0000;">return</span>  8.0 / 3.0 * Tr / (Vr - 1.0 / 3.0) - 3.0 / (Vr**2)

<span style="color: #8b008b;">Vr</span> = np.linspace(0.5, 4, 100)  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced volume</span>
<span style="color: #8b008b;">Pr</span> = Prfh(Vr)                 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced pressure</span>

plt.plot(Vr,Pr)
plt.ylim([0, 2])
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDAF0&gt;]
(0, 2)
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-1.png"><p>
</p>
</div>

<p>
The idea is to pick a Pr and draw a line through the EOS. We want the areas between the line and EOS to be equal on each side of the middle intersection. Let us draw a line on the figure at y = 0.65.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">y</span> = 0.65

plt.plot([0.5, 4.0], [y, y], <span style="color: #228b22;">'k--'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDCD0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-2.png"><p>
</p>
</div>

<p>
To find the areas, we need to know where the intersection of the vdW eqn with the horizontal line. This is the same as asking what are the roots of the vdW equation at that Pr. We need all three intersections so we can integrate from the first root to the middle root, and then the middle root to the third root. We take advantage of the polynomial nature of the vdW equation, which allows us to use the roots command to get all the roots at once. The polynomial is \(V_R^3 - \frac{1}{3}(1+8 T_R/P_R) + 3/P_R - 1/P_R = 0\). We use the coefficients t0 get the roots like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">vdWp</span> = [1.0, -1. / 3.0 * (1.0 + 8.0 * Tr / y), 3.0 / y, - 1.0 / y]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()
<span style="color: #8b0000;">print</span> v

plt.plot(v[0], y, <span style="color: #228b22;">'bo'</span>, v[1], y, <span style="color: #228b22;">'bo'</span>, v[2], y, <span style="color: #228b22;">'bo'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-3.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [ 0.60286812  1.09743234  2.32534056]
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x0439C570&gt;, &lt;matplotlib.lines.Line2D object at 0x043933B0&gt;, &lt;matplotlib.lines.Line2D object at 0x04393CB0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-3.png"><p>
</p>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Compute areas</h2>
<div class="outline-text-2" id="text-1">
<p>
for A1, we need the area under the line minus the area under the vdW curve. That is the area between the curves. For A2, we want the area under the vdW curve minus the area under the line. The area under the line between root 2 and root 1 is just the width (root2 - root1)*y
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1])* y 

<span style="color: #8b0000;">print</span> A1, A2
<span style="color: #8b0000;">print</span> e1, e2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">interesting these look so large</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.063225945606 0.0580212098122
0.321466743765 -0.798140339268
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">equal_area</span>(y):
    <span style="color: #8b008b;">Tr</span> = 0.9
    <span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y), 3.0 / y,  -1.0 / y]
    <span style="color: #8b008b;">v</span> = np.roots(vdWp)
    v.sort()
    <span style="color: #8b008b;">A1</span> = (v[1] - v[0]) * y - quad(Prfh, v[0], v[1])
    <span style="color: #8b008b;">A2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y
    <span style="color: #8b0000;">return</span>  A1 - A2

y_eq, = fsolve(equal_area, 0.65)
<span style="color: #8b0000;">print</span> y_eq

<span style="color: #8b008b;">Tr</span> = 0.9
<span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y_eq), 3.0 / y_eq,  -1.0 / y_eq]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y_eq - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y_eq

<span style="color: #8b0000;">print</span> A1, A2
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; 0.646998351872
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.0617526473994 0.0617526473994
</pre>

<p>
Now let us plot the equal areas and indicate them by shading.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">fig</span> = plt.gcf()
<span style="color: #8b008b;">ax</span> = fig.add_subplot(111)

ax.plot(Vr,Pr)

<span style="color: #8b008b;">hline</span> = np.ones(Vr.size) * y_eq

ax.plot(Vr, hline)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[0]) &amp; (Vr &lt;= v[1]), facecolor=<span style="color: #228b22;">'gray'</span>)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[1]) &amp; (Vr &lt;= v[2]), facecolor=<span style="color: #228b22;">'gray'</span>)

plt.text(v[0], 1, <span style="color: #228b22;">'A1 = {0}'</span>.<span style="color: #cd0000;">format</span>(A1))
plt.text(v[2], 1, <span style="color: #228b22;">'A2 = {0}'</span>.<span style="color: #cd0000;">format</span>(A2))
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.title(<span style="color: #228b22;">'$T_R$ = 0.9'</span>)

plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.png'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.svg'</span>)
</pre>
</div>


<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043939D0&gt;]
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043A7230&gt;]
&lt;matplotlib.collections.PolyCollection object at 0x047ADE70&gt;
&lt;matplotlib.collections.PolyCollection object at 0x047ADAB0&gt;
&gt;&gt;&gt; &lt;matplotlib.text.Text object at 0x0438E730&gt;
&lt;matplotlib.text.Text object at 0x047B7930&gt;
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
&lt;matplotlib.text.Text object at 0x042EBCD0&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-4.png"><p></p>
</div>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation.org">org-mode source</a><p>