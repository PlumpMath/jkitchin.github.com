---
title: Clickable email addresses in emacs
date: 2015/06/21 16:42:40
updated: 2015/06/21 16:42:40
categories: emacs,email
tags: 
---



<p>
There are clickable <a href="mailto:jkitchin@andrew.cmu.edu">mailto:jkitchin@andrew.cmu.edu</a> links in org-mode, but standalone email addresses like jkitchin@cmu.edu are just ordinary text. Here, I want to explore using clickable text instead. I will use the button-lock package for this. I borrowed an email regexp from <a href="http://www.emacswiki.org/emacs/RegularExpression">EmacsWiki: Regular Expression</a> for this. The idea is to define a regular expression for an email address, and use it to make the emails clickable.
</p>

<p>
I am still not sure what the canonical way to get the value of the text that was highlighted. Here we use the :additional-property feature to set a property to t, and then use that property to get the characters that have a non-nil "email-address" property. It seems clunky, but it works. The main action is to compose an email in mu4e (my preferred email program in emacs). You could also put a call to helm here, or to a hydra for other options.
</p>

<p>
I make the email addresses stand out a little by giving them a gray background, and a tooltip so you can see why they are highlighted. I also bind RET so I don't have to use the mouse. Don't forget you can type C-h . to see the local help instead of mousing over it! Finally, we add a text-mode hook so this will get loaded when we open a text file (or one with a mode derived from text-mode like org-mode).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">highlight-email-addresses</span> ()
  <span style="color: #036A07;">"Add button to email address. Clicking or RET will open a compose email window."</span>
  (button-lock-set-button
   <span style="color: #008000;">"\\w+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">\\.\\w+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">?@</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">\\w</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">\\.</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">+"</span>
   (<span style="color: #0000FF;">lambda</span> ()
     (<span style="color: #0000FF;">interactive</span>)
     (<span style="color: #0000FF;">let</span> ((start) (end) (email-address))
       (<span style="color: #0000FF;">while</span> (get-text-property (point) 'email-address)
         (backward-char))
       (forward-char)
       (<span style="color: #0000FF;">setq</span> start (point))
       (<span style="color: #0000FF;">while</span> (get-text-property (point) 'email-address)
         (forward-char))
       (<span style="color: #0000FF;">setq</span> end (point))
       (<span style="color: #0000FF;">setq</span> email-address (buffer-substring start end))
       (mu4e~compose-mail email-address)))
     <span style="color: #006FE0;">:face</span> '((<span style="color: #006FE0;">:background</span> <span style="color: #008000;">"gray80"</span>) (<span style="color: #006FE0;">:underline</span> t))
     <span style="color: #006FE0;">:help-echo</span> <span style="color: #008000;">"click to send mu4e email"</span>
     <span style="color: #006FE0;">:keyboard-binding</span> (kbd <span style="color: #008000;">"RET"</span>)
     <span style="color: #006FE0;">:additional-property</span> 'email-address))

(add-hook 'text-mode-hook 'highlight-email-addresses)
</pre>
</div>

<p>
That doesn't look too bad. Now, anytime I open an org-mode file with an email address in it, the address is highlighted in light gray, and underlined. I can click on it or put the cursor on it and press return and I get a compose email window open, with the email address pre-filled in! I am sure this will have some other applications.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/06/21/Clickable-email-addresses-in-emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>