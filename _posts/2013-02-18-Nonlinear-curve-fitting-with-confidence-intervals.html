---
title: Nonlinear curve fitting with confidence intervals
date: 2013/02/18 09:00:00
updated: 2013/02/27 14:41:34
categories: data analysis
tags: ''
---



<p>
Our goal is to fit this equation to data \(y = c1 exp(-x) + c2*x\) and compute the confidence intervals on the parameters.
</p>

<p>
This is actually could be a linear regression problem, but it is convenient to illustrate the  use the nonlinear fitting routine because it makes it easy to get
confidence intervals for comparison. The basic idea is to use the covariance matrix returned from the nonlinear fitting routine to estimate the student-t corrected confidence interval. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># Nonlinear curve fit with confidence interval</span>
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> curve_fit
<span style="color: #8b0000;">from</span> scipy.stats.distributions <span style="color: #8b0000;">import</span>  t

x = np.array([ 0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ])
y = np.array([ 4.70192769,  4.46826356,  4.57021389,  4.29240134,  3.88155125,
               3.78382253,  3.65454727,  3.86379487,  4.16428541,  4.06079909])

<span style="color: #ff0000; font-weight: bold;"># this is the function we want to fit to our data</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(x,c0, c1):
    <span style="color: #8b0000;">return</span> c0 * np.exp(-x) + c1*x

pars, pcov = curve_fit(func, x, y, p0=[4.96, 2.11])

alpha = 0.05 <span style="color: #ff0000; font-weight: bold;"># 95% confidence interval</span>

n = <span style="color: #8b0000;">len</span>(y)    <span style="color: #ff0000; font-weight: bold;"># number of data points</span>
p = <span style="color: #8b0000;">len</span>(pars) <span style="color: #ff0000; font-weight: bold;"># number of parameters</span>

dof = <span style="color: #8b0000;">max</span>(0, n-p) <span style="color: #ff0000; font-weight: bold;"># number of degrees of freedom</span>

tval = t.ppf(1.0 - alpha / 2.0, dof) <span style="color: #ff0000; font-weight: bold;"># student-t value for the dof and confidence level</span>

<span style="color: #8b0000;">for</span> i, p,var <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(range(n), pars, np.diag(pcov)):
    sigma = var**0.5
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'c{0}: {1} [{2}  {3}]'</span>.format(i, p,
                                  p - sigma*tval,
                                  p + sigma*tval)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.plot(x,y,<span style="color: #228b22;">'bo '</span>)
xfit = np.linspace(0,1)
yfit = func(xfit, pars[0], pars[1])
plt.plot(xfit,yfit,<span style="color: #228b22;">'b-'</span>)
plt.legend([<span style="color: #228b22;">'data'</span>,<span style="color: #228b22;">'fit'</span>],loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/nonlin-fit-ci.png'</span>)
</pre>
</div>

<pre class="example">
c0: 4.96713966439 [4.62674476567  5.30753456311]
c1: 2.10995112628 [1.76711622427  2.45278602828]
</pre>

<p><img src="/img/./images/nonlin-fit-ci.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Nonlinear-curve-fitting-with-confidence-intervals.org">org-mode source</a><p>