---
title: Potential gotchas in linear algebra in numpy
date: 2013/03/12 22:19:53
updated: 2013/03/12 22:19:53
categories: linear algebra, gotcha
tags: 
---


<p>
Numpy has some gotcha features for linear algebra purists. The first is that a 1d array is neither a row, nor a column vector. That is, \(a\) = \(a^T\) if \(a\) is a 1d array. That means you can take the dot product of \(a\) with itself, without transposing the second argument. This would not be allowed in Matlab.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([0, 1, 2])
<span style="color: #8b0000;">print</span> a.shape
<span style="color: #8b0000;">print</span> a
<span style="color: #8b0000;">print</span> a.T

<span style="color: #8b0000;">print</span>
<span style="color: #8b0000;">print</span> np.dot(a, a)
<span style="color: #8b0000;">print</span> np.dot(a, a.T)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; (3L,)
[0 1 2]
[0 1 2]
&gt;&gt;&gt;
5
5
</pre>

<p>
Compare the previous behavior with this 2d array. In this case, you cannot take the dot product of \(b\) with itself, because the dimensions are incompatible. You must transpose the second argument to make it dimensionally consistent. Also, the result of the dot product is not a simple scalar, but a 1 &times; 1 array.
</p>

<div class="org-src-container">

<pre class="src src-python">b = np.array([[0, 1, 2]])
<span style="color: #8b0000;">print</span> b.shape
<span style="color: #8b0000;">print</span> b
<span style="color: #8b0000;">print</span> b.T

<span style="color: #8b0000;">print</span> np.dot(b, b)    <span style="color: #ff0000; font-weight: bold;"># this is not ok, the dimensions are wrong.</span>
<span style="color: #8b0000;">print</span> np.dot(b, b.T)
<span style="color: #8b0000;">print</span> np.dot(b, b.T).shape
</pre>
</div>

<pre class="example">
(1L, 3L)
[[0 1 2]]
[[0]
 [1]
 [2]]
&gt;&gt;&gt; Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: objects are not aligned
[[5]]
(1L, 1L)
</pre>

<p>
Try to figure this one out! x is a column vector, and y is a 1d vector. Just by adding them you get a 2d array.
</p>
<div class="org-src-container">

<pre class="src src-python">x = np.array([[2], [4], [6], [8]])
y = np.array([1, 1, 1, 1, 1, 2])
<span style="color: #8b0000;">print</span> x + y
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [[ 3  3  3  3  3  4]
 [ 5  5  5  5  5  6]
 [ 7  7  7  7  7  8]
 [ 9  9  9  9  9 10]]
</pre>

<p>
Or this crazy alternative way to do the same thing.
</p>
<div class="org-src-container">

<pre class="src src-python">x = np.array([2, 4, 6, 8])
y = np.array([1, 1, 1, 1, 1, 1, 2])

<span style="color: #8b0000;">print</span> x[:, np.newaxis] + y
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [[ 3  3  3  3  3  3  4]
 [ 5  5  5  5  5  5  6]
 [ 7  7  7  7  7  7  8]
 [ 9  9  9  9  9  9 10]]
</pre>

<p>
In the next example,  we have a 3 element vector and a 4 element vector. We convert \(b\) to a 2D array with np.newaxis, and compute the outer product of the two arrays. The result is a 4 &times; 3 array.
</p>
<div class="org-src-container">

<pre class="src src-python">a = np.array([1, 2, 3])
b = np.array([10, 20, 30, 40])

<span style="color: #8b0000;">print</span> a * b[:, np.newaxis]
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [[ 10  40  90]
 [ 20  80 180]
 [ 30 120 270]
 [ 40 160 360]]
</pre>

<p>
These concepts are known in numpy as array broadcasting. See <a href="http://www.scipy.org/EricsBroadcastingDoc" >http://www.scipy.org/EricsBroadcastingDoc</a> and <a href="http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html" >http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html</a> for more details.
</p>

<p>
These are points to keep in mind, as the operations do not strictly follow the conventions of linear algebra, and may be confusing at times.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/12/Potential-gotchas-in-linear-algebra-in-numpy.org">org-mode source</a><p>