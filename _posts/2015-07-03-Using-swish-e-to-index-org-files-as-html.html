---
title: Using swish-e to index org files as html
date: 2015/07/03 10:13:11
updated: 2015/07/03 10:13:11
categories: emacs,search
tags: 
---



<p>
When we wrote about using swish-e <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/06/25/Integrating-swish-e-and-Emacs/">before</a> , we just indexed the org files as text. This worked pretty well, but we lost some resolution, e.g. being able to search for text in a headline. that is more possible if we index html or xml. So, here we try indexing the org files as html. It will be slower to index because we will filter each org file through a command that exports it to html, but hopefully it will be worth it for the enhanced search capability.
</p>

<p>
We will need a filter shell command that takes an org-file and spits out html. This command is shown as an <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/08/06/Writing-scripts-in-Emacs-lisp/">emacs-lisp script</a> here. This is a pretty bare bones export, and would lack the export of all my custom links from org-ref. I tried this, but org-ref outputs a lot of stuff to stdout when it loads, and unless I can figure out how to suppress that I don't want it here for now.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">:<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">exec emacs -batch -l $0 -f main "$@"</span>
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org</span>)
<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(add-to-list 'load-path "/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa")</span>
<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(add-to-list 'load-path "/Users/jkitchin/Dropbox/kitchingroup/jmax/org-ref")</span>
<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(setq package-user-dir "/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa")</span>
<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(package-initialize)</span>
<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(require 'org-ref)</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">main</span> ()
  (find-file (car command-line-args-left))
  (org-html-export-as-html nil nil nil t)
  (switch-to-buffer <span style="color: #008000;">"*Org HTML Export*"</span>)
  (print (buffer-string)))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Local Variables&#58;</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">mode: emacs-lisp</span>
<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">End:</span>
</pre>
</div>

<p>
We try it out here:
</p>

<div class="org-src-container">

<pre class="src src-sh">./org2html.el index-org-as-html.org
</pre>
</div>

<pre class="example">
"&lt;div id=\"table-of-contents\"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=\"text-table-of-contents\"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=\"#sec-1\"&gt;1. Using swish-e to index org files as html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=\"outline-container-sec-1\" class=\"outline-2\"&gt;
&lt;h2 id=\"sec-1\"&gt;&lt;span class=\"section-number-2\"&gt;1&lt;/span&gt; Using swish-e to index org files as html&lt;/h2&gt;
&lt;div class=\"outline-text-2\" id=\"text-1\"&gt;
&lt;p&gt;
When we wrote about using swish-e &lt;a href=\"http://kitchingroup.cheme.cmu.edu/blog/2015/06/25/Integrating-swish-e-and-Emacs/\"&gt;before&lt;/a&gt;, we just indexed the org files as text. This worked pretty well, but we lost some resolution, e.g. being able to search for text in a headline. that is more possible if we index html or xml. So, here we try indexing the org files as html. It will be slower to index because we will filter each org file through a command that exports it to html, but hopefully it will be worth it for the enhanced search capability.
&lt;/p&gt;

&lt;p&gt;
We will need a filter shell command that takes an org-file and spits out html. This command is shown as an emacs-lisp script here. This is a pretty bare bones export, and would lack the export of all my custom links
&lt;/p&gt;

&lt;p&gt;
cite:dauenhauer-2006-renew
&lt;/p&gt;

&lt;div class=\"org-src-container\"&gt;

&lt;pre class=\"src src-emacs-lisp\"&gt;:;exec emacs -batch -l $0 -f main \"$@\"
(require 'org)
;(add-to-list 'load-path \"/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa\")
;(add-to-list 'load-path \"/Users/jkitchin/Dropbox/kitchingroup/jmax/org-ref\")
;(setq package-user-dir \"/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa\")
;(package-initialize)
;(require 'org-ref)
(defun main ()
  (find-file (car command-line-args-left))
  (org-html-export-as-html nil nil nil t)
  (switch-to-buffer \"*Org HTML Export*\")
  (print (buffer-string)))

;; Local Variables:
;; mode: emacs-lisp
;; End:
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class=\"org-src-container\"&gt;

&lt;pre class=\"src src-sh\"&gt;./org2html.el index-org-as-html.org
&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=\"org-src-container\"&gt;

&lt;pre class=\"src src-text\"&gt;# Example configuration file

# Tell Swish-e what to directories to index
IndexDir /Users/jkitchin/blogofile-jkitchin.github.com

# where to save the index
IndexFile /Users/jkitchin/blogofile-jkitchin.github.com/_blog/swish-org/index.swish-e

# What to index
IndexOnly .org

# Tell Swish-e that .txt files are to use the text parser.
IndexContents TXT* .org

FileFilter .org /Users/jkitchin/blogofile-jkitchin.github.com/_blog/swish-org/org2html.el

# Ask libxml2 to report any parsing errors and warnings or
# any UTF-8 to 8859-1 conversion errors
ParserWarnLevel 9
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
"
</pre>


<p>
I think that looks good. Now, let's configure a swish indexer.
</p>


<div class="org-src-container">

<pre class="src src-text"># Example configuration file

# Tell Swish-e what to directories to index
IndexDir /Users/jkitchin/blogofile-jkitchin.github.com

# where to save the index
IndexFile /Users/jkitchin/blogofile-jkitchin.github.com/_blog/swish-org/index.swish-e

# What to index
IndexOnly .org

# Tell Swish-e that .txt files are to use the HTML parser.
IndexContents HTML* .org

FileFilter .org /Users/jkitchin/blogofile-jkitchin.github.com/_blog/swish-org/org2html.el

# Ask libxml2 to report any parsing errors and warnings or
# any UTF-8 to 8859-1 conversion errors
ParserWarnLevel 9

MetaNames class swishtitle
HTMLLinksMetaName links

PropertyNames author subjects

StoreDescription HTML &lt;body&gt;
</pre>
</div>

<p>
And now, run the index command. I did this at the command line. A lot of output! mostly not being able to fontify source blocks because htmlize was not on the path, and a bunch of attribute parsing errors, and a few utf-8 errors.
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -c swish-org-html.conf
</pre>
</div>

<p>
And a test search for files with "selector" in a headline.
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -f index.swish-e -x <span style="color: #008000;">'%r\t%p\n'</span> -w selector -t h
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: selector
# Removed stopwords:
# Number of hits: 4
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000	/Users/jkitchin/blogofile-jkitchin.github.com/org/2015/03/14/A-helm-mu4e-contact-selector.org
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2015/03/14/A-helm-mu4e-contact-selector.org
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_deploy/org/2015/03/14/A-helm-mu4e-contact-selector.org
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_blog/blog-2014.org
.
</pre>


<p>
A phrase in a headline.
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index.swish-e -x <span style="color: #008000;">'%r\t%p\n'</span> -w <span style="color: #008000;">"information for all documents"</span> -t h
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: information for all documents
# Removed stopwords:
# Number of hits: 5
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_blog/blog.org
921	/Users/jkitchin/blogofile-jkitchin.github.com/_blog/blog-2014.org
794	/Users/jkitchin/blogofile-jkitchin.github.com/org/2015/04/03/Getting-data-from-the-Scopus-API.org
794	/Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2015/04/03/Getting-data-from-the-Scopus-API.org
794	/Users/jkitchin/blogofile-jkitchin.github.com/_deploy/org/2015/04/03/Getting-data-from-the-Scopus-API.org
.
</pre>

<p>
Sweet. How about all documents containing this citation:
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -f index.swish-e -x <span style="color: #008000;">'%r\t%p\n'</span> -w cite:kitchin-2004-modif-pt
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: cite:kitchin-2004-modif-pt
# Removed stopwords:
# Number of hits: 3
# Search time: 0.000 seconds
# Run time: 0.008 seconds
1000	/Users/jkitchin/blogofile-jkitchin.github.com/media/2014-02-19-Extracting-bibtex-file-from-an-org-buffer/notes.org
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-02-19-Extracting-bibtex-file-from-an-org-buffer/notes.org
1000	/Users/jkitchin/blogofile-jkitchin.github.com/_deploy/media/2014-02-19-Extracting-bibtex-file-from-an-org-buffer/notes.org
.
</pre>

<p>
Super nice.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/07/03/Using-swish-e-to-index-org-files-as-html.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>