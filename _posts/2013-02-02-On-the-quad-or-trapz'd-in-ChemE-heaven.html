---
title: On the quad or trapz'd in ChemE heaven
date: 2013/02/02 09:00:00
updated: 2013/02/27 14:53:41
categories: integration, python
---


<p>


<a href="http://matlab.cheme.cmu.edu/2011/09/12/on-the-quad-or-trapzd-in-cheme-heaven/" >Matlab post</a>
</p>

<p>
What is the difference between quad and trapz? The short answer is that quad integrates functions (via a function handle) using numerical quadrature, and trapz performs integration of arrays of data using the trapezoid method.
</p>

<p>
Let us look at some examples. We consider the example of computing \(\int_0^2 x^3 dx\). the analytical integral is \(1/4 x^4\), so we know the integral evaluates to 16/4 = 4. This will be our benchmark for comparison to the numerical methods.
</p>

<p>
We use the scipy.integrate.quad command  to evaluate this \(\int_0^2 x^3 dx\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

ans, err = quad(<span style="color: #8b0000;">lambda</span> x: x**3, 0, 2)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
4.0
</pre>

<p>
you can also define a function for the integrand.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(x):
    <span style="color: #8b0000;">return</span> x**3

ans, err = quad(integrand, 0, 2)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
4.0
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Numerical data integration</h2>
<div class="outline-text-2" id="text-1">
<p>
if we had numerical data like this, we use trapz to integrate it
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x = np.array([0, 0.5, 1, 1.5, 2])
y = x**3

i2 = np.trapz(y, x)

error = (i2 - 4)/4

<span style="color: #8b0000;">print</span> i2, error
</pre>
</div>

<pre class="example">
4.25 0.0625
</pre>

<p>
Note the integral of these vectors is greater than 4! You can see why here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
x = np.array([0, 0.5, 1, 1.5, 2])
y = x**3

x2 = np.linspace(0, 2)
y2 = x2**3

plt.plot(x, y, label=<span style="color: #228b22;">'5 points'</span>)
plt.plot(x2, y2, label=<span style="color: #228b22;">'50 points'</span>)
plt.legend()
plt.savefig(<span style="color: #228b22;">'images/quad-1.png'</span>)
</pre>
</div>

<p><img src="/img/./images/quad-1.png"><p>

<p>
The trapezoid method is overestimating the area significantly. With more points, we get much closer to the analytical value.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x2 = np.linspace(0, 2, 100)
y2 = x2**3

<span style="color: #8b0000;">print</span> np.trapz(y2, x2)
</pre>
</div>

<pre class="example">
4.00040812162
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Combining numerical data with quad</h2>
<div class="outline-text-2" id="text-2">
<p>
You might want to combine numerical data with the quad function if you want to perform integrals easily. Let us say you are given this data:
</p>

<p>
x = [0 0.5 1 1.5 2];
y = [0    0.1250    1.0000    3.3750    8.0000];
</p>

<p>
and you want to integrate this from x = 0.25 to 1.75. We do not have data in those regions, so some interpolation is going to be needed. Here is one approach.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x = [0, 0.5, 1, 1.5, 2]
y = [0,    0.1250,    1.0000,    3.3750,    8.0000]

f = interp1d(x, y)

<span style="color: #ff0000; font-weight: bold;"># numerical trapezoid method</span>
xfine = np.linspace(0.25, 1.75)
yfine = f(xfine)
<span style="color: #8b0000;">print</span> np.trapz(yfine, xfine)

<span style="color: #ff0000; font-weight: bold;"># quadrature with interpolation</span>
ans, err = quad(f, 0.25, 1.75)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
2.53199187838
2.53125
</pre>

<p>
These approaches are very similar, and both rely on linear interpolation. The second approach is simpler, and uses fewer lines of code.
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Summary</h2>
<div class="outline-text-2" id="text-3">
<p>
trapz and quad are functions for getting integrals. Both can be used with numerical data if interpolation is used. The syntax for the quad and trapz function is different in scipy than in Matlab.
</p>

<p>
Finally, see this <a href="http://matlab.cheme.cmu.edu/2011/08/30/solving-integral-equations/" >post</a> for an example of solving an integral equation using quad and fsolve.</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/On-the-quad-or-trapz'd-in-ChemE-heaven.org">org-mode source</a><p>