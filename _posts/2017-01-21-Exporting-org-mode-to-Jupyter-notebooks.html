---
title: Exporting org-mode to Jupyter notebooks
date: 2017/01/21 19:51:23
updated: 2017/01/21 19:51:23
categories: emacs,orgmode,python,jupyter
tags: 
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org22a1111">1. Solve a nonlinear problem</a></li>
<li><a href="#orge4951e3">2. Benefits of export to ipynb</a></li>
<li><a href="#orgdfd829e">3. Limitations</a></li>
<li><a href="#org3f7752e">4. Summary</a></li>
</ul>
</div>
</div>
<p>
I am going to use Jupyter notebooks to teach from this semester. I really dislike preparing notebooks though. A browser is a really poor editor, and I really dislike Markdown. Notebooks do not seem to have any real structure in them, e.g. the collapsible outline that I am used to in org-mode, so for long notebooks, it is difficult to get a sense for the structure. I am anticipating spending up to 80 hours preparing notebooks this semester, so today I worked out some code to export org-mode to an ipython notebook! 
</p>

<p>
This will let me use the power tools I am accustomed to for the creation of IPython notebooks for my students, and perhaps others who do not use org-mode. 
</p>

<p>
Jupyter notebooks are just json files, so all we need to do is generate it from an org document. The basic strategy was to build up a lisp data structure that represents the notebook and then just convert that data structure to json. I split the document up into sequential markdown and code cells, and then encode those in the format required for the notebook (json).
</p>

<p>
So, here is an example of what can be easily written in org-mode, posted to this blog, and exported to an IPython notebook, all from one org-document.
</p>

<p>
Check out the notebook:  <a href="/media/exporting-orgmode-to-ipynb.ipynb">exporting-orgmode-to-ipynb.ipynb</a> . 
</p>

<div id="outline-container-org22a1111" class="outline-2">
<h2 id="org22a1111"><span class="section-number-2">1</span> Solve a nonlinear problem</h2>
<div class="outline-text-2" id="text-1">
<p>
Consider the equation \(x^2 = 4\). Find a solution to it in Python using a nonlinear solver. 
</p>

<p>
To do that, we need to define an objective function that will be equal to zero at the solution. Here is the function:
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(x):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> x**2 - 4
</pre>
</div>

<p>
Next, we use fsolve with an initial guess. We get fsolve from <a href="https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.optimize.fsolve.html#scipy.optimize.fsolve">scipy.optimize</a>.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fsolve

<span style="color: #BA36A5;">ans</span> = fsolve(objective, 3)
<span style="color: #0000FF;">print</span>(ans)
</pre>
</div>

<pre class="example">
[ 2.]
</pre>

<p>
That should have been an obvious answer. The answer is in brackets because fsolve returns an array. In the next block we will unpack the solution into the answer using the comma operator. Also, we can see that using a different guess leads to a different answer. There are, of course, two answers: \(x = \pm 2\)
</p>

<div class="org-src-container">
<pre class="src src-ipython">ans, = fsolve(objective, -3)
<span style="color: #0000FF;">print</span>(ans)
</pre>
</div>

<pre class="example">
-2.0
</pre>

<p>
Now you see we get a float answer!
</p>

<p>
Here are some other ways to get a float:
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #BA36A5;">ans</span> = fsolve(objective, -3)

<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">float</span>(ans))
<span style="color: #0000FF;">print</span>(ans[0])
</pre>
</div>

<pre class="example">
-2.0000000000000084
-2.0
</pre>

<p>
It is worth noting from the first result that fsolve is iterative and stops when it reaches zero within a tolerance. That is why it is not exactly -2.
</p>
</div>
</div>

<div id="outline-container-orge4951e3" class="outline-2">
<h2 id="orge4951e3"><span class="section-number-2">2</span> Benefits of export to ipynb</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>I can use org-mode</li>
<li>And emacs</li>
<li>and ipynb for teaching.</li>
</ol>

<p>
The export supports org-markup: <b>bold</b>, <i>italic</i>, <span class="underline">underlined</span>, and ~~strike~~.
</p>

<p>
We can use tables:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> A table of squares.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">16</td>
</tr>
</tbody>
</table>

<p>
We can make plots.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">t</span> = np.linspace(0, 2 * np.pi)

<span style="color: #BA36A5;">x</span> = np.cos(t)
<span style="color: #BA36A5;">y</span> = np.sin(t)

plt.plot(x, y)
plt.axis(<span style="color: #008000;">'equal'</span>)
plt.xlabel(<span style="color: #008000;">'x'</span>)
plt.ylabel(<span style="color: #008000;">'y'</span>)
plt.savefig(<span style="color: #008000;">'circle.png'</span>)
</pre>
</div>

<p>
<img src="/media/circle.png"> 
</p>

<p>
Even include HTML:
&lt;font color="red"&gt;Pay special attention to the axis labels!&lt;/font&gt;
</p>
</div>
</div>


<div id="outline-container-orgdfd829e" class="outline-2">
<h2 id="orgdfd829e"><span class="section-number-2">3</span> Limitations</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Only supports iPython blocks</li>
<li>Does not do inline images in results</li>
<li>Will not support src-block variables</li>
<li>Currently only supports vanilla output results</li>
</ul>
</div>
</div>


<div id="outline-container-org3f7752e" class="outline-2">
<h2 id="org3f7752e"><span class="section-number-2">4</span> Summary</h2>
<div class="outline-text-2" id="text-4">
<p>
The code that does this is here: <a href="/media/ox-ipynb.el">ox-ipynb.el</a> . After I use it a while I will put it in scimax. There are some tricks in it to fix up some markdown export of latex fragments and links with no descriptions.
</p>

<p>
I just run this command in Emacs to get the notebook. Even it renders reasonably in the notebook.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(export-ipynb-buffer)
</pre>
</div>

<p>
Overall, this looks extremely promising to develop lecture notes and assignments in org-mode, but export them to Ipython notebooks for the students.
</p>
</div>
</div>
<p>Copyright (C) 2017 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2017/01/21/Exporting-org-mode-to-Jupyter-notebooks.org">org-mode source</a></p>
<p>Org-mode version = 9.0.3</p>