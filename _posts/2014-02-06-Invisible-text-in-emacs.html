---
title: Invisible text in emacs
date: 2014/02/06 09:02:44
updated: 2014/02/06 09:03:02
categories: emacs
tags: 
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#beginner">1. subsection 1</a></li>
<li><a href="#sec-2">2. subsection 2</a></li>
<li><a href="#sec-3">3. subsection 3</a></li>
</ul>
</div>
</div>
<p>
Emacs supports <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Invisible-Text.html">invisible text</a> . In other words, you can use code to set properties on text in a buffer that make it visible, or invisible. You can use code to change the invisibility properties of text. 
</p>

<p>
I have been exploring ways to conditionally navigate in org documents using links. These links may validate that some property has been set in a heading, for example. An alternative approach is to make regions visible, depending on some criteria. That is what we do today. You will probably want to see this  <a href="/media/2014-02-06-Invisible-text-in-emacs/invisible-text.swf">video</a> , since what happens in this post is dynamic, and you will not see visible and invisible text.
</p>

<p>
What I have below here are a set of headings with properties that indicate what "level" they are at: beginner, medium and advanced. 
First, we mark each org subtree  with an overlay that has an 'invisible property that contains the "level". Then, we add the "level" to the list of symbols that marks invisible sections.  If you run this block, the headings all disappear.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-map-entries (<span style="color: #8b0000;">lambda</span> () 
                   (<span style="color: #8b0000;">let</span> ((level (org-entry-get (point) <span style="color: #228b22;">"level"</span>))
                          (symbol-level))
                     (<span style="color: #8b0000;">when</span> level
                       (setq symbol-level (intern level))
                       (org-mark-subtree)                 
                       (overlay-put (make-overlay (point) (mark))
                                    'invisible 
                                    symbol-level)
                       <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">make regions with symbol-level invisible</span>
                       (add-to-invisibility-spec `(,symbol-level))))))
</pre>
</div>

<p>
Now, we can selectively make them appear with these links.
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(beginner))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(medium))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(advanced))</pre> 
</p>

<p>
I imagine this could be useful to show selective content based on user choices. I am not sure it is better than links to external files. I imagine you would have to open this org file by some elisp command that would run the block at the top to make everything invisible, and then show it to the user. You could definitely build in more complex code to determine if a user was allowed to open a section. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">level2-p</span> ()
  <span style="color: #228b22;">"return if user is ready for level 2 based on value of property named correct"</span>
  (interactive)
  (<span style="color: #8b0000;">save-excursion</span>
    (org-open-link-from-string <span style="color: #228b22;">"[[#beginner]]"</span>)
    (<span style="color: #8b0000;">let</span> ((val (org-entry-get (point) <span style="color: #228b22;">"correct"</span>)))
      (<span style="color: #8b0000;">if</span> (and val (string= val <span style="color: #228b22;">"true"</span>))
          t
        nil))))
</pre>
</div>

<pre class="example">
level2-p
</pre>

<p>
Now, we can build this link: <pre>elisp:(when (level2-p) (remove-from-invisibility-spec '(medium)))</pre> 
</p>

<p>
This will show the medium level, provided we have already opened the beginner level and set the property value correctly.
</p>

<div id="outline-container-beginner" class="outline-2">
<h2 id="beginner"><a id="sec-1"></a><span class="section-number-2">1</span> subsection 1</h2>
<div class="outline-text-2" id="text-beginner">
<p>
some text in 1
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> subsection 2</h2>
<div class="outline-text-2" id="text-2">
<p>
more text in 2
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> subsection 3</h2>
<div class="outline-text-2" id="text-3">
<p>
last section 3
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/06/Invisible-text-in-emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>