---
title: Writing scripts in Emacs-lisp
date: 2014/08/06 14:27:58
updated: 2014/08/07 16:39:32
categories: emacs
tags: 
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Addition based on Trevor's comment</a></li>
</ul>
</div>
</div>

<p>
I have written lots of script commands, mostly in Python, occasionally in bash. Today I learned you can also write them in emacs-lisp (<a href="http://www.emacswiki.org/emacs/EmacsScripts">http://www.emacswiki.org/emacs/EmacsScripts</a> ). There is an interesting wrinkle on the first line which specifies how to run the command, which is explained in the emacswiki page.
</p>

<p>
Here is an example script that just prints some information about Emacs and the command line args you pass to it. We use some Local variables at the end to make the script open in emacs-lisp mode for editing. $0 in shell language is the name of the script being run, so the header here simply loads the script into emacs, and then runs the main function. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">:;exec emacs -batch -l "$0" -f main "$@"

(defun main ()
  (print (version))
  (print (format "I did it. you passed in %s" command-line-args-left)))

;; Local Variables:
;; mode: emacs-lisp
;; End:
</pre>
</div>

<p>
We need to tangle this code block to get the script. 
<a href="org-babel-tangle">org-babel-tangle</a>
</p>

<p>
Since we do not have a regular shebang, we manually change the mode to make it executable, and then call the script with some arguments.
</p>

<div class="org-src-container">

<pre class="src src-sh">chmod +x test.el
./test.el arg1 arg2
</pre>
</div>

<pre class="example">
"GNU Emacs 22.1.1 (mac-apple-darwin)
 of 2014-06-05 on osx105.apple.com"

"I did it. you passed in (arg1 arg2)"
</pre>

<p>
Hahah! I guess the emacs on my path is an old one! Ironically, the Emacs I am writing in is much more modern (but not on the path).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(version)
</pre>
</div>

<pre class="example">
GNU Emacs 24.3.1 (x86_64-apple-darwin, NS apple-appkit-1038.36)
 of 2013-03-13 on bob.porkrind.org
</pre>

<p>
And it is evidence I wrote this on a Mac. First Mac post ever.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Addition based on Trevor's comment</h2>
<div class="outline-text-2" id="text-1">
<p>
Also according to <a href="http://www.emacswiki.org/emacs/EmacsScripts">http://www.emacswiki.org/emacs/EmacsScripts</a> , there is the following option:
</p>

<pre class="example">
#!emacs --script
</pre>

<p>
as the shebang line. That did not work on my mac, but a small variation did with the absolute path to emacs. You still define the function in the script file, but you finally have to call the function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun main ()
  (print (version))
  (print (format "I did it. you passed in %s" command-line-args-left)))

(main)
;; Local Variables:
;; mode: emacs-lisp
;; End:
</pre>
</div>


<div class="org-src-container">

<pre class="src src-sh">./test2.el arg1 arg2 arg3
</pre>
</div>

<pre class="example">
"GNU Emacs 22.1.1 (mac-apple-darwin)
 of 2014-06-05 on osx105.apple.com"

"Called with (/usr/bin/emacs --no-splash -scriptload ./test2.el arg1 arg2 arg3)"

"I did it. you passed in (arg1 arg2 arg3)"
</pre>

<p>
Now, how do you do this python style so one file is a script and library at once? In python that is done with:
</p>

<div class="org-src-container">

<pre class="src src-python">def main ():
    ... put some module code here

if __name__ == '__main__':
    main()
</pre>
</div>

<p>
We can check the command line-args to see if there is a clue there.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun main ()
  (print (version))
  (print (format "Called with %s" command-line-args))
  (print (format "I did it. you passed in %s" command-line-args-left)))

(main)
;; Local Variables:
;; mode: emacs-lisp
;; End:
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">./test3.el arg1
</pre>
</div>

<pre class="example">
"GNU Emacs 22.1.1 (mac-apple-darwin)
 of 2014-06-05 on osx105.apple.com"

"Called with (/usr/bin/emacs --no-splash -scriptload ./test3.el arg1)"

"I did it. you passed in (arg1)"
</pre>

<p>
And apparently, this means when called with &#x2013;script, we see "-scriptload" as a command line arg. Strange, but workable. We just look for that, and if we see it run as a script, and if not do nothing.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun main ()
  (print (version))
  (print (format "Called with %s" command-line-args))
  (print (format "I did it. you passed in %s" command-line-args-left)))

(when (member "-scriptload" command-line-args)
  (main))
</pre>
</div>

<p>
Here we run as a script.
</p>

<div class="org-src-container">

<pre class="src src-sh">./test4.el arg1
</pre>
</div>

<pre class="example">
"GNU Emacs 22.1.1 (mac-apple-darwin)
 of 2014-06-05 on osx105.apple.com"

"Called with (/usr/bin/emacs --no-splash -scriptload ./test4.el arg1)"

"I did it. you passed in (arg1)"
</pre>

<p>
Now, we try loading the file, and calling our function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-file "test4.el")
(main)
</pre>
</div>

<pre class="example">
I did it. you passed in nil
</pre>

<p>
Sweet. An emacs script and library in one. Now, I just need to get my modern emacs on the path!
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/08/06/Writing-scripts-in-Emacs-lisp.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>