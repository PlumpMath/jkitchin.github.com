---
title: Using an external solver with Aspen
date: 2013/06/17 09:49:27
updated: 2013/06/17 09:49:27
categories: programming
tags: aspen
---


<p>
One reason to interact with Aspen via python is to use external solvers to drive the simulations. Aspen has some built-in solvers, but it does not have everything. You may also want to integrate additional calculations, e.g. capital costs, water usage, etc&#x2026; and integrate those results into a report. 
</p>

<p>
Here is a simple example where we use fsolve to find the temperature of the flash tank that will give a vapor phase mole fraction of ethanol of 0.8. It is a simple example, but it illustrates the possibility.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> os
<span style="color: #8b0000;">import</span> win32com.client <span style="color: #8b0000;">as</span> win32
aspen = win32.Dispatch(<span style="color: #228b22;">'Apwn.Document'</span>)

aspen.InitFromArchive2(os.path.abspath(<span style="color: #228b22;">'data\Flash_Example.bkp'</span>))

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(flashT):
    flashT = <span style="color: #8b0000;">float</span>(flashT) <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">COM objects do not understand numpy types</span>
    aspen.Tree.FindNode(<span style="color: #228b22;">'\Data\Blocks\FLASH\Input\TEMP'</span>).Value = flashT
    aspen.Engine.Run2()
    y = aspen.Tree.FindNode(<span style="color: #228b22;">'\Data\Streams\VAPOR\Output\MOLEFRAC\MIXED\ETHANOL'</span>).Value
    <span style="color: #8b0000;">return</span> y - 0.8

sol, = fsolve(func, 150.0)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'A flash temperature of {0:1.2f} degF will have y_ethanol = 0.8'</span>.format(sol)
</pre>
</div>

<pre class="example">
A flash temperature of 157.38 degF will have y_ethanol = 0.8
</pre>

<p>
One unexpected detail was that the Aspen COM objects cannot be assigned numpy number types, so it was necessary to recast the argument as a float. Otherwise, this worked about as expected for an fsolve problem.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/06/17/Using-an-external-solver-with-Aspen.org">org-mode source</a><p>