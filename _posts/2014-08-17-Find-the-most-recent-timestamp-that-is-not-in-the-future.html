---
title: Find the most recent timestamp that is not in the future
date: 2014/08/17 09:42:44
updated: 2014/08/17 09:42:44
categories: orgmode
tags: 
---


<p>
In a previous post, we looked at a way to jump to a timestamp (<a href="http://kitchingroup.cheme.cmu.edu/blog/2014/08/14/Jump-to-most-recent-timestamp-in-an-org-document">post</a> ). A limitation of that post was that our definition of "most recent" included timestamps in the future. Here we further constrain the definition to mean the most recent that is not in the future. 
</p>

<p>
We will do that by getting the list of timestamps, then filtering out future ones.
</p>

<p>
Here is a list of time-stamps
</p>
<ol class="org-ol">
<li><span class="timestamp-wrapper"><span class="timestamp">[2014-08-17 Sun]</span></span>
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2014-08-17 Sun 08:23&gt;</span></span>
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2014-08-17 Sun 09:23&gt;</span></span> 
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2014-08-18 Mon]</span></span>
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2014-08-17 Sun 13:00]</span></span>
</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2014-08-16 Sat 13:00]</span></span>
</li>
</ol>

<p>
Here is the code that filters out future timestamps. As I write this it is <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-08-17 Sun 08:31&gt;</span></span>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((now (<span style="color: #8b0000;">with-temp-buffer</span>
             ;; <span style="color: #ff0000; font-weight: bold;">sachac suggested this way to get a timestamp of "now"</span>
             (org-insert-time-stamp (org-read-date t t <span style="color: #228b22;">"."</span>) t)
             (buffer-string))))
  (remove-if (<span style="color: #8b0000;">lambda</span> (entry) (org-time&gt; (car entry) now))
             (cl-sort
              (org-element-map (org-element-parse-buffer) 'timestamp
                (<span style="color: #8b0000;">lambda</span> (timestamp)
                  (cons (org-element-property <span style="color: #cd0000;">:raw-value</span> timestamp) (org-element-property <span style="color: #cd0000;">:begin</span> timestamp))))
              'org-time&gt; <span style="color: #cd0000;">:key</span> 'car)))
</pre>
</div>

<p>
((<span class="timestamp-wrapper"><span class="timestamp">&lt;2014-08-17 Sun 08:31&gt;</span></span> . 811) (<span class="timestamp-wrapper"><span class="timestamp">&lt;2014-08-17 Sun 08:23&gt;</span></span> . 613) (<span class="timestamp-wrapper"><span class="timestamp">[2014-08-17 Sun]</span></span> . 593) (<span class="timestamp-wrapper"><span class="timestamp">[2014-08-16 Sat 13:00]</span></span> . 712))
</p>


<p>
You can see that only past timestamps show up in the list, and they are sorted with the most recent timestamp. The <code>remove-if</code> function is in 'cl, which is loaded in my init files. You may have to require that if you don't load it in your init files.</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/08/17/Find-the-most-recent-timestamp-that-is-not-in-the-future.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>