---
title: Nonlinear curve fitting with parameter confidence intervals
date: 2013/02/12 09:00:00
updated: 2013/02/27 14:41:13
categories: data analysis
tags: ''
---


<p>
<a href="http://matlab.cheme.cmu.edu/2011/08/29/nonlinear-curve-fitting-with-parameter-confidence-intervals/" >Matlab post</a>
</p>

<p>
We often need to estimate parameters from nonlinear regression of data. We should also consider how good the parameters are, and one way to do that is to consider the confidence interval. A confidence interval tells us a range that we are confident the true parameter lies in. 
</p>

<p>
In this example we use a nonlinear curve-fitting function: scipy.optimize.curve_fit to give us the parameters in a function that we define which best fit the data. The scipy.optimize.curve_fit function also gives us the <a href="http://en.wikipedia.org/wiki/Covariance_matrix" >covariance</a> matrix which we can use to estimate the standard error of each parameter. Finally,  we modify the standard error by a student-t value which accounts for the additional uncertainty in our estimates due to the small number of data points we are fitting to. 
</p>

<p>
We will fit the function \(y = a x / (b + x)\) to some data, and compute the 95% confidence intervals on the parameters.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># Nonlinear curve fit with confidence interval</span>
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> curve_fit
<span style="color: #8b0000;">from</span> scipy.stats.distributions <span style="color: #8b0000;">import</span>  t

x = np.array([0.5, 0.387, 0.24, 0.136, 0.04, 0.011])
y = np.array([1.255, 1.25, 1.189, 1.124, 0.783, 0.402])

<span style="color: #ff0000; font-weight: bold;"># this is the function we want to fit to our data</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(x, a, b):
    <span style="color: #228b22;">'nonlinear function in a and b to fit to data'</span>
    <span style="color: #8b0000;">return</span> a * x / (b + x)

initial_guess = [1.2, 0.03]
pars, pcov = curve_fit(func, x, y, p0=initial_guess)

alpha = 0.05 <span style="color: #ff0000; font-weight: bold;"># 95% confidence interval = 100*(1-alpha)</span>

n = <span style="color: #8b0000;">len</span>(y)    <span style="color: #ff0000; font-weight: bold;"># number of data points</span>
p = <span style="color: #8b0000;">len</span>(pars) <span style="color: #ff0000; font-weight: bold;"># number of parameters</span>

dof = <span style="color: #8b0000;">max</span>(0, n - p) <span style="color: #ff0000; font-weight: bold;"># number of degrees of freedom</span>

<span style="color: #ff0000; font-weight: bold;"># student-t value for the dof and confidence level</span>
tval = t.ppf(1.0-alpha/2., dof) 

<span style="color: #8b0000;">for</span> i, p,var <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(range(n), pars, np.diag(pcov)):
    sigma = var**0.5
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'p{0}: {1} [{2}  {3}]'</span>.format(i, p,
                                  p - sigma*tval,
                                  p + sigma*tval)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.plot(x,y,<span style="color: #228b22;">'bo '</span>)
xfit = np.linspace(0,1)
yfit = func(xfit, pars[0], pars[1])
plt.plot(xfit,yfit,<span style="color: #228b22;">'b-'</span>)
plt.legend([<span style="color: #228b22;">'data'</span>,<span style="color: #228b22;">'fit'</span>],loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/nonlin-curve-fit-ci.png'</span>)
</pre>
</div>

<pre class="example">
p0: 1.32753141454 [1.3005365922  1.35452623688]
p1: 0.0264615569701 [0.0236076538292  0.0293154601109]
(array([ 1.32753141,  0.02646156]), [[1.3005365921998688, 1.3545262368760884], [0.023607653829234403, 0.029315460110926929]], [0.0097228006732683319, 0.0010278982773703883])
</pre>

<p><img src="/img/./images/nonlin-curve-fit-ci.png"><p>

<p>
You can see by inspection that the fit looks pretty reasonable. The parameter confidence intervals are not too big, so we can be pretty confident of their values.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/12/Nonlinear-curve-fitting-with-parameter-confidence-intervals.org">org-mode source</a><p>