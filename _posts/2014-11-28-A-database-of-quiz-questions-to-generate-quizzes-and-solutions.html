---
title: A database of quiz questions to generate quizzes and solutions
date: 2014/11/28 14:41:45
updated: 2014/11/28 14:41:45
categories: education
tags: 
---


<p>
In this <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex/">post</a> I talked about a machine gradable quiz. One issue I have been trying to resolve is how to keep questions and solutions together. Currently, I have them separated, and that occasionally leads to them not being synchronized. One tricky part is if they are together, how do you create the quiz without answers in them? The answer is you have to "export" the quiz and selected problems, with selective content, and you want the elements of the question exported in some format, e.g. html or LaTeX.
</p>

<p>
I am going to explore representing a question as some data structure, not in org-mode for now. Then, we will use emacs-lisp to format the question the way we want it. The data we need about a question include the type of question, a unique id, the question, the choices, and the answer. For the choices, we might want some descriptive text for the solution. Here is one example of how we could represent a question as a struct in emacs-lisp. I do not claim here that this is the best or most complete way to represent it; it is simply a way that we could do it so we can discuss it later.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defstruct question type id question choices)
</pre>
</div>

<pre class="example">
question
</pre>

<p>
The defstruct macro creates a constructor function "make-question" for us, and we create questions like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq q1 (make-question
          <span style="color: #cd0000;">:type</span> 'multiple-choice
          <span style="color: #cd0000;">:id</span> <span style="color: #228b22;">"id:1"</span>
          <span style="color: #cd0000;">:question</span> <span style="color: #228b22;">"What is 2 + 2?"</span>
          <span style="color: #cd0000;">:choices</span> '(('choice 0 <span style="color: #228b22;">"Not correct"</span>)
                     ('choice 2 <span style="color: #228b22;">"Not correct"</span>)
                     ('choice 4 nil 'answer)
                     ('choice <span style="color: #228b22;">"None of the above"</span> <span style="color: #228b22;">"Not correct"</span>))))
</pre>
</div>

<pre class="example">
[cl-struct-question multiple-choice "id:1" "What is 2 + 2?" (((quote choice) 0 "Not correct") ((quote choice) 2 "Not correct") ((quote choice) 4 nil (quote answer)) ((quote choice) "None of the above" "Not correct"))]
</pre>

<p>
The defstruct macro also creates accessor functions to get the information stored in the question. These go by "question-SLOTNAME" and they make it pretty easy to get the data. We can convert this structure to an org-mode formatted question by using a formatted string, substituting values from the question object where we want them. I will make the headline contain the question, create some properties, and then make an org-link for each choice. The mc link is something I defined in the previous post.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(format <span style="color: #228b22;">"** %s</span>
<span style="color: #228b22;">  :PROPERTIES:</span>
<span style="color: #228b22;">  :ID: %s</span>
<span style="color: #228b22;">  :END:</span>
<span style="color: #228b22;">%s"</span> (question-question q1)
(question-id q1) 
(mapconcat 'identity (loop for i to (length (question-choices q1))
                           for choice in (question-choices q1)
                           collect
                           (format <span style="color: #228b22;">"[[mc:%s]] %s"</span> i (elt choice 1)))
           <span style="color: #228b22;">"\n"</span>))
</pre>
</div>

<pre class="example">
** What is 2 + 2?
  :PROPERTIES:
  :ID: id:1
  :END:
[[mc:0]] 0
[[mc:1]] 2
[[mc:2]] 4
[[mc:3]] None of the above
</pre>

<p>
To generate a quiz, we would just need to loop over several questions and insert the strings into a buffer then save it to a file. 
</p>

<p>
To generate the key, we use pretty similar code, and additionally find the choice that is the answer, and print any hints with the choices.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(format <span style="color: #228b22;">"** %s</span>
<span style="color: #228b22;">  :PROPERTIES:</span>
<span style="color: #228b22;">  :ID: %s</span>
<span style="color: #228b22;">  :CORRECT-ANSWER: %s</span>
<span style="color: #228b22;">  :END:</span>
<span style="color: #228b22;">%s"</span> (question-question q1)
    (question-id q1)
    ;; <span style="color: #ff0000; font-weight: bold;">here we loop through the choices looking for the answer </span>
    (loop for choice in (question-choices q1)
          until (-contains? choice '(quote answer))
          finally return (elt choice 1))
    (mapconcat 'identity (loop for i to (length (question-choices q1))
                               for choice in (question-choices q1)
                               collect
                               (format <span style="color: #228b22;">"[[mc:%s]] %s</span>
<span style="color: #228b22;">%s"</span> i (elt choice 1) (or (elt choice 2) <span style="color: #228b22;">""</span>)))
               <span style="color: #228b22;">"\n"</span>))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #8b008b;">** What is 2 + 2?</span>
<span style="color: #8b0000;">  :PROPERTIES:</span>
  <span style="color: #8b0000;">:ID:</span> id:1
  <span style="color: #8b0000;">:CORRECT-ANSWER:</span> 4
<span style="color: #8b0000;">  :END:</span>
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:0">mc:0</a></span> 0
Not correct
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:1">mc:1</a></span> 2
Not correct
<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:2">mc:2</a></span> 4

<span style="color: #0000ff; font-weight: bold; text-decoration: underline;"><a href="mc:3">mc:3</a></span> None of the above
Not correct
</pre>
</div>

<p>
It is a similar process to convert to LaTeX or HTML as well, just different syntax in the format statement. 
</p>

<p>
The next question is how to make authoring the questions pretty easy, i.e. with a minimal amount of syntax that represents the question data and is easy to transform. The lisp data structure is not too bad, but might be less familiar to many. Next we consider how to represent this question in org-mode. For example the question would be in a headline, and the ID and answer stored as properties. The choices might be stored as sub-headings that are tagged as choices. Then, constructing the question would entail going to the question headline, getting the information you want, and formatting it like I did above. The next section represents a question in org-mode. I think it actually takes more typing to do this, but some of it reuses some org-machinery I am familiar with. In any case, it is possible to store all the same kind of information using combinations of tags and properties. The next section is the question (only really visible in org-mode, not in the html post), and the section after that is how to use it.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a id="ID-99D480BD-9651-4987-9646-4BE90BA6CAEC" name="ID-99D480BD-9651-4987-9646-4BE90BA6CAEC"></a><span class="section-number-2">1</span> What is 2 + 2?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multiple_choice">multiple_choice</span></span></h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 0&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-1">
<p>
Not correct, This is the answer to 2 - 2.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-2">
<p>
Not correct
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> 4&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span>&#xa0;<span class="answer">answer</span></span></h3>
<div class="outline-text-3" id="text-1-3">
<p>
Correct. 
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> None of the above&#xa0;&#xa0;&#xa0;<span class="tag"><span class="choice">choice</span></span></h3>
<div class="outline-text-3" id="text-1-4">
<p>
This is not correct
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Working with the org representation of a question</h2>
<div class="outline-text-2" id="text-2">
<p>
Now, we use the org-machinery to work with the question and represent it in different formats. Here we just get the choices for a question with a specific id. We jump to the question, find headings tagged choice, and collect them.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">save-excursion</span>
  (org-open-link-from-string <span style="color: #228b22;">"id:99D480BD-9651-4987-9646-4BE90BA6CAEC"</span>)
  (<span style="color: #8b0000;">save-restriction</span>
    (org-narrow-to-subtree)
    (<span style="color: #8b0000;">let</span> ((choices '()))
      (org-map-entries
       (<span style="color: #8b0000;">lambda</span> ()
         (add-to-list
          'choices
          (org-heading-components)
          t))
       <span style="color: #228b22;">"choice"</span>)
      choices)))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="left" />

<col  class="right" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">0</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">2</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">4</td>
<td class="left">:choice:</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">3</td>
<td class="left">nil</td>
<td class="left">nil</td>
<td class="right">None of the above</td>
<td class="left">:choice:</td>
</tr>
</tbody>
</table>

<p>
You could use the headline for each choice to construct a question. For example, here we output some HTML to represent checkboxes in an HTML form.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">save-excursion</span>
  (org-open-link-from-string <span style="color: #228b22;">"id:99D480BD-9651-4987-9646-4BE90BA6CAEC"</span>)
  (<span style="color: #8b0000;">let</span> ((all-choices 
         (<span style="color: #8b0000;">save-restriction</span>
           (org-narrow-to-subtree)
           (<span style="color: #8b0000;">let</span> ((choices '()))
             (org-map-entries
              (<span style="color: #8b0000;">lambda</span> ()
                (add-to-list
                 'choices
                 (elt (org-heading-components) 4)
                 t))
              <span style="color: #228b22;">"choice"</span>)
             choices)))
        (question (elt (org-heading-components) 4))
        )
    (concat
     <span style="color: #228b22;">"&lt;html&gt;&lt;body&gt;\n"</span>
     <span style="color: #228b22;">"&lt;h1&gt;"</span> question <span style="color: #228b22;">"&lt;/h1&gt;\n"</span>
     <span style="color: #228b22;">"&lt;form action = \"\"&gt;"</span>
     (mapconcat
      'identity
      (loop for choice in all-choices
            collect       
            (format <span style="color: #228b22;">"  &lt;input type=\"checkbox\" name=\"choice\" value=\"%s\"&gt;%s&lt;br&gt;"</span>
                    choice choice))
      <span style="color: #228b22;">"\n"</span>)
     <span style="color: #228b22;">"\n&lt;/form&gt;\n"</span>
     <span style="color: #228b22;">"&lt;/body&gt;&lt;/html&gt;"</span>)))
</pre>
</div>
<html><body>
<h1>What is 2 + 2?</h1>
<form action = "">  <input type="checkbox" name="choice" value="0">0<br>
  <input type="checkbox" name="choice" value="2">2<br>
  <input type="checkbox" name="choice" value="4">4<br>
  <input type="checkbox" name="choice" value="None of the above">None of the above<br>
</form>
</body></html>

<p>
There is no action button to submit this answer, but you could add one if wanted. Clearly, you will have custom functions to export each format you want, with the information you want in it. The code for the org-mode representation is a little more verbose than the lisp data representation, but they accomplish basically the same thing. One thing that would be necessary to do is create some functions that take a list of question IDs and generate the quiz and solution in a buffer, and a helm interface for question selection would be pretty sweet.
</p>

<p>
I can see adding several other pieces of information about a problem, including categories or keywords, level of difficulty, how many points the problem is worth, last time it was assigned, relationship to course learning objectives, maybe information about who authored the problem, and a source if that is appropriate. These would allow you to consider machine grading, or correlating performance between problems, assessing how a class is doing on a problem, etc&#x2026; Lots of potential here.</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/11/28/A-database-of-quiz-questions-to-generate-quizzes-and-solutions.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>