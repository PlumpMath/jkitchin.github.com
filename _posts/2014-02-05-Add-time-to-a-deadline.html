---
title: Add time to a deadline
date: 2014/02/05 09:41:04
updated: 2014/02/05 09:41:04
categories: org-mode
tags: 
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. s1</a></li>
<li><a href="#sec-2">2. s1</a></li>
<li><a href="#sec-3">3. s1</a></li>
</ul>
</div>
</div>
<p>
I have an application where an org-file is a template with some due dates in it. I would like to update the deadlines to make them all relative to today. In this post I explore a way to do that. The strategy is to find deadlines, parse the time out of the time stamp, add an appropriate amount of time, and replace the time stamp. For this exercise, we use this org-file, which has one DEADLINE of "2014-01-13 Mon", and I want to add 60 days to the time stamp. 
</p>

<p>
Amazingly, emacs can parse time strings into a format that it can understand. I do not claim to understand what this function returns, but it is some representation of time that emacs understands.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>)
</pre>
</div>

<p>
(21203 11392)
</p>

<p>
Now, we can add time to that format. Let us say I want to add 60 days. In emacs, we add seconds to a time, so 60 days is 60 days * 24 hours * 60 minutes * 60 seconds, or in elisp: (* 60 24 60 60).
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days))
</pre>
</div>

<p>
(21282 18048 0 0)
</p>

<p>
That does not make too much sense, so we can use another function to format it like a new time stamp.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (format-time-string <span style="color: #228b22;">"&lt;%Y-%m-%d %a&gt;"</span>
                      (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days)))
</pre>
</div>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2014-03-13 Thu&gt;</span></span>
</p>

<p>
Beautiful. We just got a timestamp that is 60 days later than the original timestamp. Now we just search forward to find deadline, get the time stamp, add the time to it, and replace the line. I specifically want to change deadlines, so we will develop a regular expression for that. Here is a block that searches forward for a DEADLINE, parses it, adds 60 days to it, and replaces the deadline. The regular expression is limited to timestamps that look like &lt;yyyy-mm-dd day&gt;, i.e. no warnings or repeaters are found. In this post, there is subheading that looks like this initially:
</p>

<p>
#+BEGIN<sub>EXAMPLE</sub>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> s1</h2>
<div class="outline-text-2" id="text-1">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">progn</span>
  (<span style="color: #8b0000;">save-excursion</span>
    <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">go to timestamp</span>
    (re-search-forward <span style="color: #228b22;">"DEADLINE:\\s-*&lt;</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{4\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">\\s-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">Mon</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Tue</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Wed</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Thu</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Fri</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sat</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sun</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">&gt;"</span>)
    (<span style="color: #8b0000;">let</span> ((ts (match-string 1)) <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">this is the timestamp</span>
          (sixty-days (seconds-to-time (* 60 24 60 60)))
          (new-ts))
      (setq new-ts (format-time-string <span style="color: #228b22;">"    DEADLINE: &lt;%Y-%m-%d %a&gt;"</span>
                                       (time-add (date-to-time ts) sixty-days)))
      <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">now we kill the old time stamp, and insert the new one</span>
      (beginning-of-line)
      (kill-line)
      (insert new-ts))))
</pre>
</div>

<p>
After we run the code above, the deadline looks like this:
#+BEGIN<sub>EXAMPLE</sub>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> s1</h2>
<div class="outline-text-2" id="text-2">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<p>
We succeeded in moving it by 60 days. An interesting application of this would be to make all the deadlines in an org-file relative to some baseline date. For example, you have a series of deadlines for assignments throughout a semester, and it would be tedious to update these by hand. Suppose you could just establish a new beginning date, and make all deadlines relative to that date with a command. That seems useful. 
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> s1</h2>
<div class="outline-text-2" id="text-3">
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/05/Add-time-to-a-deadline.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>