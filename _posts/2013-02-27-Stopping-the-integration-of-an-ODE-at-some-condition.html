---
title: Stopping the integration of an ODE at some condition
date: 2013/02/27 14:30:30
updated: 2013/02/27 14:30:49
categories: ODE
tags: ''
---


<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/02/stopping-the-integration-of-an-ode-at-some-condition/" >Matlab post</a>

In Post 968 we learned how to get the numerical solution to an ODE, and then to use the deval function to solve the solution for a particular value. The deval function uses interpolation to evaluate the solution at other valuse. An alternative approach would be to stop the ODE integration when the solution has the value you want. That can be done in Matlab by using an &ldquo;event&rdquo; function. You setup an event function and tell the ode solver to use it by setting an option.
</p>

<p>
Given that the concentration of a species A in a constant volume, batch reactor obeys this differential equation \(\frac{dC_A}{dt}=- k C_A^2\) with the initial condition \(C_A(t=0) = 2.3\) mol/L and \(k = 0.23\) L/mol/s, compute the time it takes for \(C_A\) to be reduced to 1 mol/L.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> pycse <span style="color: #8b0000;">import</span> *
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

k = 0.23
Ca0 = 2.3

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">dCadt</span>(Ca, t):
    <span style="color: #8b0000;">return</span> -k * Ca**2

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">stop</span>(Ca, t):
    isterminal = <span style="color: #8b0000;">True</span>
    direction = 0
    value = 1.0 - Ca
    <span style="color: #8b0000;">return</span> value, isterminal, direction

tspan = np.linspace(0.0, 10.0)

t, CA, TE, YE, IE = odelay(dCadt, Ca0, tspan, events=[stop], full_output=1)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'At t = {0:1.2f} seconds the concentration of A is {1:1.2f} mol/L.'</span>.format(t[-1], CA[-1])
</pre>
</div>

<pre class="example">
At t = 2.46 seconds the concentration of A is 1.00 mol/L.
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Stopping-the-integration-of-an-ODE-at-some-condition.org">org-mode source</a><p>