---
title: Checking for email attachments before you send email
date: 2015/09/04 19:03:53
updated: 2015/09/04 19:04:15
categories: emacs,email
tags: 
---


<p>
Does this comic (<a href="http://www.phdcomics.com/comics/archive.php?comicid=1817">http://www.phdcomics.com/comics/archive.php?comicid=1817</a> ) apply to you? Do you miss the Gmail feature that will alert you that it seems like you mention an attachment but there isn't one attached before it lets you send it? Let's make Emacs help us here. We will scan our emails for the word "attach", and if we see it, scan the email for evidence of an attachment. Then create a hook function that will prompt us if it appears we mention an attachment, but don't have one.
</p>

<p>
An attachment looks like this in my messages:
</p>
<pre class="example">
&lt;#part type="image/png" filename="~/Desktop/wordcloud.png" disposition=attachment&gt;
&lt;#/part&gt;
</pre>

<p>
So, probably finding "&lt;#part" in the buffer means I probably have an attachment. We will use the message-send-hook to run this function. Here is the code. Some brief testing from me seems to work fine! It is pretty simple, but probably good enough to save me from sending messages with no attachment, and not too intrusive for when no attachment is actually needed, e.g. in replies. Let me know if you have ideas for improvements.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">email-says-attach-p</span> ()
  <span style="color: #036A07;">"Return t if email suggests there could be an attachment."</span>
  (<span style="color: #0000FF;">save-excursion</span>
    (goto-char (point-min))
    (re-search-forward <span style="color: #008000;">"attach"</span> nil t)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">email-has-attachment-p</span> ()
  <span style="color: #036A07;">"Return t if the currently open email has an attachment"</span>
  (<span style="color: #0000FF;">save-excursion</span>
    (goto-char (point-min))
    (re-search-forward <span style="color: #008000;">"&lt;#part"</span> nil t)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">email-pre-send-check-attachment</span> ()
  (<span style="color: #0000FF;">when</span> (<span style="color: #0000FF;">and</span> (email-says-attach-p)
             (not (email-has-attachment-p)))
    (<span style="color: #0000FF;">unless</span>
        (y-or-n-p <span style="color: #008000;">"Your email suggests you need an attachment, but no attachment was found. Send anyway?"</span>)
      (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #008000;">"It seems an attachment is needed, but none was found. Aborting send."</span>))))

(add-hook 'message-send-hook 'email-pre-send-check-attachment)
</pre>
</div>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/09/04/Checking-for-email-attachments-before-you-send-email.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>