---
title: Randomize a list in Emacs
date: 2014/09/06 10:08:04
updated: 2014/09/06 10:08:04
categories: emacs_lisp
tags: 
---



<p>
I have an application where I have a list of userids, and I want to randomize the order of the list. Today, I explore some ways to do that. The first idea is to simply mimic the algorithm in Python's random.shuffle algorithm.
</p>

<div class="org-src-container">

<pre class="src src-python">    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">shuffle</span>(<span style="color: #8b0000;">self</span>, x, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">random</span>=<span style="color: #8b0000;">None</span>):
        <span style="color: #228b22;">"""x, random=random.random -&gt; shuffle list x in place; return None.</span>

<span style="color: #228b22;">        Optional arg random is a 0-argument function returning a random</span>
<span style="color: #228b22;">        float in [0.0, 1.0); by default, the standard random.random.</span>

<span style="color: #228b22;">        """</span>

        <span style="color: #8b0000;">if</span> random <span style="color: #8b0000;">is</span> <span style="color: #8b0000;">None</span>:
            <span style="color: #000000; background-color: #cccccc; font-weight: bold;">random</span> = <span style="color: #8b0000;">self</span>.random
        <span style="color: #000000; background-color: #cccccc; font-weight: bold;">_int</span> =<span style="color: #cd0000;"> int</span>
        <span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span><span style="color: #cd0000;"> reversed(xrange</span>(<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,<span style="color: #cd0000;"> len</span>(x))):
            <span style="color: #ff0000; font-weight: bold;"># pick an element in x[:i+1] with which to exchange x[i]</span>
            <span style="color: #000000; background-color: #cccccc; font-weight: bold;">j</span> = _int(random() * (i+<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>))
            x[i], <span style="color: #000000; background-color: #cccccc; font-weight: bold;">x</span>[j] = x[j], x[i]
</pre>
</div>

<p>
It looks like we loop through the elements, and swap them at random.
</p>

<p>
We have a similar feature for xrange in emacs-lisp:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(number-sequence 1 5)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">3</td>
<td class="right">4</td>
<td class="right">5</td>
</tr>
</tbody>
</table>

<p>
Note that number-sequence includes the last value, unlike xrange. And for reverse:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(reverse (number-sequence 1 5))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">5</td>
<td class="right">4</td>
<td class="right">3</td>
<td class="right">2</td>
<td class="right">1</td>
</tr>
</tbody>
</table>

<p>
Of course, we can select random numbers:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(random 5) ; <span style="color: #ff0000; font-weight: bold;">random between 0 and 5</span>
</pre>
</div>

<pre class="example">
4
</pre>

<p>
Last, we need to work out how to swap to elements. It looks like this will swap elements 2 and 3. We store element 3 temporarily, set 3 to 2, and then set 2 to the temporarily stored value of 3.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((L '(1 2 3 4))
       (tmp (nth 3 L)))
  (setf (nth 3 L) (nth 2 L))
  (setf (nth 2 L) tmp)
L)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">4</td>
<td class="right">3</td>
</tr>
</tbody>
</table>

<p>
So, now we can shuffle our list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq userids '(user1 user2 user3 user4 user5 user6))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">swap</span> (LIST el1 el2)
  <span style="color: #228b22;">"in LIST swap indices EL1 and EL2 in place"</span>
  (<span style="color: #8b0000;">let</span> ((tmp (nth el1 LIST)))
    (setf (nth el1 LIST) (nth el2 LIST))
    (setf (nth el2 LIST) tmp)))

;; <span style="color: #ff0000; font-weight: bold;">now run the loop</span>
(loop for i in (reverse (number-sequence 1 (1- (length userids))))
      do (<span style="color: #8b0000;">let</span> ((j (random (+ i 1))))
           (swap userids i j)))

userids
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">user4</td>
<td class="left">user6</td>
<td class="left">user3</td>
<td class="left">user2</td>
<td class="left">user1</td>
<td class="left">user5</td>
</tr>
</tbody>
</table>

<p>
The order has certainly changed. It is a little difficult to tell how randomized it actually is, but what is important for my application is that the order is different each time I use it. It looks like this will accomplish that objective. I think this basically implements the algorithm in the Python random.shuffle code. That code does something a little differently. It generates a random float between 0-1, multiplies it by i + 1, and converts the result to an integer. We directly get an integer in the range of 0 to i + 1. I think the result is practically the same.
</p>

<p>
Finally, let us wrap the whole thing up in a nice neat function for future use.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">swap</span> (LIST el1 el2)
  <span style="color: #228b22;">"in LIST swap indices EL1 and EL2 in place"</span>
  (<span style="color: #8b0000;">let</span> ((tmp (nth el1 LIST)))
    (setf (nth el1 LIST) (nth el2 LIST))
    (setf (nth el2 LIST) tmp)))


(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">shuffle</span> (LIST)
  <span style="color: #228b22;">"Shuffle the elements in LIST.</span>
<span style="color: #228b22;">shuffling is done in place."</span>
  (loop for i in (reverse (number-sequence 1 (1- (length LIST))))
        do (<span style="color: #8b0000;">let</span> ((j (random (+ i 1))))
             (swap LIST i j)))
  LIST)

(shuffle '(user1 user2 user3 user4 user5 user6))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">user5</td>
<td class="left">user3</td>
<td class="left">user2</td>
<td class="left">user4</td>
<td class="left">user6</td>
<td class="left">user1</td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/09/06/Randomize-a-list-in-Emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>