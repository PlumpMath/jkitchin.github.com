---
title: Collecting entries from files in a directory
date: 2014/08/25 21:42:05
updated: 2014/08/25 21:44:51
categories: emacs-lisp
tags: 
---



<p>
I am running a class where students will be generating files that contain their answers. I want to quickly get a list of counts of all the answers. For example, six students will create a file called animal.dat in a directory called example/&lt;studentid&gt;, and that file will contain their favorite animal. I made some example files to test this idea out. Here are the contents.
</p>

<div class="org-src-container">

<pre class="src src-sh">cat example/*/animal.dat
</pre>
</div>

<pre class="example">
dog
cat
dog
bird
dog
bird
</pre>

<p>
You can see there are three dogs, two birds and a cat. I want code to do this counting, because in my real application there will be 58 of these files, and lots of times I need to aggregate them. Let us start with a simple example that counts the elements in a list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((animals '(dog cat dog bird dog bird))
      (counts '())
      place)
  (<span style="color: #8b0000;">dolist</span> (animal animals)
    (setq place (assoc animal counts))
    (message <span style="color: #228b22;">"place = %s"</span> place)
    (<span style="color: #8b0000;">if</span> place
        (setf (cdr place) (+ 1 (cdr place)))
      (setq counts (cons `(,animal . 1) counts))))
  counts)
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
Let us turn that into a function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">counts</span> (list)
  (<span style="color: #8b0000;">let</span> ((counts '())
        place)
    (<span style="color: #8b0000;">dolist</span> (el list)   
      (setq place (assoc el  counts))
    (message <span style="color: #228b22;">"place = %s"</span> place)
    (<span style="color: #8b0000;">if</span> place
        (setf (cdr place) (+ 1 (cdr place)))
      (setq counts (cons `(,el . 1) counts))))
    counts))

(counts '(dog cat dog bird dog bird))
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
Nice. Now we need a simple way to get that list. We need to glob the files to find them, then open them and read the value. Here is a way to get the files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(f-entries <span style="color: #228b22;">"example"</span>
           (<span style="color: #8b0000;">lambda</span> (f)
             (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
           t)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s1/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s2/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s3/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s4/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s5/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s6/animal.dat</td>
</tr>
</tbody>
</table>

<p>
Now we just need to run a mapcar over this list of files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(mapcar
 (<span style="color: #8b0000;">lambda</span> (f)
   (<span style="color: #8b0000;">with-temp-buffer</span>
     (insert-file-contents f)
     (s-trim (buffer-string))))
 (f-entries <span style="color: #228b22;">"example"</span>
            (<span style="color: #8b0000;">lambda</span> (f)
              (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
            t))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">dog</td>
<td class="left">cat</td>
<td class="left">dog</td>
<td class="left">bird</td>
<td class="left">dog</td>
<td class="left">bird</td>
</tr>
</tbody>
</table>


<p>
Finally, putting this together, we have some code that maps over the files, and counts the entries.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(counts
 (mapcar
  (<span style="color: #8b0000;">lambda</span> (f)
    (<span style="color: #8b0000;">with-temp-buffer</span>
      (insert-file-contents f)
      (s-trim (buffer-string))))
  (f-entries <span style="color: #228b22;">"example"</span>
             (<span style="color: #8b0000;">lambda</span> (f)
               (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
             t)))
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
This will be helpful in dealing with 58 entries during my class!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/08/25/Collecting-entries-from-files-in-a-directory.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>