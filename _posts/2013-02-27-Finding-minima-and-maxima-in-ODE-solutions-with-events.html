---
title: Finding minima and maxima in ODE solutions with events
date: 2013/02/27 14:31:01
updated: 2013/02/27 14:31:10
categories: ODE
tags: ''
---


<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/17/finding-minima-and-maxima-in-ode-solutions-with-events" >Matlab post</a>

Today we look at another way to use events in an ode solver. We use an events function to find minima and maxima, by evaluating the ODE in the event function to find conditions where the first derivative is zero, and approached from the right direction. A maximum is when the fisrt derivative is zero and increasing, and a minimum is when the first derivative is zero and decreasing.
</p>

<p>
We use a simple ODE, \(y' = sin(x)*e^{-0.05x}\), which has minima and maxima.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> pycse <span style="color: #8b0000;">import</span> *
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> np.sin(x) * np.exp(-0.05 * x)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">minima</span>(y, x):
    <span style="color: #228b22;">'''Approaching a minumum, dydx is negatime and going to zero. our event function is increasing'''</span>
    value = ode(y, x)
    direction = 1
    isterminal = <span style="color: #8b0000;">False</span>
    <span style="color: #8b0000;">return</span> value,  isterminal, direction

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">maxima</span>(y, x):
    <span style="color: #228b22;">'''Approaching a maximum, dydx is positive and going to zero. our event function is decreasing'''</span>
    value = ode(y, x)
    direction = -1
    isterminal = <span style="color: #8b0000;">False</span>
    <span style="color: #8b0000;">return</span> value,  isterminal, direction

xspan = np.linspace(0, 20, 100)

y0 = 0

X, Y, XE, YE, IE = odelay(ode, y0, xspan, events=[minima, maxima])
<span style="color: #8b0000;">print</span> IE
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.plot(X, Y)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">blue is maximum, red is minimum</span>
colors = <span style="color: #228b22;">'rb'</span>
<span style="color: #8b0000;">for</span> xe, ye, ie <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(XE, YE, IE):
    plt.plot([xe], [ye], <span style="color: #228b22;">'o'</span>, color=colors[ie])

plt.savefig(<span style="color: #228b22;">'./images/ode-events-min-max.png'</span>)
plt.show()
</pre>
</div>

<pre class="example">
[1, 0, 1, 0, 1, 0]
</pre>

<p><img src="/img/./images/ode-events-min-max.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Finding-minima-and-maxima-in-ODE-solutions-with-events.org">org-mode source</a><p>