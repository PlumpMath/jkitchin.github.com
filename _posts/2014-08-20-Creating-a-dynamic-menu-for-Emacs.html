---
title: Creating a dynamic menu for Emacs
date: 2014/08/20 20:26:18
updated: 2014/08/20 20:26:18
categories: emacs
tags: 
---


<p>
I have an application where I want a dynamic menu in Emacs, e.g. the menu auto-updates as things change on your computer. Here is a prototype example. We will make a menu that shows entries for each file in the current directory, and opens that entry.
</p>

<p>
We start by creating a menu that is initially empty like this. This menu will be called "My Files" in the menu.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(easy-menu-define jrk-menu global-map <span style="color: #228b22;">"MyMenu"</span>
  '(<span style="color: #228b22;">"My Files"</span>))
</pre>
</div>

<p>
Next, we create this function which will create a submenu with a vector entry for each file in this directory.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">get-menu</span> ()
  (easy-menu-create-menu
   <span style="color: #228b22;">"Files"</span>
   (mapcar (<span style="color: #8b0000;">lambda</span> (x)
             (vector (file-name-nondirectory x)
                     `(<span style="color: #8b0000;">lambda</span> () (interactive) (find-file ,x) t)))
           (f-glob <span style="color: #228b22;">"*"</span>))))
</pre>
</div>

<pre class="example">
get-menu
</pre>

<p>
Next, we add the submenu. This is a one-time addition, which reflects the files in the directory at the time I ran this block.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(easy-menu-add-item jrk-menu '() (get-menu))
</pre>
</div>

<p>
After you do that, the menu looks like this:
</p>


<div class="figure">
<p><img src="/media/2014-08-20-Creating-a-dynamic-menu-for-Emacs/Screen Shot 2014-08-20 at 8.14.00 PM.png"> 
</p>
</div>

<p>
This menu is not yet dynamic. We need to create a function that can update the menu, and then add the function to a hook that runs each time the menu opens. Here is the code. The easy-menu-add-item function will replace the contents of an item by the same name, which we use here to update the menu.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">update-my-file-menu</span> ()
  (easy-menu-add-item jrk-menu '() (get-menu)))

(add-hook 'menu-bar-update-hook 'update-my-file-menu)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">update-my-file-menu</td>
<td class="left">undo-tree-update-menu-bar</td>
<td class="left">menu-bar-update-buffers</td>
</tr>
</tbody>
</table>


<p>
Now, if we run this block to create a file:
</p>

<div class="org-src-container">

<pre class="src src-sh">touch newfile
</pre>
</div>

<p>
Then, after saving this buffer the menu looks like this:
</p>



<div class="figure">
<p><img src="/media/2014-08-20-Creating-a-dynamic-menu-for-Emacs/Screen Shot 2014-08-20 at 8.17.50 PM.png"> 
</p>
</div>

<p>
Now, every time a new file appears in this directory, a new menu item will appear every time you check the menu. That is really dynamic.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/08/20/Creating-a-dynamic-menu-for-Emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>