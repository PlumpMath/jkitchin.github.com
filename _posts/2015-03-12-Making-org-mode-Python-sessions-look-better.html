---
title: Making org-mode Python sessions look better
date: 2015/03/12 10:45:25
updated: 2015/03/12 18:58:57
categories: python,orgmode
tags: 
---


<p>
Using sessions for python in org-mode has always bugged me a little bit. Mostly the appearance of &gt;&gt;&gt; and &#x2026; in the output. For example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> 8
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 8
</pre>

<p>
Today on the org-mode mailing list someone suggested a <a href="http://thread.gmane.org/gmane.emacs.orgmode/95980/focus=96011">patch</a> that might fix that up. Hopefully that patch makes it into org-mode, but if you run off of ELPA like I do it will be some time before it appears in your working version.
</p>

<p>
In the meantime, inspired by my <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/03/11/Updating-Multiple-RESULTS-blocks-in-org-mode/">recent post</a> on updating multiple results, here we add a new hook function that removes these annoying characters from a Python session results section. Here is my version of this code.
"^: &gt;&gt;&gt;$"
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-babel-python-strip-session-chars</span> ()
  <span style="color: #036A07;">"Remove &gt;&gt;&gt; and ... from a Python session output."</span>
  (<span style="color: #0000FF;">when</span> (and (string=
              <span style="color: #008000;">"python"</span>
              (org-element-property <span style="color: #006FE0;">:language</span> (org-element-at-point)))
             (string-match
              <span style="color: #008000;">":session"</span>
              (org-element-property <span style="color: #006FE0;">:parameters</span> (org-element-at-point))))

    (<span style="color: #0000FF;">save-excursion</span>
      (<span style="color: #0000FF;">when</span> (org-babel-where-is-src-block-result)
        (goto-char (org-babel-where-is-src-block-result))
        (end-of-line 1)
        <span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(while (looking-at "[\n\r\t\f ]") (forward-char 1))</span>
        (<span style="color: #0000FF;">while</span> (re-search-forward
                <span style="color: #008000;">"</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">\\.\\.\\. </span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">: $</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">: &gt;&gt;&gt;$</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">"</span>
                (org-element-property <span style="color: #006FE0;">:end</span> (org-element-at-point))
                t)
          (replace-match <span style="color: #008000;">""</span>)
          <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this enables us to get rid of blank lines and blank : &gt;&gt;&gt;</span>
          (beginning-of-line)
          (<span style="color: #0000FF;">when</span> (looking-at <span style="color: #008000;">"^$"</span>)
            (kill-line)))))))

(add-hook 'org-babel-after-execute-hook 'org-babel-python-strip-session-chars)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">org-babel-python-strip-session-chars</td>
<td class="left">(lambda nil (org-refresh-images))</td>
</tr>
</tbody>
</table>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot([3, 4, 5])
plt.show()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>(s):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span> = 2 * s
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">blank lines look like indentation errors</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> x

<span style="color: #0000FF;">print</span> f(4)
</pre>
</div>

<pre class="example">
[&lt;matplotlib.lines.Line2D object at 0x10955c290&gt;]
8
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> f(9)
</pre>
</div>

<pre class="example">
18
</pre>

<p>
Here we can make an inline figure.
</p>
<div class="org-src-container">

<pre class="src src-python">plt.figure()
plt.plot([3, 4.5, 5])
plt.savefig(<span style="color: #008000;">'images/session-fig.png'</span>)
<span style="color: #008000;">'images/session-fig.png'</span>
</pre>
</div>

<p>
<img src="/media/2015-03-12-Making-org-mode-Python-sessions-look-better/session-fig.png"> 
Not bad. It seems to work! Maybe this will make sessions more usable for me.
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-03-12 Thu]</span></span> New corner case, do not cause an error when results are silenced.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> 6
</pre>
</div>


<p>
Testing getting rid of blank lines and empty : &gt;&gt;&gt; lines.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">a</span> = 2
<span style="color: #BA36A5;">b</span> = 3
<span style="color: #BA36A5;">c</span> = 4
<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'a=      '</span>, a
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'b =     '</span>, b
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'a + b = '</span>, a+b
</pre>
</div>

<pre class="example">
a=       2
b =      3
a + b =  5
</pre>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/03/12/Making-org-mode-Python-sessions-look-better.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>