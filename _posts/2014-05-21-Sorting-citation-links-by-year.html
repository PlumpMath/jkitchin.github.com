---
title: Sorting citation links by year
date: 2014/05/21 09:57:48
updated: 2014/05/21 09:57:48
categories: bibtex
tags: 
---



<p>
When there are several citations grouped together, I like them sorted by year. For example, I do not like this <a href="#liu-2014-spect-studies">liu-2014-spect-studies</a>,<a href="#mcalpin-2010-epr-eviden">mcalpin-2010-epr-eviden</a>,<a href="#kanan-2009-cobal">kanan-2009-cobal</a>,<a href="#lutterman-2009-self-healin">lutterman-2009-self-healin</a>,<a href="#kanan-2008-in-situ">kanan-2008-in-situ</a>. I prefer <a href="#kanan-2008-in-situ">kanan-2008-in-situ</a>,<a href="#kanan-2009-cobal">kanan-2009-cobal</a>,<a href="#lutterman-2009-self-healin">lutterman-2009-self-healin</a>,<a href="#mcalpin-2010-epr-eviden">mcalpin-2010-epr-eviden</a>,<a href="#liu-2014-spect-studies">liu-2014-spect-studies</a>. It is just a preference, but it seems appropriate to cite things in chronological order. 
</p>

<p>
It is actually a little tedious to sort this by hand though. Hence, today we examine some tools to automate the sorting. The idea is to make a function that will get the keys, sort them by year, and then replace the link with the sorted text.
</p>

<p>
Let us try some sorting. We will construct a set of cons cells with a year and key, sort that list by year, and then concatenate the keys. Here is an example of the sorting. The years will come as strings from the bibtex file.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq data '(("2014" . "key1") ("2012" . "key2")("2016" . "key3")))
(setq data 
	(cl-sort data (lambda (x y) (&lt; (string-to-int (car x)) (string-to-int (car y))))))
(mapconcat (lambda (x) (cdr x)) data ",")
</pre>
</div>

<pre class="example">
key2,key1,key3
</pre>

<p>
That is easy enough. Now, a function to get the year, and then the function to sort a link. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defun org-ref-get-citation-year (key)
  "get the year of an entry with key"
  (interactive)
  (let* ((results (org-ref-get-bibtex-key-and-file key))
	 (bibfile (cdr results))
	 (cb (current-buffer)))
    (message "---------%s %s" key bibfile)
    (set-buffer (find-file-noselect bibfile))
    (bibtex-search-entry key nil 0)
    (prog1 (reftex-get-bib-field "year" (bibtex-parse-entry t))
      (set-buffer cb))))

(defun org-ref-sort-citation-link ()
 "replace link at point with sorted link by year"
 (interactive)
 (let* ((object (org-element-context))	 
        (type (org-element-property :type object))
	(begin (org-element-property :begin object))
	(end (org-element-property :end object))
	(link-string (org-element-property :path object))
	keys years data)
  (setq keys (org-ref-split-and-strip-string link-string))
  (setq years (mapcar 'org-ref-get-citation-year keys)) 
  (setq data (mapcar* (lambda (a b) `(,a . ,b)) years keys))
  (setq data (cl-sort data (lambda (x y) (&lt; (string-to-int (car x)) (string-to-int (car y))))))
  ;; now get the keys separated by commas
  (setq keys (mapconcat (lambda (x) (cdr x)) data ","))
  ;; and replace the link with the sorted keys
  (cl--set-buffer-substring begin end (concat type ":" keys))
))
</pre>
</div>

<p>
Now, you put your cursor on a link, run M-x org-ref-sort-citation-link, and the magic happens  <a href="#kanan-2008-in-situ">kanan-2008-in-situ</a>,<a href="#kanan-2009-cobal">kanan-2009-cobal</a>,<a href="#lutterman-2009-self-healin">lutterman-2009-self-healin</a>,<a href="#mcalpin-2010-epr-eviden">mcalpin-2010-epr-eviden</a>,<a href="#liu-2014-spect-studies">liu-2014-spect-studies</a>! It would also be nice to have some arrow commands so you could do something like manually reorder them with S-arrow or something like in the calendar, but that will be another day.</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/21/Sorting-citation-links-by-year.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>