---
title: Nonlinear curve fitting by direct least squares minimization
date: 2013/02/18 09:00:00
updated: 2013/02/27 14:40:50
categories: data analysis
---


<p>
Here is an example of fitting a nonlinear function to data by direct minimization of the summed squared error. 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

volumes = np.array([13.71, 14.82, 16.0, 17.23, 18.52])

energies = np.array([-56.29, -56.41, -56.46, -56.463,-56.41])

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">Murnaghan</span>(parameters,vol):
    <span style="color: #228b22;">'From PRB 28,5480 (1983'</span>
    E0 = parameters[0]
    B0 = parameters[1]
    BP = parameters[2]
    V0 = parameters[3]

    E = E0 + B0*vol/BP*(((V0/vol)**BP)/(BP-1)+1) - V0*B0/(BP-1.)

    <span style="color: #8b0000;">return</span> E

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(pars,vol):
    <span style="color: #ff0000; font-weight: bold;">#we will minimize this function</span>
    err =  energies - Murnaghan(pars,vol)
    <span style="color: #8b0000;">return</span> np.sum(err**2) <span style="color: #ff0000; font-weight: bold;">#we return the summed squared error directly</span>

x0 = [ -56., 0.54, 2., 16.5] <span style="color: #ff0000; font-weight: bold;">#initial guess of parameters</span>

plsq = fmin(objective,x0,args=(volumes,)) <span style="color: #ff0000; font-weight: bold;">#note args is a tuple</span>

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'parameters = {0}'</span>.format(plsq)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.plot(volumes,energies,<span style="color: #228b22;">'ro'</span>)

<span style="color: #ff0000; font-weight: bold;">#plot the fitted curve on top</span>
x = np.linspace(<span style="color: #8b0000;">min</span>(volumes),<span style="color: #8b0000;">max</span>(volumes),50)
y = Murnaghan(plsq,x)
plt.plot(x,y,<span style="color: #228b22;">'k-'</span>)
plt.xlabel(<span style="color: #228b22;">'Volume ($\AA^3$)'</span>)
plt.ylabel(<span style="color: #228b22;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #228b22;">'images/nonlinear-fitting-lsq.png'</span>)
</pre>
</div>

<pre class="example">
Optimization terminated successfully.
         Current function value: 0.000020
         Iterations: 137
         Function evaluations: 240
parameters = [-56.46932645   0.59141447   1.9044796   16.59341303]
</pre>

<p><img src="/img/./images/nonlinear-fitting-lsq.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Nonlinear-curve-fitting-by-direct-least-squares-minimization.org">org-mode source</a><p>