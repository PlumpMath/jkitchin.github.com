---
title: Vectorized numeric derivatives
date: 2013/02/27 14:51:11
updated: 2013/02/27 14:51:11
categories: 
---


<p>

Loops are usually not great for performance. Numpy offers some vectorized methods that allow us to compute derivatives without loops, although this comes at the mental cost of harder to understand syntax
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

x = np.linspace(0, 2 * np.pi, 100)
y = np.sin(x)
dy_analytical = np.cos(x)


<span style="color: #ff0000; font-weight: bold;"># we need to specify the size of dy ahead because diff returns</span>
<span style="color: #ff0000; font-weight: bold;">#an array of n-1 elements</span>
dy = np.zeros(y.shape, np.float) <span style="color: #ff0000; font-weight: bold;">#we know it will be this size</span>
dy[0:-1] = np.diff(y) / np.diff(x)
dy[-1] = (y[-1] - y[-2]) / (x[-1] - x[-2])


<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">calculate dy by center differencing using array slices</span>
<span style="color: #228b22;">'''</span>

dy2 = np.zeros(y.shape,np.float) <span style="color: #ff0000; font-weight: bold;">#we know it will be this size</span>
dy2[1:-1] = (y[2:] - y[0:-2]) / (x[2:] - x[0:-2])

<span style="color: #ff0000; font-weight: bold;"># now the end points</span>
dy2[0] = (y[1] - y[0]) / (x[1] - x[0])
dy2[-1] = (y[-1] - y[-2]) / (x[-1] - x[-2])

plt.plot(x,y)
plt.plot(x,dy_analytical,label=<span style="color: #228b22;">'analytical derivative'</span>)
plt.plot(x,dy,label=<span style="color: #228b22;">'forward diff'</span>)
plt.plot(x,dy2,<span style="color: #228b22;">'k--'</span>,lw=2,label=<span style="color: #228b22;">'centered diff'</span>)
plt.legend(loc=<span style="color: #228b22;">'lower left'</span>)
plt.savefig(<span style="color: #228b22;">'images/vectorized-diffs.png'</span>)
plt.show()
</pre>
</div>

<p><img src="/img/./images/vectorized-diffs.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Vectorized-numeric-derivatives.org">org-mode source</a><p>